<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.552">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Exploratory Analysis II: Identifying effort-related features contributing to misunderstanding resolution via XGBoost</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


</head>

<body class="nav-sidebar floating nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
        <div class="quarto-navbar-tools tools-end">
    <div class="dropdown">
      <a href="" title="" id="quarto-navigation-tool-dropdown-0" class="quarto-navigation-tool dropdown-toggle px-1" data-bs-toggle="dropdown" aria-expanded="false" aria-label=""><i class="bi bi-github"></i></a>
      <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="quarto-navigation-tool-dropdown-0">
          <li>
            <a class="dropdown-item quarto-navbar-tools-item" href="https://github.com/sarkadava/FLESH_Effort">
            Source Code
            </a>
          </li>
          <li>
            <a class="dropdown-item quarto-navbar-tools-item" href="https://github.com/sarkadava/FLESH_Effort/issues">
            Report a Bug
            </a>
          </li>
      </ul>
    </div>
</div>
          <div id="quarto-search" class="" title="Search"></div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../06_ConceptSimilarity/ConceptNet_similarity.html">Analysis</a></li><li class="breadcrumb-item"><a href="../08_Analysis_XGBoost/02_XGBoost_effortIndicators.html">Exploratory Analysis II: Identifying effort-related features contributing to misunderstanding resolution via XGBoost</a></li></ol></nav>
        <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Home</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../method.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Overview of Methods</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
 <span class="menu-text">Processing</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../01_XDF_processing/xdf_workflow.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Pre-Processing I: from XDF to raw files</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../02_MotionTracking_processing/01_Video_preparation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Motion tracking I: Preparation of videos</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../02_MotionTracking_processing/02_Track_OpenPose.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Motion tracking II: 2D pose estimation via OpenPose</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../02_MotionTracking_processing/03_Track_pose2sim.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Motion tracking III: Triangulation via Pose2sim</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../02_MotionTracking_processing/04_Track_InverseKinDyn.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Motion tracking IV: Modeling inverse kinematics and dynamics</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../03_TS_processing/01_TS_processing_motion.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Processing I: Motion tracking and balance</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../03_TS_processing/02_TS_processing_acoustics.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Processing II: Acoustics</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../03_TS_processing/03_TS_merging.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Processing III: Merging multimodal data</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true">
 <span class="menu-text">Time Series Annotation</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../04_TS_movementAnnotation/01_Classify_preparation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Movement annotation I: Preparing training data and data for classifier</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../04_TS_movementAnnotation/02_MovementClassifier.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Movement annotation II: Training movement classifier, and annotating timeseries data</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../04_TS_movementAnnotation/03_InterAgreement.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Movement annotation III: Computing interrater agreement between manual and automatic annotation</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../05_finalMerge/TS_mergeAnnotations.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Final merge</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true">
 <span class="menu-text">Analysis</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../06_ConceptSimilarity/ConceptNet_similarity.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Computing concept similarity using ConceptNet word embeddings</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../07_TS_featureExtraction/TS_extraction.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Extraction of effort-related features</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../08_Analysis_XGBoost/01_PCA_featureDimensions.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Exploratory Analysis I: Using PCA to identify effort dimensions</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../08_Analysis_XGBoost/02_XGBoost_effortIndicators.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">Exploratory Analysis II: Identifying effort-related features contributing to misunderstanding resolution via XGBoost</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../09_Analysis_Modeling/Modelling_syntheticData.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Statistical Analysis: Modelling the Effect of Communicative Attempt (H1) and Answer Similarity (H2) on Effort</span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#sec-xgboost" id="toc-sec-xgboost" class="nav-link active" data-scroll-target="#sec-xgboost">Overview</a></li>
  <li><a href="#gesture" id="toc-gesture" class="nav-link" data-scroll-target="#gesture">Gesture</a>
  <ul class="collapse">
  <li><a href="#random-forests" id="toc-random-forests" class="nav-link" data-scroll-target="#random-forests">Random forests</a></li>
  <li><a href="#xgboost" id="toc-xgboost" class="nav-link" data-scroll-target="#xgboost">XGBoost</a>
  <ul class="collapse">
  <li><a href="#models" id="toc-models" class="nav-link" data-scroll-target="#models">Models</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#vocalization" id="toc-vocalization" class="nav-link" data-scroll-target="#vocalization">Vocalization</a>
  <ul class="collapse">
  <li><a href="#random-forests-1" id="toc-random-forests-1" class="nav-link" data-scroll-target="#random-forests-1">Random forests</a></li>
  <li><a href="#xgboost-1" id="toc-xgboost-1" class="nav-link" data-scroll-target="#xgboost-1">XGBoost</a>
  <ul class="collapse">
  <li><a href="#k-fold-cross-validation-1" id="toc-k-fold-cross-validation-1" class="nav-link" data-scroll-target="#k-fold-cross-validation-1">K-fold cross-validation</a></li>
  <li><a href="#models-1" id="toc-models-1" class="nav-link" data-scroll-target="#models-1">Models</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#multimodal" id="toc-multimodal" class="nav-link" data-scroll-target="#multimodal">Multimodal</a>
  <ul class="collapse">
  <li><a href="#random-forests-2" id="toc-random-forests-2" class="nav-link" data-scroll-target="#random-forests-2">Random forests</a></li>
  <li><a href="#xgboost-2" id="toc-xgboost-2" class="nav-link" data-scroll-target="#xgboost-2">XGBoost</a>
  <ul class="collapse">
  <li><a href="#k-fold-cross-validation-2" id="toc-k-fold-cross-validation-2" class="nav-link" data-scroll-target="#k-fold-cross-validation-2">K-fold cross-validation</a></li>
  <li><a href="#models-2" id="toc-models-2" class="nav-link" data-scroll-target="#models-2">Models</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#session-info" id="toc-session-info" class="nav-link" data-scroll-target="#session-info">Session info</a></li>
  <li><a href="#references" id="toc-references" class="nav-link" data-scroll-target="#references">References</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../06_ConceptSimilarity/ConceptNet_similarity.html">Analysis</a></li><li class="breadcrumb-item"><a href="../08_Analysis_XGBoost/02_XGBoost_effortIndicators.html">Exploratory Analysis II: Identifying effort-related features contributing to misunderstanding resolution via XGBoost</a></li></ol></nav>
<div class="quarto-title">
<h1 class="title">Exploratory Analysis II: Identifying effort-related features contributing to misunderstanding resolution via XGBoost</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<section id="sec-xgboost" class="level1">
<h1>Overview</h1>
<p>This script is an adaption of pipeline by <span class="citation" data-cites="cwiek_etal_inprep2">Ćwiek et al. (<a href="#ref-cwiek_etal_inprep2" role="doc-biblioref">n.d.</a>)</span>.</p>
<p>In this script, we are going to use XGBoost, eXtreme Gradient Boosting <span class="citation" data-cites="chen_guestrin16">(<a href="#ref-chen_guestrin16" role="doc-biblioref">Chen and Guestrin 2016</a>)</span>, to identify effort-related features beyond those investigated within our confirmatory analysis, i.e., torque change, amplitude envelope, and change in center of pressure.</p>
<p>XGBoost is a machine learning algorithm that builds an ensemble of decision trees to predict an outcome based on input features. For us, outcome refers to <em>communicative attempt</em> (baseline, first correction, second correction) and input features refer to all <em>features of effort</em> collected in <a href="../07_TS_featureExtraction/TS_extraction.html#sec-features">Feature extraction script</a>.</p>
<p>We are going to use separate models for each modality, as we expect differences in how (significantly) features contribute to resolving misunderstanding in first and second correction. Finally, when having list of features ordered by their importance in predicting communicative attempt, we will combine the XGBoost-computed importance with PCA analysis we have performed in <a href="../08_Analysis_XGBoost/01_PCA_featureDimensions.html#sec-pca">this script</a>. This is to ensure we pick features from uncorrelated dimensions and thus cover more explanatory planes of effort.</p>
<p>Note that the current version of the script is used with data only from dyad 0. Since this is not sufficient amount of data for any meaningful conclusions, this script serves for building the workflow. We will use identical pipeline with the full dataset, and any deviations from this script will be reported.</p>
<div class="cell">
<details class="code-fold">
<summary>Code to prepare the environment</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>parentfolder <span class="ot">&lt;-</span> <span class="fu">dirname</span>(<span class="fu">getwd</span>())</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>datasets      <span class="ot">&lt;-</span> <span class="fu">paste0</span>(parentfolder, <span class="st">'/08_Analysis_XGBoost/datasets/'</span>)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>models        <span class="ot">&lt;-</span> <span class="fu">paste0</span>(parentfolder, <span class="st">'/08_Analysis_XGBoost/models/'</span>)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>plots         <span class="ot">&lt;-</span> <span class="fu">paste0</span>(parentfolder, <span class="st">'/08_Analysis_XGBoost/plots/'</span>)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Packages </span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tibble) <span class="co"># Data Manipulation</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(stringr)</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse) <span class="co"># includes readr, tidyr, dplyr, ggplot2</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(data.table)</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggforce) <span class="co"># Plotting</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggpubr)</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gridExtra)</span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rpart) <span class="co"># Random Forests and XGBoost</span></span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rpart.plot)</span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ranger)</span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tuneRanger)</span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(caret)</span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(xgboost)</span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(parallel)</span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(mice)</span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(doParallel)</span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a><span class="co"># Use all available cores for parallel computing</span></span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">mc.cores =</span> parallel<span class="sc">::</span><span class="fu">detectCores</span>())</span>
<span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-30"><a href="#cb1-30" aria-hidden="true" tabindex="-1"></a>colorBlindBlack8  <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"#000000"</span>, <span class="st">"#E69F00"</span>, <span class="st">"#56B4E9"</span>, <span class="st">"#009E73"</span>, </span>
<span id="cb1-31"><a href="#cb1-31" aria-hidden="true" tabindex="-1"></a>                       <span class="st">"#F0E442"</span>, <span class="st">"#0072B2"</span>, <span class="st">"#D55E00"</span>, <span class="st">"#CC79A7"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="gesture" class="level1">
<h1>Gesture</h1>
<p>In the <a href="../08_Analysis_XGBoost/01_PCA_featureDimensions.html#sec-pca">previous script</a>, we have already separated trials into modalities and clean the resulting dataframes of superfluous columns so now we can directly load them and continue modelling.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Load in</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>data_ges <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="fu">paste0</span>(datasets, <span class="st">"ges_clean_df.csv"</span>))</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Make predictor a factor variable</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>data_ges<span class="sc">$</span>correction_info <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(data_ges<span class="sc">$</span>correction_info)</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Display </span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(data_ges, <span class="at">n=</span><span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 10 × 325
   arm_duration arm_inter_Kin arm_inter_IK arm_bbmv lowerbody_duration
          &lt;dbl&gt;         &lt;dbl&gt;        &lt;dbl&gt;    &lt;dbl&gt;              &lt;dbl&gt;
 1         3816          28.0         29.5    10.3                3244
 2         5280          28.1         30.9    13.4                5862
 3         4302          28.4         31.2    10.6                4206
 4         4474          27.3         30.4    10.2                4398
 5         4388          27.9         31.2     9.75               3782
 6         5852          29.4         32.0    10.7                5404
 7         2736          26.3         27.7     6.55                  0
 8         4256          28.7         29.8     8.15                  0
 9         2516          26.2         27.8     7.77                884
10         4504          28.6         30.9     9.94               4266
# ℹ 320 more variables: lowerbody_inter_Kin &lt;dbl&gt;, lowerbody_inter_IK &lt;dbl&gt;,
#   lowerbody_bbmv &lt;dbl&gt;, leg_duration &lt;dbl&gt;, leg_inter_Kin &lt;dbl&gt;,
#   leg_inter_IK &lt;dbl&gt;, leg_bbmv &lt;dbl&gt;, head_duration &lt;dbl&gt;,
#   head_inter_Kin &lt;dbl&gt;, head_inter_IK &lt;dbl&gt;, head_bbmv &lt;dbl&gt;,
#   arm_moment_sum_Gmean &lt;dbl&gt;, arm_moment_sum_Gstd &lt;dbl&gt;,
#   arm_moment_sum_pospeak_n &lt;dbl&gt;, arm_moment_sum_integral &lt;dbl&gt;,
#   arm_moment_sum_range &lt;dbl&gt;, arm_moment_sum_change_Gmean &lt;dbl&gt;, …</code></pre>
</div>
</div>
<section id="random-forests" class="level2">
<h2 class="anchored" data-anchor-id="random-forests">Random forests</h2>
<p>We will build a random forest first.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># prepare predictors</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>predictors <span class="ot">&lt;-</span> <span class="fu">setdiff</span>(<span class="fu">names</span>(data_ges), <span class="st">"correction_info"</span>)</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>formula_str <span class="ot">&lt;-</span> <span class="fu">paste</span>(<span class="st">"correction_info ~"</span>, <span class="fu">paste</span>(predictors, <span class="at">collapse =</span> <span class="st">" + "</span>))</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert the formula string to a formula object</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>gesTree_formula <span class="ot">&lt;-</span> <span class="fu">as.formula</span>(formula_str)</span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Now use the formula in rpart</span></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>gesTree <span class="ot">&lt;-</span> <span class="fu">rpart</span>(<span class="at">formula =</span> gesTree_formula, <span class="at">data =</span> data_ges, </span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>                <span class="at">method=</span><span class="st">'class'</span>, <span class="co"># Specify that it's a classification tree</span></span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>                <span class="at">control =</span> <span class="fu">rpart.control</span>(<span class="at">maxdepth =</span> <span class="dv">5</span>)  <span class="co"># Control parameters for the 'rpart' function</span></span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a><span class="fu">prp</span>(</span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a>  gesTree,         <span class="co"># The decision tree object to be visualized</span></span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a>  <span class="at">extra =</span> <span class="dv">1</span>,      <span class="co"># Show extra information (like node statistics) in the plot</span></span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a>  <span class="at">varlen =</span> <span class="dv">0</span>,     <span class="co"># Length of variable names (0 means auto-determined)</span></span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a>  <span class="at">faclen =</span> <span class="dv">0</span>     <span class="co"># Length of factor levels displayed on the plot (increase as needed)</span></span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="02_XGBoost_effortIndicators_files/figure-html/ges random forest-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Split the data</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># This method should ensure that all levels of our dependent variable are present in both sets</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Ensure each level is present in both sets</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>train_data <span class="ot">&lt;-</span> data_ges <span class="sc">%&gt;%</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(correction_info) <span class="sc">%&gt;%</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sample_frac</span>(<span class="fl">0.8</span>, <span class="at">replace =</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Assign the remaining samples to the test set</span></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>test_data <span class="ot">&lt;-</span> <span class="fu">anti_join</span>(data_ges, train_data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Building the untuned model.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Untuned Model with importance (permutation) option set</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>gesUntuned <span class="ot">&lt;-</span> <span class="fu">ranger</span>(</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">y =</span> train_data<span class="sc">$</span>correction_info,</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">x =</span> train_data[,<span class="dv">0</span><span class="sc">:</span><span class="dv">324</span>],</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">num.trees =</span> <span class="dv">500</span>,</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">importance =</span> <span class="st">"permutation"</span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>predictions <span class="ot">&lt;-</span> <span class="fu">predict</span>(gesUntuned, <span class="at">data =</span> test_data)<span class="sc">$</span>predictions</span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a confusion matrix</span></span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>confusion_matrix <span class="ot">&lt;-</span> <span class="fu">confusionMatrix</span>(predictions, test_data<span class="sc">$</span>correction_info)</span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Print the confusion matrix</span></span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(confusion_matrix)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Confusion Matrix and Statistics

          Reference
Prediction c0 c0_only c1 c2
   c0       0       2  1  0
   c0_only  1       0  0  0
   c1       0       0  0  1
   c2       0       0  0  0

Overall Statistics
                                     
               Accuracy : 0          
                 95% CI : (0, 0.5218)
    No Information Rate : 0.4        
    P-Value [Acc &gt; NIR] : 1          
                                     
                  Kappa : -0.3158    
                                     
 Mcnemar's Test P-Value : NA         

Statistics by Class:

                     Class: c0 Class: c0_only Class: c1 Class: c2
Sensitivity              0.000         0.0000     0.000       0.0
Specificity              0.250         0.6667     0.750       1.0
Pos Pred Value           0.000         0.0000     0.000       NaN
Neg Pred Value           0.500         0.5000     0.750       0.8
Prevalence               0.200         0.4000     0.200       0.2
Detection Rate           0.000         0.0000     0.000       0.0
Detection Prevalence     0.600         0.2000     0.200       0.0
Balanced Accuracy        0.125         0.3333     0.375       0.5</code></pre>
</div>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate feature importance</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>feature_importance <span class="ot">&lt;-</span> <span class="fu">importance</span>(gesUntuned, <span class="at">num.threads =</span> <span class="dv">1</span>, <span class="at">type =</span> <span class="dv">1</span>) </span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert to data frame</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>feature_importance <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(feature_importance, <span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span>)</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>feature_importance<span class="sc">$</span>Feature <span class="ot">&lt;-</span> <span class="fu">rownames</span>(feature_importance)</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(feature_importance) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Importance"</span>, <span class="st">"Feature"</span>)</span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Sort by importance</span></span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>sorted_feature_importance <span class="ot">&lt;-</span> feature_importance[<span class="fu">order</span>(<span class="sc">-</span>feature_importance<span class="sc">$</span>Importance), ]</span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Print sorted feature importance</span></span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(sorted_feature_importance, <span class="at">n=</span><span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                              Importance                      Feature
body_slope_95                0.005932540                body_slope_95
head_power_range             0.005242857             head_power_range
arm_speedKin_sum_pospeak_std 0.003863492 arm_speedKin_sum_pospeak_std
arm_speedKin_sum_pospeak_n   0.003602381   arm_speedKin_sum_pospeak_n
arm_inter_Kin                0.003116667                arm_inter_Kin
arm_accKin_sum_integral      0.002766667      arm_accKin_sum_integral
duration_mov                 0.002723810                 duration_mov
body_nComp_95                0.002709524                body_nComp_95
head_angSpeed_sum_range      0.002538095      head_angSpeed_sum_range
arm_accKin_sum_pospeak_std   0.002257143   arm_accKin_sum_pospeak_std</code></pre>
</div>
</div>
<p>Set the parameters for the random forest.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Define the number of CPU cores to use</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>num_cores <span class="ot">&lt;-</span> <span class="fu">detectCores</span>()</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a cluster with specified number of cores</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>cl <span class="ot">&lt;-</span> <span class="fu">makeCluster</span>(num_cores)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Tuning the random forest.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>tuneGes <span class="ot">&lt;-</span> <span class="fu">makeClassifTask</span>(<span class="at">data =</span> data_ges[,<span class="dv">0</span><span class="sc">:</span><span class="dv">325</span>],</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>                           <span class="at">target =</span> <span class="st">"correction_info"</span>)</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>tuneGes <span class="ot">&lt;-</span> <span class="fu">tuneRanger</span>(tuneGes,</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>                      <span class="at">measure =</span> <span class="fu">list</span>(multiclass.brier),</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>                      <span class="at">num.trees =</span> <span class="dv">500</span>)</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Return hyperparameter values</span></span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a><span class="co">#tuneGes</span></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Recommended parameter settings: </span></span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a><span class="co">#   mtry min.node.size sample.fraction</span></span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a><span class="co"># 1   57             4       0.2279307</span></span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Results: </span></span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a><span class="co">#   multiclass.brier exec.time</span></span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a><span class="co"># 1         0.790973     0.164</span></span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-18"><a href="#cb11-18" aria-hidden="true" tabindex="-1"></a>gesTuned <span class="ot">&lt;-</span> <span class="fu">ranger</span>(</span>
<span id="cb11-19"><a href="#cb11-19" aria-hidden="true" tabindex="-1"></a>  <span class="at">y =</span> train_data<span class="sc">$</span>correction_info,</span>
<span id="cb11-20"><a href="#cb11-20" aria-hidden="true" tabindex="-1"></a>  <span class="at">x =</span> train_data[,<span class="dv">0</span><span class="sc">:</span><span class="dv">324</span>], </span>
<span id="cb11-21"><a href="#cb11-21" aria-hidden="true" tabindex="-1"></a>  <span class="at">num.trees =</span> <span class="dv">5000</span>, </span>
<span id="cb11-22"><a href="#cb11-22" aria-hidden="true" tabindex="-1"></a>  <span class="at">mtry =</span> <span class="dv">57</span>, <span class="co"># Set the recommended mtry value (number of features).</span></span>
<span id="cb11-23"><a href="#cb11-23" aria-hidden="true" tabindex="-1"></a>  <span class="at">min.node.size =</span> <span class="dv">4</span>, <span class="co"># Set the recommended min.node.size value (number of samples before a node terminates).</span></span>
<span id="cb11-24"><a href="#cb11-24" aria-hidden="true" tabindex="-1"></a>  <span class="at">sample.fraction =</span> <span class="fl">0.2279307</span>, <span class="co"># Set the recommended sample fraction value.(% of data for bagging).</span></span>
<span id="cb11-25"><a href="#cb11-25" aria-hidden="true" tabindex="-1"></a>  <span class="at">importance =</span> <span class="st">"permutation"</span> <span class="co"># Permutation is a computationally intensive test.</span></span>
<span id="cb11-26"><a href="#cb11-26" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb11-27"><a href="#cb11-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-28"><a href="#cb11-28" aria-hidden="true" tabindex="-1"></a>predictions <span class="ot">&lt;-</span> <span class="fu">predict</span>(gesTuned, <span class="at">data =</span> test_data)<span class="sc">$</span>predictions</span>
<span id="cb11-29"><a href="#cb11-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-30"><a href="#cb11-30" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a confusion matrix</span></span>
<span id="cb11-31"><a href="#cb11-31" aria-hidden="true" tabindex="-1"></a>confusion_matrix <span class="ot">&lt;-</span> <span class="fu">confusionMatrix</span>(predictions, test_data<span class="sc">$</span>correction_info)</span>
<span id="cb11-32"><a href="#cb11-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-33"><a href="#cb11-33" aria-hidden="true" tabindex="-1"></a><span class="co"># Print the confusion matrix</span></span>
<span id="cb11-34"><a href="#cb11-34" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(confusion_matrix)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Confusion Matrix and Statistics

          Reference
Prediction c0 c0_only c1 c2
   c0       0       0  0  0
   c0_only  1       2  1  1
   c1       0       0  0  0
   c2       0       0  0  0

Overall Statistics
                                          
               Accuracy : 0.4             
                 95% CI : (0.0527, 0.8534)
    No Information Rate : 0.4             
    P-Value [Acc &gt; NIR] : 0.663           
                                          
                  Kappa : 0               
                                          
 Mcnemar's Test P-Value : NA              

Statistics by Class:

                     Class: c0 Class: c0_only Class: c1 Class: c2
Sensitivity                0.0            1.0       0.0       0.0
Specificity                1.0            0.0       1.0       1.0
Pos Pred Value             NaN            0.4       NaN       NaN
Neg Pred Value             0.8            NaN       0.8       0.8
Prevalence                 0.2            0.4       0.2       0.2
Detection Rate             0.0            0.4       0.0       0.0
Detection Prevalence       0.0            1.0       0.0       0.0
Balanced Accuracy          0.5            0.5       0.5       0.5</code></pre>
</div>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate feature importance</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>feature_importance <span class="ot">&lt;-</span> <span class="fu">importance</span>(gesTuned, <span class="at">num.threads =</span> <span class="dv">1</span>, <span class="at">type =</span> <span class="dv">1</span>) </span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert to data frame</span></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>feature_importance <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(feature_importance, <span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span>)</span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>feature_importance<span class="sc">$</span>Feature <span class="ot">&lt;-</span> <span class="fu">rownames</span>(feature_importance)</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(feature_importance) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Importance"</span>, <span class="st">"Feature"</span>)</span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Sort by importance</span></span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>sorted_feature_importance <span class="ot">&lt;-</span> feature_importance[<span class="fu">order</span>(<span class="sc">-</span>feature_importance<span class="sc">$</span>Importance), ]</span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Print sorted feature importance</span></span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(sorted_feature_importance, <span class="at">n=</span><span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                    Importance             Feature
arm_duration                 0        arm_duration
arm_inter_Kin                0       arm_inter_Kin
arm_inter_IK                 0        arm_inter_IK
arm_bbmv                     0            arm_bbmv
lowerbody_duration           0  lowerbody_duration
lowerbody_inter_Kin          0 lowerbody_inter_Kin
lowerbody_inter_IK           0  lowerbody_inter_IK
lowerbody_bbmv               0      lowerbody_bbmv
leg_duration                 0        leg_duration
leg_inter_Kin                0       leg_inter_Kin</code></pre>
</div>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Close the cluster when you're done with your parallel tasks</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="co">#stopCluster(cl)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Create a tuned model only.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a classification task for tuning</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>tuneGes <span class="ot">&lt;-</span> <span class="fu">makeClassifTask</span>(<span class="at">data =</span> train_data[, <span class="dv">0</span><span class="sc">:</span><span class="dv">325</span>], <span class="at">target =</span> <span class="st">"correction_info"</span>)</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Tune the model</span></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>tuneGes <span class="ot">&lt;-</span> <span class="fu">tuneRanger</span>(tuneGes, <span class="at">measure =</span> <span class="fu">list</span>(multiclass.brier), <span class="at">num.trees =</span> <span class="dv">500</span>)</span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Return hyperparameter values</span></span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a><span class="co">#tuneGes</span></span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Recommended parameter settings: </span></span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a><span class="co">#   mtry min.node.size sample.fraction</span></span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a><span class="co"># 1  221             3       0.2056429</span></span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Results: </span></span>
<span id="cb16-14"><a href="#cb16-14" aria-hidden="true" tabindex="-1"></a><span class="co">#   multiclass.brier exec.time</span></span>
<span id="cb16-15"><a href="#cb16-15" aria-hidden="true" tabindex="-1"></a><span class="co"># 1        0.8124712     0.168</span></span>
<span id="cb16-16"><a href="#cb16-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-17"><a href="#cb16-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit the tuned model on the training data</span></span>
<span id="cb16-18"><a href="#cb16-18" aria-hidden="true" tabindex="-1"></a>gesTuned <span class="ot">&lt;-</span> <span class="fu">ranger</span>(</span>
<span id="cb16-19"><a href="#cb16-19" aria-hidden="true" tabindex="-1"></a>  <span class="at">y =</span> train_data<span class="sc">$</span>correction_info,</span>
<span id="cb16-20"><a href="#cb16-20" aria-hidden="true" tabindex="-1"></a>  <span class="at">x =</span> train_data[, <span class="dv">0</span><span class="sc">:</span><span class="dv">324</span>],</span>
<span id="cb16-21"><a href="#cb16-21" aria-hidden="true" tabindex="-1"></a>  <span class="at">num.trees =</span> <span class="dv">5000</span>,</span>
<span id="cb16-22"><a href="#cb16-22" aria-hidden="true" tabindex="-1"></a>  <span class="at">mtry =</span> <span class="dv">221</span>,</span>
<span id="cb16-23"><a href="#cb16-23" aria-hidden="true" tabindex="-1"></a>  <span class="at">min.node.size =</span> <span class="dv">3</span>,</span>
<span id="cb16-24"><a href="#cb16-24" aria-hidden="true" tabindex="-1"></a>  <span class="at">sample.fraction =</span> <span class="fl">0.2056429</span>,</span>
<span id="cb16-25"><a href="#cb16-25" aria-hidden="true" tabindex="-1"></a>  <span class="at">importance =</span> <span class="st">"permutation"</span></span>
<span id="cb16-26"><a href="#cb16-26" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb16-27"><a href="#cb16-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-28"><a href="#cb16-28" aria-hidden="true" tabindex="-1"></a><span class="co"># Predict on the test data</span></span>
<span id="cb16-29"><a href="#cb16-29" aria-hidden="true" tabindex="-1"></a>predictions <span class="ot">&lt;-</span> <span class="fu">predict</span>(gesTuned, <span class="at">data =</span> test_data)<span class="sc">$</span>predictions</span>
<span id="cb16-30"><a href="#cb16-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-31"><a href="#cb16-31" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a confusion matrix</span></span>
<span id="cb16-32"><a href="#cb16-32" aria-hidden="true" tabindex="-1"></a>confusion_matrix <span class="ot">&lt;-</span> <span class="fu">confusionMatrix</span>(predictions, test_data<span class="sc">$</span>correction_info)</span>
<span id="cb16-33"><a href="#cb16-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-34"><a href="#cb16-34" aria-hidden="true" tabindex="-1"></a><span class="co"># Print the confusion matrix</span></span>
<span id="cb16-35"><a href="#cb16-35" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(confusion_matrix)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Confusion Matrix and Statistics

          Reference
Prediction c0 c0_only c1 c2
   c0       0       0  0  0
   c0_only  1       2  1  1
   c1       0       0  0  0
   c2       0       0  0  0

Overall Statistics
                                          
               Accuracy : 0.4             
                 95% CI : (0.0527, 0.8534)
    No Information Rate : 0.4             
    P-Value [Acc &gt; NIR] : 0.663           
                                          
                  Kappa : 0               
                                          
 Mcnemar's Test P-Value : NA              

Statistics by Class:

                     Class: c0 Class: c0_only Class: c1 Class: c2
Sensitivity                0.0            1.0       0.0       0.0
Specificity                1.0            0.0       1.0       1.0
Pos Pred Value             NaN            0.4       NaN       NaN
Neg Pred Value             0.8            NaN       0.8       0.8
Prevalence                 0.2            0.4       0.2       0.2
Detection Rate             0.0            0.4       0.0       0.0
Detection Prevalence       0.0            1.0       0.0       0.0
Balanced Accuracy          0.5            0.5       0.5       0.5</code></pre>
</div>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate feature importance</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>feature_importance <span class="ot">&lt;-</span> <span class="fu">importance</span>(gesTuned, <span class="at">num.threads =</span> <span class="dv">1</span>, <span class="at">type =</span> <span class="dv">1</span>)</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert to data frame</span></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>feature_importance_df <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(feature_importance, <span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span>)</span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>feature_importance_df<span class="sc">$</span>Feature <span class="ot">&lt;-</span> <span class="fu">rownames</span>(feature_importance_df)</span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(feature_importance_df) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Importance"</span>, <span class="st">"Feature"</span>)</span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Sort by importance</span></span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a>sorted_feature_importance <span class="ot">&lt;-</span> feature_importance_df[<span class="fu">order</span>(<span class="sc">-</span>feature_importance_df<span class="sc">$</span>Importance), ]</span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Print sorted feature importance</span></span>
<span id="cb18-13"><a href="#cb18-13" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(sorted_feature_importance, <span class="at">n=</span><span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                    Importance             Feature
arm_duration                 0        arm_duration
arm_inter_Kin                0       arm_inter_Kin
arm_inter_IK                 0        arm_inter_IK
arm_bbmv                     0            arm_bbmv
lowerbody_duration           0  lowerbody_duration
lowerbody_inter_Kin          0 lowerbody_inter_Kin
lowerbody_inter_IK           0  lowerbody_inter_IK
lowerbody_bbmv               0      lowerbody_bbmv
leg_duration                 0        leg_duration
leg_inter_Kin                0       leg_inter_Kin</code></pre>
</div>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Close the cluster when you're done with your parallel tasks</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a><span class="co">#stopCluster(cl)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Save data frame.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="fu">write.csv</span>(data_ges, <span class="at">file =</span> <span class="fu">paste0</span>(datasets, <span class="st">"gesDataXGB.csv"</span>), <span class="at">row.names =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="xgboost" class="level2">
<h2 class="anchored" data-anchor-id="xgboost">XGBoost</h2>
<p>Ensure parallel processing.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Detect the number of available cores</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>cores <span class="ot">&lt;-</span> <span class="fu">detectCores</span>() <span class="co">#- 1  # Leave one core free</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a cluster with the detected number of cores</span></span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>cl <span class="ot">&lt;-</span> <span class="fu">makeCluster</span>(cores)</span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Register the parallel backend</span></span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a><span class="fu">registerDoParallel</span>(cl)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Define the grid and estimate runtime.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>grid_tune <span class="ot">&lt;-</span> <span class="fu">expand.grid</span>(</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">nrounds =</span> <span class="fu">c</span>(<span class="dv">5000</span>, <span class="dv">10000</span>), </span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">max_depth =</span> <span class="fu">c</span>(<span class="dv">3</span>, <span class="dv">6</span>), </span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">eta =</span> <span class="fu">c</span>(<span class="fl">0.05</span>, <span class="fl">0.1</span>), </span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">gamma =</span> <span class="fu">c</span>(<span class="fl">0.1</span>), </span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">colsample_bytree =</span> <span class="fu">c</span>(<span class="fl">0.6</span>, <span class="fl">0.8</span>), </span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">min_child_weight =</span> <span class="fu">c</span>(<span class="dv">1</span>), </span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">subsample =</span> <span class="fu">c</span>(<span class="fl">0.75</span>, <span class="fl">1.0</span>)</span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate total combinations</span></span>
<span id="cb23-12"><a href="#cb23-12" aria-hidden="true" tabindex="-1"></a>total_combinations <span class="ot">&lt;-</span> <span class="fu">nrow</span>(grid_tune)</span>
<span id="cb23-13"><a href="#cb23-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-14"><a href="#cb23-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Estimate single model run time (assume 1 minute per run)</span></span>
<span id="cb23-15"><a href="#cb23-15" aria-hidden="true" tabindex="-1"></a>single_model_time <span class="ot">&lt;-</span> <span class="dv">10</span> <span class="co"># minute</span></span>
<span id="cb23-16"><a href="#cb23-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-17"><a href="#cb23-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Total runs for cross-validation</span></span>
<span id="cb23-18"><a href="#cb23-18" aria-hidden="true" tabindex="-1"></a>folds <span class="ot">&lt;-</span> <span class="dv">5</span></span>
<span id="cb23-19"><a href="#cb23-19" aria-hidden="true" tabindex="-1"></a>total_runs <span class="ot">&lt;-</span> total_combinations <span class="sc">*</span> folds</span>
<span id="cb23-20"><a href="#cb23-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-21"><a href="#cb23-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Total time estimation without parallel processing</span></span>
<span id="cb23-22"><a href="#cb23-22" aria-hidden="true" tabindex="-1"></a>total_time <span class="ot">&lt;-</span> total_runs <span class="sc">*</span> single_model_time <span class="co"># in minutes</span></span>
<span id="cb23-23"><a href="#cb23-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-24"><a href="#cb23-24" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert to hours</span></span>
<span id="cb23-25"><a href="#cb23-25" aria-hidden="true" tabindex="-1"></a>total_time_hours <span class="ot">&lt;-</span> total_time <span class="sc">/</span> <span class="dv">60</span></span>
<span id="cb23-26"><a href="#cb23-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-27"><a href="#cb23-27" aria-hidden="true" tabindex="-1"></a><span class="co"># Output estimated time without parallel processing</span></span>
<span id="cb23-28"><a href="#cb23-28" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">paste</span>(<span class="st">"Estimated time for grid search without parallel processing:"</span>, total_time_hours, <span class="st">"hours"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Estimated time for grid search without parallel processing: 26.6666666666667 hours"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Parallel processing with 4 cores</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>cores <span class="ot">&lt;-</span> <span class="dv">24</span></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>total_time_parallel <span class="ot">&lt;-</span> total_time <span class="sc">/</span> cores <span class="co"># in minutes</span></span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert to hours</span></span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>total_time_parallel_hours <span class="ot">&lt;-</span> total_time_parallel <span class="sc">/</span> <span class="dv">60</span></span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Output estimated time with parallel processing</span></span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">paste</span>(<span class="st">"Estimated time for grid search with"</span>, cores, <span class="st">"cores:"</span>, total_time_parallel_hours, <span class="st">"hours"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Estimated time for grid search with 24 cores: 1.11111111111111 hours"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(total_combinations,single_model_time,folds,total_runs,total_time,total_time_hours,total_time_parallel,total_time_parallel_hours,cores)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="k-fold-cross-validation" class="level4">
<h4 class="anchored" data-anchor-id="k-fold-cross-validation">K-fold cross-validation</h4>
<p>Create subsets to train and test data (80/20).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Set seed for reproducibility</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">998</span>)</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Set up train control</span></span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>train_control <span class="ot">&lt;-</span> <span class="fu">trainControl</span>(</span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">method =</span> <span class="st">"cv"</span>,        <span class="co"># Cross-validation</span></span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">number =</span> <span class="dv">5</span>,           <span class="co"># 5-fold cross-validation</span></span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">allowParallel =</span> <span class="cn">TRUE</span>  <span class="co"># Enable parallel processing</span></span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb28-10"><a href="#cb28-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-11"><a href="#cb28-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Define the number of subsets</span></span>
<span id="cb28-12"><a href="#cb28-12" aria-hidden="true" tabindex="-1"></a>numSubsets <span class="ot">&lt;-</span> <span class="dv">5</span></span>
<span id="cb28-13"><a href="#cb28-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-14"><a href="#cb28-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Load data if needed</span></span>
<span id="cb28-15"><a href="#cb28-15" aria-hidden="true" tabindex="-1"></a>gesDataXGB <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="fu">paste0</span>(datasets, <span class="st">"gesDataXGB.csv"</span>))</span>
<span id="cb28-16"><a href="#cb28-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-17"><a href="#cb28-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Ensure 'correction_info' is a factor</span></span>
<span id="cb28-18"><a href="#cb28-18" aria-hidden="true" tabindex="-1"></a>gesDataXGB<span class="sc">$</span>correction_info <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(gesDataXGB<span class="sc">$</span>correction_info)</span>
<span id="cb28-19"><a href="#cb28-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-20"><a href="#cb28-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Remove rows with only NA values</span></span>
<span id="cb28-21"><a href="#cb28-21" aria-hidden="true" tabindex="-1"></a>gesDataXGB <span class="ot">&lt;-</span> gesDataXGB[<span class="fu">rowSums</span>(<span class="fu">is.na</span>(gesDataXGB)) <span class="sc">&lt;</span> <span class="fu">ncol</span>(gesDataXGB), ]</span>
<span id="cb28-22"><a href="#cb28-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-23"><a href="#cb28-23" aria-hidden="true" tabindex="-1"></a><span class="co"># Split data by levels of 'correction_info'</span></span>
<span id="cb28-24"><a href="#cb28-24" aria-hidden="true" tabindex="-1"></a>correction_levels <span class="ot">&lt;-</span> <span class="fu">levels</span>(gesDataXGB<span class="sc">$</span>correction_info)</span>
<span id="cb28-25"><a href="#cb28-25" aria-hidden="true" tabindex="-1"></a>split_data <span class="ot">&lt;-</span> <span class="fu">split</span>(gesDataXGB, gesDataXGB<span class="sc">$</span>correction_info)</span>
<span id="cb28-26"><a href="#cb28-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-27"><a href="#cb28-27" aria-hidden="true" tabindex="-1"></a><span class="co"># Initialize a list to store subsets</span></span>
<span id="cb28-28"><a href="#cb28-28" aria-hidden="true" tabindex="-1"></a>gesSubsets <span class="ot">&lt;-</span> <span class="fu">vector</span>(<span class="st">"list"</span>, <span class="at">length =</span> numSubsets)</span>
<span id="cb28-29"><a href="#cb28-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-30"><a href="#cb28-30" aria-hidden="true" tabindex="-1"></a><span class="co"># Distribute rows for each level equally across subsets</span></span>
<span id="cb28-31"><a href="#cb28-31" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (level <span class="cf">in</span> correction_levels) {</span>
<span id="cb28-32"><a href="#cb28-32" aria-hidden="true" tabindex="-1"></a>  level_data <span class="ot">&lt;-</span> split_data[[level]]</span>
<span id="cb28-33"><a href="#cb28-33" aria-hidden="true" tabindex="-1"></a>  subset_sizes <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="fu">floor</span>(<span class="fu">nrow</span>(level_data) <span class="sc">/</span> numSubsets), numSubsets)</span>
<span id="cb28-34"><a href="#cb28-34" aria-hidden="true" tabindex="-1"></a>  remainder <span class="ot">&lt;-</span> <span class="fu">nrow</span>(level_data) <span class="sc">%%</span> numSubsets</span>
<span id="cb28-35"><a href="#cb28-35" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb28-36"><a href="#cb28-36" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Distribute remainder rows randomly</span></span>
<span id="cb28-37"><a href="#cb28-37" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (remainder <span class="sc">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb28-38"><a href="#cb28-38" aria-hidden="true" tabindex="-1"></a>    subset_sizes[<span class="fu">seq_len</span>(remainder)] <span class="ot">&lt;-</span> subset_sizes[<span class="fu">seq_len</span>(remainder)] <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb28-39"><a href="#cb28-39" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb28-40"><a href="#cb28-40" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb28-41"><a href="#cb28-41" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Shuffle rows of the level and assign to subsets</span></span>
<span id="cb28-42"><a href="#cb28-42" aria-hidden="true" tabindex="-1"></a>  shuffled_data <span class="ot">&lt;-</span> level_data[<span class="fu">sample</span>(<span class="fu">nrow</span>(level_data)), ]</span>
<span id="cb28-43"><a href="#cb28-43" aria-hidden="true" tabindex="-1"></a>  indices <span class="ot">&lt;-</span> <span class="fu">cumsum</span>(<span class="fu">c</span>(<span class="dv">0</span>, subset_sizes))</span>
<span id="cb28-44"><a href="#cb28-44" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb28-45"><a href="#cb28-45" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>numSubsets) {</span>
<span id="cb28-46"><a href="#cb28-46" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">is.null</span>(gesSubsets[[i]])) {</span>
<span id="cb28-47"><a href="#cb28-47" aria-hidden="true" tabindex="-1"></a>      gesSubsets[[i]] <span class="ot">&lt;-</span> shuffled_data[(indices[i] <span class="sc">+</span> <span class="dv">1</span>)<span class="sc">:</span>indices[i <span class="sc">+</span> <span class="dv">1</span>], ]</span>
<span id="cb28-48"><a href="#cb28-48" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb28-49"><a href="#cb28-49" aria-hidden="true" tabindex="-1"></a>      gesSubsets[[i]] <span class="ot">&lt;-</span> <span class="fu">rbind</span>(gesSubsets[[i]], shuffled_data[(indices[i] <span class="sc">+</span> <span class="dv">1</span>)<span class="sc">:</span>indices[i <span class="sc">+</span> <span class="dv">1</span>], ])</span>
<span id="cb28-50"><a href="#cb28-50" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb28-51"><a href="#cb28-51" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb28-52"><a href="#cb28-52" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb28-53"><a href="#cb28-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-54"><a href="#cb28-54" aria-hidden="true" tabindex="-1"></a><span class="co"># Naming the subsets</span></span>
<span id="cb28-55"><a href="#cb28-55" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(gesSubsets) <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"gesData"</span>, <span class="dv">1</span><span class="sc">:</span>numSubsets)</span>
<span id="cb28-56"><a href="#cb28-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-57"><a href="#cb28-57" aria-hidden="true" tabindex="-1"></a><span class="co"># Verify balance in subsets</span></span>
<span id="cb28-58"><a href="#cb28-58" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>numSubsets) {</span>
<span id="cb28-59"><a href="#cb28-59" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"Subset"</span>, i, <span class="st">"contains rows:"</span>, <span class="fu">nrow</span>(gesSubsets[[i]]), <span class="st">"and levels:</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb28-60"><a href="#cb28-60" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="fu">table</span>(gesSubsets[[i]]<span class="sc">$</span>correction_info))</span>
<span id="cb28-61"><a href="#cb28-61" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Subset 1 contains rows: 5 and levels:

     c0 c0_only      c1      c2 
      1       2       1       1 
Subset 2 contains rows: 5 and levels:

     c0 c0_only      c1      c2 
      1       2       1       1 
Subset 3 contains rows: 5 and levels:

     c0 c0_only      c1      c2 
      1       2       1       1 
Subset 4 contains rows: 5 and levels:

     c0 c0_only      c1      c2 
      1       1       1       1 
Subset 5 contains rows: 5 and levels:

     c0 c0_only      c1      c2 
      1       1       1       1 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Remove any rows with only NAs from subsets just to ensure cleanliness</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>gesSubsets <span class="ot">&lt;-</span> <span class="fu">lapply</span>(gesSubsets, <span class="cf">function</span>(subset) {</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>  subset[<span class="fu">rowSums</span>(<span class="fu">is.na</span>(subset)) <span class="sc">&lt;</span> <span class="fu">ncol</span>(subset), ]</span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Access the subsets</span></span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a>gesData1 <span class="ot">&lt;-</span> gesSubsets<span class="sc">$</span>gesData1</span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a>gesData2 <span class="ot">&lt;-</span> gesSubsets<span class="sc">$</span>gesData2</span>
<span id="cb30-9"><a href="#cb30-9" aria-hidden="true" tabindex="-1"></a>gesData3 <span class="ot">&lt;-</span> gesSubsets<span class="sc">$</span>gesData3</span>
<span id="cb30-10"><a href="#cb30-10" aria-hidden="true" tabindex="-1"></a>gesData4 <span class="ot">&lt;-</span> gesSubsets<span class="sc">$</span>gesData4</span>
<span id="cb30-11"><a href="#cb30-11" aria-hidden="true" tabindex="-1"></a>gesData5 <span class="ot">&lt;-</span> gesSubsets<span class="sc">$</span>gesData5</span>
<span id="cb30-12"><a href="#cb30-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-13"><a href="#cb30-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Combine subsets into 80% groups</span></span>
<span id="cb30-14"><a href="#cb30-14" aria-hidden="true" tabindex="-1"></a>gesData1234 <span class="ot">&lt;-</span> <span class="fu">rbind</span>(gesData1, gesData2, gesData3, gesData4)</span>
<span id="cb30-15"><a href="#cb30-15" aria-hidden="true" tabindex="-1"></a>gesData1235 <span class="ot">&lt;-</span> <span class="fu">rbind</span>(gesData1, gesData2, gesData3, gesData5)</span>
<span id="cb30-16"><a href="#cb30-16" aria-hidden="true" tabindex="-1"></a>gesData1245 <span class="ot">&lt;-</span> <span class="fu">rbind</span>(gesData1, gesData2, gesData4, gesData5)</span>
<span id="cb30-17"><a href="#cb30-17" aria-hidden="true" tabindex="-1"></a>gesData1345 <span class="ot">&lt;-</span> <span class="fu">rbind</span>(gesData1, gesData3, gesData4, gesData5)</span>
<span id="cb30-18"><a href="#cb30-18" aria-hidden="true" tabindex="-1"></a>gesData2345 <span class="ot">&lt;-</span> <span class="fu">rbind</span>(gesData2, gesData3, gesData4, gesData5)</span>
<span id="cb30-19"><a href="#cb30-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-20"><a href="#cb30-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Final verification of all levels in the combined datasets</span></span>
<span id="cb30-21"><a href="#cb30-21" aria-hidden="true" tabindex="-1"></a>combined_sets <span class="ot">&lt;-</span> <span class="fu">list</span>(gesData1234, gesData1235, gesData1245, gesData1345, gesData2345)</span>
<span id="cb30-22"><a href="#cb30-22" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(combined_sets) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"gesData1234"</span>, <span class="st">"gesData1235"</span>, <span class="st">"gesData1245"</span>, <span class="st">"gesData1345"</span>, <span class="st">"gesData2345"</span>)</span>
<span id="cb30-23"><a href="#cb30-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-24"><a href="#cb30-24" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (set_name <span class="cf">in</span> <span class="fu">names</span>(combined_sets)) {</span>
<span id="cb30-25"><a href="#cb30-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"Dataset"</span>, set_name, <span class="st">"contains rows:"</span>, <span class="fu">nrow</span>(combined_sets[[set_name]]), <span class="st">"and levels:</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb30-26"><a href="#cb30-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="fu">table</span>(combined_sets[[set_name]]<span class="sc">$</span>correction_info))</span>
<span id="cb30-27"><a href="#cb30-27" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Dataset gesData1234 contains rows: 19 and levels:

     c0 c0_only      c1      c2 
      4       7       4       4 
Dataset gesData1235 contains rows: 19 and levels:

     c0 c0_only      c1      c2 
      4       7       4       4 
Dataset gesData1245 contains rows: 18 and levels:

     c0 c0_only      c1      c2 
      4       6       4       4 
Dataset gesData1345 contains rows: 18 and levels:

     c0 c0_only      c1      c2 
      4       6       4       4 
Dataset gesData2345 contains rows: 18 and levels:

     c0 c0_only      c1      c2 
      4       6       4       4 </code></pre>
</div>
</div>
</section>
<section id="models" class="level3">
<h3 class="anchored" data-anchor-id="models">Models</h3>
<p>Only run the models one time and then readRDS.</p>
<section id="model-1" class="level4">
<h4 class="anchored" data-anchor-id="model-1">Model 1</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>gesModel1 <span class="ot">&lt;-</span> caret<span class="sc">::</span><span class="fu">train</span>(</span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>  correction_info <span class="sc">~</span> .,              </span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> gesData1234,</span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">method =</span> <span class="st">"xgbTree"</span>,     </span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">trControl =</span> train_control,</span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">tuneGrid =</span> grid_tune    </span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb32-8"><a href="#cb32-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-9"><a href="#cb32-9" aria-hidden="true" tabindex="-1"></a><span class="fu">saveRDS</span>(gesModel1, <span class="at">file =</span> <span class="fu">paste0</span>(models, <span class="st">"gesModel1.rds"</span>), <span class="at">compress =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="model-2" class="level4">
<h4 class="anchored" data-anchor-id="model-2">Model 2</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>gesModel2 <span class="ot">&lt;-</span> caret<span class="sc">::</span><span class="fu">train</span>(</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>  correction_info <span class="sc">~</span> .,              </span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> gesData1235,</span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">method =</span> <span class="st">"xgbTree"</span>,     </span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">trControl =</span> train_control,</span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">tuneGrid =</span> grid_tune    </span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-9"><a href="#cb33-9" aria-hidden="true" tabindex="-1"></a><span class="fu">saveRDS</span>(gesModel2, <span class="at">file =</span> <span class="fu">paste0</span>(models, <span class="st">"gesModel2.rds"</span>), <span class="at">compress =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="model-3" class="level4">
<h4 class="anchored" data-anchor-id="model-3">Model 3</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>gesModel3 <span class="ot">&lt;-</span> caret<span class="sc">::</span><span class="fu">train</span>(</span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>  correction_info <span class="sc">~</span> .,              </span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> gesData1245,</span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">method =</span> <span class="st">"xgbTree"</span>,     </span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">trControl =</span> train_control,</span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">tuneGrid =</span> grid_tune    </span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb34-8"><a href="#cb34-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-9"><a href="#cb34-9" aria-hidden="true" tabindex="-1"></a><span class="fu">saveRDS</span>(gesModel3, <span class="at">file =</span> <span class="fu">paste0</span>(models, <span class="st">"gesModel3.rds"</span>), <span class="at">compress =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="model-4" class="level4">
<h4 class="anchored" data-anchor-id="model-4">Model 4</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>gesModel4 <span class="ot">&lt;-</span> caret<span class="sc">::</span><span class="fu">train</span>(</span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>  correction_info <span class="sc">~</span> .,              </span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> gesData1345,</span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">method =</span> <span class="st">"xgbTree"</span>,     </span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">trControl =</span> train_control,</span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">tuneGrid =</span> grid_tune    </span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a><span class="fu">saveRDS</span>(gesModel4, <span class="at">file =</span> <span class="fu">paste0</span>(models, <span class="st">"gesModel4.rds"</span>), <span class="at">compress =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="model-5" class="level4">
<h4 class="anchored" data-anchor-id="model-5">Model 5</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>gesModel5 <span class="ot">&lt;-</span> caret<span class="sc">::</span><span class="fu">train</span>(</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>  correction_info <span class="sc">~</span> .,              </span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> gesData2345,</span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">method =</span> <span class="st">"xgbTree"</span>,     </span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">trControl =</span> train_control,</span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">tuneGrid =</span> grid_tune    </span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb36-8"><a href="#cb36-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-9"><a href="#cb36-9" aria-hidden="true" tabindex="-1"></a><span class="fu">saveRDS</span>(gesModel5, <span class="at">file =</span> <span class="fu">paste0</span>(models, <span class="st">"gesModel5.rds"</span>), <span class="at">compress =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="load-models" class="level4">
<h4 class="anchored" data-anchor-id="load-models">Load models</h4>
<p>Load all models after running, if necessary.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>gesModel1 <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="fu">paste0</span>(models, <span class="st">"gesModel1.rds"</span>))</span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>gesModel2 <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="fu">paste0</span>(models, <span class="st">"gesModel2.rds"</span>))</span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>gesModel3 <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="fu">paste0</span>(models, <span class="st">"gesModel3.rds"</span>))</span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a>gesModel4 <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="fu">paste0</span>(models, <span class="st">"gesModel4.rds"</span>))</span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a>gesModel5 <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="fu">paste0</span>(models, <span class="st">"gesModel5.rds"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="test-models" class="level4">
<h4 class="anchored" data-anchor-id="test-models">Test models</h4>
<p>Generate predictions and confusion matrices</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate predictions</span></span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>gesPredictions1 <span class="ot">&lt;-</span> <span class="fu">predict</span>(gesModel1, <span class="at">newdata =</span> gesData5)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[16:53:33] WARNING: src/learner.cc:553: 
  If you are loading a serialized model (like pickle in Python, RDS in R) generated by
  older XGBoost, please export the model by calling `Booster.save_model` from that version
  first, then load it back in current version. See:

    https://xgboost.readthedocs.io/en/latest/tutorials/saving_model.html

  for more details about differences between saving model and serializing.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>gesPredictions2 <span class="ot">&lt;-</span> <span class="fu">predict</span>(gesModel2, <span class="at">newdata =</span> gesData4)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[16:53:33] WARNING: src/learner.cc:553: 
  If you are loading a serialized model (like pickle in Python, RDS in R) generated by
  older XGBoost, please export the model by calling `Booster.save_model` from that version
  first, then load it back in current version. See:

    https://xgboost.readthedocs.io/en/latest/tutorials/saving_model.html

  for more details about differences between saving model and serializing.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>gesPredictions3 <span class="ot">&lt;-</span> <span class="fu">predict</span>(gesModel3, <span class="at">newdata =</span> gesData3)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[16:53:33] WARNING: src/learner.cc:553: 
  If you are loading a serialized model (like pickle in Python, RDS in R) generated by
  older XGBoost, please export the model by calling `Booster.save_model` from that version
  first, then load it back in current version. See:

    https://xgboost.readthedocs.io/en/latest/tutorials/saving_model.html

  for more details about differences between saving model and serializing.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>gesPredictions4 <span class="ot">&lt;-</span> <span class="fu">predict</span>(gesModel4, <span class="at">newdata =</span> gesData2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[16:53:33] WARNING: src/learner.cc:553: 
  If you are loading a serialized model (like pickle in Python, RDS in R) generated by
  older XGBoost, please export the model by calling `Booster.save_model` from that version
  first, then load it back in current version. See:

    https://xgboost.readthedocs.io/en/latest/tutorials/saving_model.html

  for more details about differences between saving model and serializing.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>gesPredictions5 <span class="ot">&lt;-</span> <span class="fu">predict</span>(gesModel5, <span class="at">newdata =</span> gesData1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[16:53:34] WARNING: src/learner.cc:553: 
  If you are loading a serialized model (like pickle in Python, RDS in R) generated by
  older XGBoost, please export the model by calling `Booster.save_model` from that version
  first, then load it back in current version. See:

    https://xgboost.readthedocs.io/en/latest/tutorials/saving_model.html

  for more details about differences between saving model and serializing.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute confusion matrices</span></span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>gesCm1 <span class="ot">&lt;-</span> <span class="fu">confusionMatrix</span>(gesPredictions1, gesData5<span class="sc">$</span>correction_info)</span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a>gesCm2 <span class="ot">&lt;-</span> <span class="fu">confusionMatrix</span>(gesPredictions2, gesData4<span class="sc">$</span>correction_info)</span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a>gesCm3 <span class="ot">&lt;-</span> <span class="fu">confusionMatrix</span>(gesPredictions3, gesData3<span class="sc">$</span>correction_info)</span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a>gesCm4 <span class="ot">&lt;-</span> <span class="fu">confusionMatrix</span>(gesPredictions4, gesData2<span class="sc">$</span>correction_info)</span>
<span id="cb48-6"><a href="#cb48-6" aria-hidden="true" tabindex="-1"></a>gesCm5 <span class="ot">&lt;-</span> <span class="fu">confusionMatrix</span>(gesPredictions5, gesData1<span class="sc">$</span>correction_info)</span>
<span id="cb48-7"><a href="#cb48-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-8"><a href="#cb48-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract p-values (you need to define how to extract these based on your metric, here assumed to be some metric from confusion matrix)</span></span>
<span id="cb48-9"><a href="#cb48-9" aria-hidden="true" tabindex="-1"></a>gesPValues <span class="ot">&lt;-</span> <span class="fu">c</span>(gesCm1<span class="sc">$</span>overall[<span class="st">'AccuracyPValue'</span>], </span>
<span id="cb48-10"><a href="#cb48-10" aria-hidden="true" tabindex="-1"></a>              gesCm2<span class="sc">$</span>overall[<span class="st">'AccuracyPValue'</span>], </span>
<span id="cb48-11"><a href="#cb48-11" aria-hidden="true" tabindex="-1"></a>              gesCm3<span class="sc">$</span>overall[<span class="st">'AccuracyPValue'</span>], </span>
<span id="cb48-12"><a href="#cb48-12" aria-hidden="true" tabindex="-1"></a>              gesCm4<span class="sc">$</span>overall[<span class="st">'AccuracyPValue'</span>], </span>
<span id="cb48-13"><a href="#cb48-13" aria-hidden="true" tabindex="-1"></a>              gesCm5<span class="sc">$</span>overall[<span class="st">'AccuracyPValue'</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Combine p-values using Fisher’s method</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Fisher's method</span></span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a>gesFisher_combined <span class="ot">&lt;-</span> <span class="sc">-</span><span class="dv">2</span> <span class="sc">*</span> <span class="fu">sum</span>(<span class="fu">log</span>(gesPValues))</span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="dv">2</span> <span class="sc">*</span> <span class="fu">length</span>(gesPValues)</span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a>gesPCcombined_fisher <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="sc">-</span> <span class="fu">pchisq</span>(gesFisher_combined, df)</span>
<span id="cb49-5"><a href="#cb49-5" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(gesPCcombined_fisher)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.630725</code></pre>
</div>
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Stouffer's method</span></span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a>gesZ_scores <span class="ot">&lt;-</span> <span class="fu">qnorm</span>(<span class="dv">1</span> <span class="sc">-</span> gesPValues<span class="sc">/</span><span class="dv">2</span>)</span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a>gesCombined_z <span class="ot">&lt;-</span> <span class="fu">sum</span>(gesZ_scores) <span class="sc">/</span> <span class="fu">sqrt</span>(<span class="fu">length</span>(gesPValues))</span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a>gesP_combined_stouffer <span class="ot">&lt;-</span> <span class="dv">2</span> <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">-</span> <span class="fu">pnorm</span>(<span class="fu">abs</span>(gesCombined_z)))</span>
<span id="cb51-5"><a href="#cb51-5" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(gesP_combined_stouffer)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.1239873</code></pre>
</div>
</div>
<p>The p-values should sum up to 0. Currently we do not have enough data.</p>
</section>
<section id="feature-importance" class="level4">
<h4 class="anchored" data-anchor-id="feature-importance">Feature importance</h4>
<section id="model-1-1" class="level5">
<h5 class="anchored" data-anchor-id="model-1-1">Model 1</h5>
<div class="cell">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a>XGBgesModel1 <span class="ot">&lt;-</span> gesModel1<span class="sc">$</span>finalModel</span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a>importanceXGBgesModel1 <span class="ot">&lt;-</span> <span class="fu">xgb.importance</span>(<span class="at">model =</span> XGBgesModel1)</span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(importanceXGBgesModel1, <span class="at">n=</span><span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                        Feature       Gain      Cover  Frequency
                         &lt;char&gt;      &lt;num&gt;      &lt;num&gt;      &lt;num&gt;
 1: arm_moment_sum_change_range 0.10621775 0.06140352 0.05448718
 2:            head_power_range 0.08514769 0.07967481 0.08012821
 3:             head_power_Gstd 0.06856142 0.05235004 0.04807692
 4:  arm_moment_sum_change_Gstd 0.05890059 0.05588046 0.05769231
 5:               body_slope_95 0.04080824 0.04771831 0.04487179
 6:        lowerbody_power_Gstd 0.03443709 0.02881254 0.02884615
 7:  spine_moment_sum_pospeak_n 0.03367215 0.02497264 0.01923077
 8:                arm_duration 0.03270931 0.02571379 0.02564103
 9:        arm_moment_sum_Gmean 0.02745091 0.02582984 0.02564103
10:  arm_angSpeed_sum_pospeak_n 0.02553955 0.01598632 0.01282051</code></pre>
</div>
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="fu">xgb.plot.importance</span>(importanceXGBgesModel1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="02_XGBoost_effortIndicators_files/figure-html/ges feature importance 1-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="model-2-1" class="level5">
<h5 class="anchored" data-anchor-id="model-2-1">Model 2</h5>
<div class="cell">
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a>XGBgesModel2 <span class="ot">&lt;-</span> gesModel2<span class="sc">$</span>finalModel</span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a>importanceXGBgesModel2 <span class="ot">&lt;-</span> <span class="fu">xgb.importance</span>(<span class="at">model =</span> XGBgesModel2)</span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(importanceXGBgesModel2, <span class="at">n=</span><span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                              Feature       Gain      Cover Frequency
                               &lt;char&gt;      &lt;num&gt;      &lt;num&gt;     &lt;num&gt;
 1:        arm_moment_sum_change_Gstd 0.15656328 0.10177312  0.093750
 2:                  head_power_range 0.08191146 0.09313640  0.087500
 3:             head_moment_sum_Gmean 0.05615654 0.04697675  0.037500
 4: lowerbody_jerkKin_sum_pospeak_std 0.04383749 0.02855344  0.025000
 5:                     body_slope_95 0.04140191 0.04229001  0.037500
 6:       arm_moment_sum_change_range 0.04046465 0.03485711  0.034375
 7:              head_angAcc_sum_Gstd 0.02922143 0.02022442  0.018750
 8:                    head_inter_Kin 0.02911760 0.02318121  0.025000
 9:     pelvis_moment_sum_pospeak_std 0.02902350 0.02526397  0.025000
10:                      arm_nComp_80 0.02862824 0.02214754  0.018750</code></pre>
</div>
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a><span class="fu">xgb.plot.importance</span>(importanceXGBgesModel2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="02_XGBoost_effortIndicators_files/figure-html/ges feature importance 2-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="model-3-1" class="level5">
<h5 class="anchored" data-anchor-id="model-3-1">Model 3</h5>
<div class="cell">
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a>XGBgesModel3 <span class="ot">&lt;-</span> gesModel3<span class="sc">$</span>finalModel</span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a>importanceXGBgesModel3 <span class="ot">&lt;-</span> <span class="fu">xgb.importance</span>(<span class="at">model =</span> XGBgesModel3)</span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(importanceXGBgesModel3, <span class="at">n=</span><span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                               Feature       Gain      Cover  Frequency
                                &lt;char&gt;      &lt;num&gt;      &lt;num&gt;      &lt;num&gt;
 1:               arm_moment_sum_Gmean 0.08511288 0.07536878 0.07468124
 2:        arm_moment_sum_change_range 0.06728393 0.05329511 0.04918033
 3:                   head_power_range 0.06628795 0.04044630 0.03278689
 4:               head_angAcc_sum_Gstd 0.06543792 0.08684720 0.09836066
 5:         arm_moment_sum_change_Gstd 0.06096995 0.05092504 0.04918033
 6: head_moment_sum_change_pospeak_std 0.06096008 0.04739633 0.03825137
 7: leg_moment_sum_change_pospeak_mean 0.05280459 0.04304653 0.03825137
 8:                       arm_duration 0.04014164 0.03501963 0.03460838
 9:               head_moment_sum_Gstd 0.03976587 0.03494228 0.03096539
10:           leg_moment_sum_pospeak_n 0.03297082 0.02711725 0.02367942</code></pre>
</div>
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a><span class="fu">xgb.plot.importance</span>(importanceXGBgesModel3)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="02_XGBoost_effortIndicators_files/figure-html/ges feature importance 3-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="model-4-1" class="level5">
<h5 class="anchored" data-anchor-id="model-4-1">Model 4</h5>
<div class="cell">
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a>XGBgesModel4 <span class="ot">&lt;-</span> gesModel4<span class="sc">$</span>finalModel</span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a>importanceXGBgesModel4 <span class="ot">&lt;-</span> <span class="fu">xgb.importance</span>(<span class="at">model =</span> XGBgesModel4)</span>
<span id="cb62-3"><a href="#cb62-3" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(importanceXGBgesModel4, <span class="at">n=</span><span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                        Feature       Gain      Cover  Frequency
                         &lt;char&gt;      &lt;num&gt;      &lt;num&gt;      &lt;num&gt;
 1:                arm_inter_IK 0.16009713 0.10406014 0.09335727
 2:              head_inter_Kin 0.11882778 0.09862493 0.10053860
 3:        arm_moment_sum_Gmean 0.06599796 0.06139296 0.05206463
 4:                arm_duration 0.05548316 0.04347284 0.03949731
 5:               arm_inter_Kin 0.05482641 0.04860660 0.04308797
 6:       head_moment_sum_Gmean 0.05183538 0.05242433 0.04667864
 7:      leg_power_pospeak_mean 0.05120850 0.04967961 0.05026930
 8: arm_moment_sum_pospeak_mean 0.02549236 0.02261922 0.02333932
 9:            head_power_Gmean 0.02352650 0.01920458 0.01436266
10:    head_moment_sum_integral 0.02241479 0.02772374 0.02692998</code></pre>
</div>
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a><span class="fu">xgb.plot.importance</span>(importanceXGBgesModel4)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="02_XGBoost_effortIndicators_files/figure-html/ges feature importance 4-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="model-5-1" class="level5">
<h5 class="anchored" data-anchor-id="model-5-1">Model 5</h5>
<div class="cell">
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a>XGBgesModel5 <span class="ot">&lt;-</span> gesModel5<span class="sc">$</span>finalModel</span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a>importanceXGBgesModel5 <span class="ot">&lt;-</span> <span class="fu">xgb.importance</span>(<span class="at">model =</span> XGBgesModel5)</span>
<span id="cb65-3"><a href="#cb65-3" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(importanceXGBgesModel5, <span class="at">n=</span><span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                          Feature       Gain      Cover  Frequency
                           &lt;char&gt;      &lt;num&gt;      &lt;num&gt;      &lt;num&gt;
 1:           arm_moment_sum_Gstd 0.13850676 0.10096313 0.08521739
 2:   arm_moment_sum_change_range 0.06521056 0.05179674 0.05217391
 3:          arm_moment_sum_range 0.05274530 0.04044015 0.03478261
 4:                head_inter_Kin 0.04433975 0.05737692 0.06434783
 5:                  arm_coupling 0.04294857 0.03466822 0.03130435
 6:              head_power_range 0.03782498 0.04249504 0.04347826
 7: pelvis_moment_sum_pospeak_std 0.03779493 0.03732779 0.03826087
 8:                  arm_slope_95 0.03164522 0.02732536 0.02782609
 9:                leg_power_Gstd 0.02771742 0.02463017 0.02434783
10:           head_power_integral 0.02668085 0.02211122 0.01739130</code></pre>
</div>
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a><span class="fu">xgb.plot.importance</span>(importanceXGBgesModel5)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="02_XGBoost_effortIndicators_files/figure-html/ges feature importance 5-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="cumulative-feature-importance" class="level4">
<h4 class="anchored" data-anchor-id="cumulative-feature-importance">Cumulative feature importance</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Function to extract and normalize importance</span></span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a>get_normalized_importance <span class="ot">&lt;-</span> <span class="cf">function</span>(model) {</span>
<span id="cb68-3"><a href="#cb68-3" aria-hidden="true" tabindex="-1"></a>  importance <span class="ot">&lt;-</span> <span class="fu">xgb.importance</span>(<span class="at">model =</span> model)</span>
<span id="cb68-4"><a href="#cb68-4" aria-hidden="true" tabindex="-1"></a>  importance<span class="sc">$</span>Gain <span class="ot">&lt;-</span> importance<span class="sc">$</span>Gain <span class="sc">/</span> <span class="fu">sum</span>(importance<span class="sc">$</span>Gain)</span>
<span id="cb68-5"><a href="#cb68-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(importance)</span>
<span id="cb68-6"><a href="#cb68-6" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb68-7"><a href="#cb68-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-8"><a href="#cb68-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract normalized importance for each model</span></span>
<span id="cb68-9"><a href="#cb68-9" aria-hidden="true" tabindex="-1"></a>gesImportance1 <span class="ot">&lt;-</span> <span class="fu">get_normalized_importance</span>(gesModel1<span class="sc">$</span>finalModel)</span>
<span id="cb68-10"><a href="#cb68-10" aria-hidden="true" tabindex="-1"></a>gesImportance2 <span class="ot">&lt;-</span> <span class="fu">get_normalized_importance</span>(gesModel2<span class="sc">$</span>finalModel)</span>
<span id="cb68-11"><a href="#cb68-11" aria-hidden="true" tabindex="-1"></a>gesImportance3 <span class="ot">&lt;-</span> <span class="fu">get_normalized_importance</span>(gesModel3<span class="sc">$</span>finalModel)</span>
<span id="cb68-12"><a href="#cb68-12" aria-hidden="true" tabindex="-1"></a>gesImportance4 <span class="ot">&lt;-</span> <span class="fu">get_normalized_importance</span>(gesModel4<span class="sc">$</span>finalModel)</span>
<span id="cb68-13"><a href="#cb68-13" aria-hidden="true" tabindex="-1"></a>gesImportance5 <span class="ot">&lt;-</span> <span class="fu">get_normalized_importance</span>(gesModel5<span class="sc">$</span>finalModel)</span>
<span id="cb68-14"><a href="#cb68-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-15"><a href="#cb68-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Combine importances</span></span>
<span id="cb68-16"><a href="#cb68-16" aria-hidden="true" tabindex="-1"></a>gesAllImportances <span class="ot">&lt;-</span> <span class="fu">list</span>(gesImportance1, gesImportance2, gesImportance3, gesImportance4, gesImportance5)</span>
<span id="cb68-17"><a href="#cb68-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-18"><a href="#cb68-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Function to merge importances</span></span>
<span id="cb68-19"><a href="#cb68-19" aria-hidden="true" tabindex="-1"></a>merge_importances <span class="ot">&lt;-</span> <span class="cf">function</span>(importances) {</span>
<span id="cb68-20"><a href="#cb68-20" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">2</span><span class="sc">:</span><span class="fu">length</span>(importances)) {</span>
<span id="cb68-21"><a href="#cb68-21" aria-hidden="true" tabindex="-1"></a>    <span class="fu">names</span>(importances[[i]])[<span class="dv">2</span><span class="sc">:</span><span class="dv">4</span>] <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="fu">names</span>(importances[[i]])[<span class="dv">2</span><span class="sc">:</span><span class="dv">4</span>], <span class="st">"_"</span>, i)</span>
<span id="cb68-22"><a href="#cb68-22" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb68-23"><a href="#cb68-23" aria-hidden="true" tabindex="-1"></a>  merged <span class="ot">&lt;-</span> <span class="fu">Reduce</span>(<span class="cf">function</span>(x, y) <span class="fu">merge</span>(x, y, <span class="at">by =</span> <span class="st">"Feature"</span>, <span class="at">all =</span> <span class="cn">TRUE</span>), importances)</span>
<span id="cb68-24"><a href="#cb68-24" aria-hidden="true" tabindex="-1"></a>  merged[<span class="fu">is.na</span>(merged)] <span class="ot">&lt;-</span> <span class="dv">0</span>  <span class="co"># Replace NAs with 0</span></span>
<span id="cb68-25"><a href="#cb68-25" aria-hidden="true" tabindex="-1"></a>  gain_cols <span class="ot">&lt;-</span> <span class="fu">grep</span>(<span class="st">"Gain"</span>, <span class="fu">colnames</span>(merged), <span class="at">value =</span> <span class="cn">TRUE</span>)</span>
<span id="cb68-26"><a href="#cb68-26" aria-hidden="true" tabindex="-1"></a>  merged<span class="sc">$</span>Cumulative <span class="ot">&lt;-</span> <span class="fu">rowSums</span>(merged[, ..gain_cols])</span>
<span id="cb68-27"><a href="#cb68-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(merged[, .(Feature, Cumulative)])</span>
<span id="cb68-28"><a href="#cb68-28" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb68-29"><a href="#cb68-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-30"><a href="#cb68-30" aria-hidden="true" tabindex="-1"></a><span class="co"># Merge and sort importances</span></span>
<span id="cb68-31"><a href="#cb68-31" aria-hidden="true" tabindex="-1"></a>gesCumulativeImportance <span class="ot">&lt;-</span> <span class="fu">merge_importances</span>(gesAllImportances)</span>
<span id="cb68-32"><a href="#cb68-32" aria-hidden="true" tabindex="-1"></a>gesCumulativeImportance <span class="ot">&lt;-</span> gesCumulativeImportance[<span class="fu">order</span>(<span class="sc">-</span>gesCumulativeImportance<span class="sc">$</span>Cumulative), ]</span>
<span id="cb68-33"><a href="#cb68-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-34"><a href="#cb68-34" aria-hidden="true" tabindex="-1"></a><span class="co"># Print cumulative feature importance</span></span>
<span id="cb68-35"><a href="#cb68-35" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(gesCumulativeImportance, <span class="at">n=</span><span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                        Feature Cumulative
                         &lt;char&gt;      &lt;num&gt;
 1:  arm_moment_sum_change_Gstd  0.3030472
 2:            head_power_range  0.2885670
 3: arm_moment_sum_change_range  0.2857463
 4:              head_inter_Kin  0.2163460
 5:        arm_moment_sum_Gmean  0.2162907
 6:                arm_inter_IK  0.2116572
 7:         arm_moment_sum_Gstd  0.1714339
 8:                arm_duration  0.1674509
 9:       head_moment_sum_Gmean  0.1308098
10:        head_angAcc_sum_Gstd  0.1161849</code></pre>
</div>
</div>
</section>
<section id="pca" class="level4">
<h4 class="anchored" data-anchor-id="pca">PCA</h4>
<p>Now, to select features along different (uncorrelated) dimensions, we want to connect these results with the results of PCA we performed in <a href="../08_Analysis_XGBoost/01_PCA_featureDimensions.html#sec-pca">this script</a>.</p>
<div class="cell">
<details class="code-fold">
<summary>Custom function</summary>
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Function to select top 3 features per component</span></span>
<span id="cb70-2"><a href="#cb70-2" aria-hidden="true" tabindex="-1"></a>select_top_features <span class="ot">&lt;-</span> <span class="cf">function</span>(pc_column, xgb_importance, <span class="at">top_n =</span> <span class="dv">3</span>) {</span>
<span id="cb70-3"><a href="#cb70-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-4"><a href="#cb70-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Find common features ranked by XGBoost importance</span></span>
<span id="cb70-5"><a href="#cb70-5" aria-hidden="true" tabindex="-1"></a>  common_features <span class="ot">&lt;-</span> <span class="fu">intersect</span>(pc_column, xgb_importance<span class="sc">$</span>Feature)</span>
<span id="cb70-6"><a href="#cb70-6" aria-hidden="true" tabindex="-1"></a>  common_features <span class="ot">&lt;-</span> xgb_importance <span class="sc">%&gt;%</span></span>
<span id="cb70-7"><a href="#cb70-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(Feature <span class="sc">%in%</span> common_features) <span class="sc">%&gt;%</span></span>
<span id="cb70-8"><a href="#cb70-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">arrange</span>(Rank) <span class="sc">%&gt;%</span></span>
<span id="cb70-9"><a href="#cb70-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">pull</span>(Feature)</span>
<span id="cb70-10"><a href="#cb70-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">head</span>(common_features, top_n))</span>
<span id="cb70-11"><a href="#cb70-11" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>First, we collect 10 features per component that have highest combined ranking from PCA and XGBoost. This means that for each feature we sum up the ranking it obtained in cumulative importance (XGBoost) and loading on a principal component (PCA).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Rank the features based on XGBoost importance (cumulative)</span></span>
<span id="cb71-2"><a href="#cb71-2" aria-hidden="true" tabindex="-1"></a>gesCumulativeImportance<span class="sc">$</span>XGB_Rank <span class="ot">&lt;-</span> <span class="fu">rank</span>(<span class="sc">-</span>gesCumulativeImportance<span class="sc">$</span>Cumulative)</span>
<span id="cb71-3"><a href="#cb71-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-4"><a href="#cb71-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Load in PCA for gesture</span></span>
<span id="cb71-5"><a href="#cb71-5" aria-hidden="true" tabindex="-1"></a>ges_pca <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="fu">paste0</span>(datasets, <span class="st">"PCA_top_contributors_ges.csv"</span>))</span>
<span id="cb71-6"><a href="#cb71-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-7"><a href="#cb71-7" aria-hidden="true" tabindex="-1"></a><span class="co"># For each PC (PC1, PC2, PC3), rank the features based on their loadings</span></span>
<span id="cb71-8"><a href="#cb71-8" aria-hidden="true" tabindex="-1"></a>combined_ranks_per_pc <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb71-9"><a href="#cb71-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-10"><a href="#cb71-10" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (pc <span class="cf">in</span> <span class="fu">c</span>(<span class="st">"PC1"</span>, <span class="st">"PC2"</span>, <span class="st">"PC3"</span>)) {</span>
<span id="cb71-11"><a href="#cb71-11" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Extract the features and loadings for the current PC</span></span>
<span id="cb71-12"><a href="#cb71-12" aria-hidden="true" tabindex="-1"></a>  pca_pc_loadings <span class="ot">&lt;-</span> ges_pca[, <span class="fu">c</span>(pc, <span class="fu">paste0</span>(pc, <span class="st">"_Loading"</span>))]</span>
<span id="cb71-13"><a href="#cb71-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">colnames</span>(pca_pc_loadings) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Feature"</span>, <span class="st">"Loading"</span>)</span>
<span id="cb71-14"><a href="#cb71-14" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb71-15"><a href="#cb71-15" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Rank the features based on the absolute loading values (higher loadings should get lower rank)</span></span>
<span id="cb71-16"><a href="#cb71-16" aria-hidden="true" tabindex="-1"></a>  pca_pc_loadings<span class="sc">$</span>PCA_Rank <span class="ot">&lt;-</span> <span class="fu">rank</span>(<span class="sc">-</span><span class="fu">abs</span>(pca_pc_loadings<span class="sc">$</span>Loading))</span>
<span id="cb71-17"><a href="#cb71-17" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb71-18"><a href="#cb71-18" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Merge PCA loadings with XGBoost importance ranks</span></span>
<span id="cb71-19"><a href="#cb71-19" aria-hidden="true" tabindex="-1"></a>  merged_data <span class="ot">&lt;-</span> <span class="fu">merge</span>(pca_pc_loadings, gesCumulativeImportance[, <span class="fu">c</span>(<span class="st">"Feature"</span>, <span class="st">"XGB_Rank"</span>)], <span class="at">by =</span> <span class="st">"Feature"</span>)</span>
<span id="cb71-20"><a href="#cb71-20" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb71-21"><a href="#cb71-21" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Calculate combined rank by summing XGBoost rank and PCA rank</span></span>
<span id="cb71-22"><a href="#cb71-22" aria-hidden="true" tabindex="-1"></a>  merged_data<span class="sc">$</span>Combined_Rank <span class="ot">&lt;-</span> merged_data<span class="sc">$</span>XGB_Rank <span class="sc">+</span> merged_data<span class="sc">$</span>PCA_Rank</span>
<span id="cb71-23"><a href="#cb71-23" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb71-24"><a href="#cb71-24" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Sort by the combined rank (lower rank is better)</span></span>
<span id="cb71-25"><a href="#cb71-25" aria-hidden="true" tabindex="-1"></a>  sorted_data <span class="ot">&lt;-</span> merged_data[<span class="fu">order</span>(merged_data<span class="sc">$</span>Combined_Rank), ]</span>
<span id="cb71-26"><a href="#cb71-26" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb71-27"><a href="#cb71-27" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Select the top n features based on the combined rank for the current PC</span></span>
<span id="cb71-28"><a href="#cb71-28" aria-hidden="true" tabindex="-1"></a>  top_n_features <span class="ot">&lt;-</span> <span class="dv">10</span>  <span class="co"># Adjust the number of top features as needed</span></span>
<span id="cb71-29"><a href="#cb71-29" aria-hidden="true" tabindex="-1"></a>  combined_ranks_per_pc[[pc]] <span class="ot">&lt;-</span> <span class="fu">head</span>(sorted_data, top_n_features)</span>
<span id="cb71-30"><a href="#cb71-30" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb71-31"><a href="#cb71-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-32"><a href="#cb71-32" aria-hidden="true" tabindex="-1"></a><span class="co"># Output the top features per PC based on combined ranking</span></span>
<span id="cb71-33"><a href="#cb71-33" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(combined_ranks_per_pc, <span class="at">n=</span><span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$PC1
                      Feature    Loading PCA_Rank XGB_Rank Combined_Rank
28               arm_inter_IK 0.06696878       97        6           103
25                   arm_bbmv 0.08606171        5       99           104
68       head_accKin_sum_Gstd 0.08200432       18       86           104
136           leg_power_Gmean 0.07496099       54       56           110
138        leg_power_integral 0.07328730       62       52           114
88                  head_bbmv 0.08376976       11      107           118
15  arm_angJerk_sum_pospeak_n 0.06625538      105       28           133
51     arm_power_pospeak_mean 0.07210599       66       76           142
92     head_jerkKin_sum_Gmean 0.07629644       42      105           147
139    leg_power_pospeak_mean 0.06311577      126       22           148

$PC2
                               Feature     Loading PCA_Rank XGB_Rank
113                   head_power_range  0.08564644       41        2
41         arm_moment_sum_change_range -0.08534023       43        3
109                head_power_integral  0.08958606       33       14
37          arm_moment_sum_change_Gstd -0.08359439       48        1
128 leg_moment_sum_change_pospeak_mean  0.08776522       37       17
112             head_power_pospeak_std  0.09732699       23       36
205             spine_moment_sum_Gmean -0.10247717       14       49
108                    head_power_Gstd  0.07966316       59       12
172          lowerbody_moment_sum_Gstd  0.10128711       16       58
102               head_moment_sum_Gstd  0.08005577       58       19
    Combined_Rank
113            43
41             46
109            47
37             49
128            54
112            59
205            63
108            71
172            74
102            77

$PC3
                          Feature     Loading PCA_Rank XGB_Rank Combined_Rank
177          lowerbody_power_Gstd -0.10452139        7       30            37
45    arm_moment_sum_pospeak_mean  0.09070628       34       20            54
208    spine_moment_sum_pospeak_n -0.09428843       28       26            54
182         lowerbody_power_range -0.10525663        5       51            56
205        spine_moment_sum_Gmean -0.10301385       11       49            60
42           arm_moment_sum_Gmean  0.07878132       60        5            65
133      leg_moment_sum_pospeak_n -0.08279836       52       23            75
154   lowerbody_angSpeed_sum_Gstd -0.10225587       12       70            82
207     spine_moment_sum_integral -0.10149747       14       71            85
186 pelvis_moment_sum_change_Gstd -0.09860998       19       73            92</code></pre>
</div>
</div>
<p>For modelling, we want to pick only three features per component. Which would it be in this case?</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Number of top features to display</span></span>
<span id="cb73-2"><a href="#cb73-2" aria-hidden="true" tabindex="-1"></a>top_n_features <span class="ot">&lt;-</span> <span class="dv">3</span></span>
<span id="cb73-3"><a href="#cb73-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-4"><a href="#cb73-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Print the top 3 features per component</span></span>
<span id="cb73-5"><a href="#cb73-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (pc <span class="cf">in</span> <span class="fu">c</span>(<span class="st">"PC1"</span>, <span class="st">"PC2"</span>, <span class="st">"PC3"</span>)) {</span>
<span id="cb73-6"><a href="#cb73-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">Top 3 Features for"</span>, pc, <span class="st">":</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb73-7"><a href="#cb73-7" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb73-8"><a href="#cb73-8" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Get the top 3 features based on combined rank for the current PC</span></span>
<span id="cb73-9"><a href="#cb73-9" aria-hidden="true" tabindex="-1"></a>  top_features <span class="ot">&lt;-</span> <span class="fu">head</span>(combined_ranks_per_pc[[pc]], top_n_features)</span>
<span id="cb73-10"><a href="#cb73-10" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb73-11"><a href="#cb73-11" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Print the results</span></span>
<span id="cb73-12"><a href="#cb73-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(top_features[, <span class="fu">c</span>(<span class="st">"Feature"</span>, <span class="st">"XGB_Rank"</span>, <span class="st">"PCA_Rank"</span>, <span class="st">"Combined_Rank"</span>)])</span>
<span id="cb73-13"><a href="#cb73-13" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Top 3 Features for PC1 :
                Feature XGB_Rank PCA_Rank Combined_Rank
28         arm_inter_IK        6       97           103
25             arm_bbmv       99        5           104
68 head_accKin_sum_Gstd       86       18           104

Top 3 Features for PC2 :
                        Feature XGB_Rank PCA_Rank Combined_Rank
113            head_power_range        2       41            43
41  arm_moment_sum_change_range        3       43            46
109         head_power_integral       14       33            47

Top 3 Features for PC3 :
                        Feature XGB_Rank PCA_Rank Combined_Rank
177        lowerbody_power_Gstd       30        7            37
45  arm_moment_sum_pospeak_mean       20       34            54
208  spine_moment_sum_pospeak_n       26       28            54</code></pre>
</div>
</div>
</section>
</section>
</section>
</section>
<section id="vocalization" class="level1">
<h1>Vocalization</h1>
<p>Now, we just repeat the whole workflow using data for vocalization-only trials.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Load in</span></span>
<span id="cb75-2"><a href="#cb75-2" aria-hidden="true" tabindex="-1"></a>data_voc <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="fu">paste0</span>(datasets, <span class="st">"voc_clean_df.csv"</span>))</span>
<span id="cb75-3"><a href="#cb75-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-4"><a href="#cb75-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Make predictor a factor variable</span></span>
<span id="cb75-5"><a href="#cb75-5" aria-hidden="true" tabindex="-1"></a>data_voc<span class="sc">$</span>correction_info <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(data_voc<span class="sc">$</span>correction_info)</span>
<span id="cb75-6"><a href="#cb75-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-7"><a href="#cb75-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Display</span></span>
<span id="cb75-8"><a href="#cb75-8" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(data_voc, <span class="at">n=</span><span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 10 × 71
   envelope_Gmean envelope_Gstd envelope_pospeak_mean envelope_pospeak_std
            &lt;dbl&gt;         &lt;dbl&gt;                 &lt;dbl&gt;                &lt;dbl&gt;
 1          0.288          1.44                 0.297                2.39 
 2          0.805          2.11                -0.586                0.231
 3          0.281          1.84                -0.584                0.196
 4          0.446          1.91                -0.641                0.118
 5          0.804          1.93                 0.003                0.728
 6          0.779          2.05                 1.79                 4.27 
 7          0.317          1.75                -0.5                  0.001
 8          2.47           2.34                -0.592                0    
 9          1.17           2.10                 3.06                 5.17 
10          0.263          1.59                -0.472                0.43 
# ℹ 67 more variables: envelope_pospeak_n &lt;dbl&gt;, envelope_integral &lt;dbl&gt;,
#   envelope_range &lt;dbl&gt;, envelope_change_Gmean &lt;dbl&gt;,
#   envelope_change_Gstd &lt;dbl&gt;, envelope_change_pospeak_mean &lt;dbl&gt;,
#   envelope_change_pospeak_std &lt;dbl&gt;, envelope_change_pospeak_n &lt;dbl&gt;,
#   envelope_change_integral &lt;dbl&gt;, envelope_change_range &lt;dbl&gt;,
#   f0_Gmean &lt;dbl&gt;, f0_Gstd &lt;dbl&gt;, f0_pospeak_n &lt;dbl&gt;, f0_integral &lt;dbl&gt;,
#   f0_range &lt;dbl&gt;, f1_clean_Gmean &lt;dbl&gt;, f1_clean_Gstd &lt;dbl&gt;, …</code></pre>
</div>
</div>
<section id="random-forests-1" class="level2">
<h2 class="anchored" data-anchor-id="random-forests-1">Random forests</h2>
<p>We first run random forests.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a><span class="co"># prepare predictors</span></span>
<span id="cb77-2"><a href="#cb77-2" aria-hidden="true" tabindex="-1"></a>predictors <span class="ot">&lt;-</span> <span class="fu">setdiff</span>(<span class="fu">names</span>(data_voc), <span class="st">"correction_info"</span>)</span>
<span id="cb77-3"><a href="#cb77-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-4"><a href="#cb77-4" aria-hidden="true" tabindex="-1"></a>formula_str <span class="ot">&lt;-</span> <span class="fu">paste</span>(<span class="st">"correction_info ~"</span>, <span class="fu">paste</span>(predictors, <span class="at">collapse =</span> <span class="st">" + "</span>))</span>
<span id="cb77-5"><a href="#cb77-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-6"><a href="#cb77-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert the formula string to a formula object</span></span>
<span id="cb77-7"><a href="#cb77-7" aria-hidden="true" tabindex="-1"></a>vocTree_formula <span class="ot">&lt;-</span> <span class="fu">as.formula</span>(formula_str)</span>
<span id="cb77-8"><a href="#cb77-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-9"><a href="#cb77-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Now use the formula in rpart</span></span>
<span id="cb77-10"><a href="#cb77-10" aria-hidden="true" tabindex="-1"></a>vocTree <span class="ot">&lt;-</span> <span class="fu">rpart</span>(<span class="at">formula =</span> vocTree_formula, <span class="at">data =</span> data_voc, </span>
<span id="cb77-11"><a href="#cb77-11" aria-hidden="true" tabindex="-1"></a>                <span class="at">method=</span><span class="st">'class'</span>, <span class="co"># Specify that it's a classification tree</span></span>
<span id="cb77-12"><a href="#cb77-12" aria-hidden="true" tabindex="-1"></a>                <span class="at">control =</span> <span class="fu">rpart.control</span>(<span class="at">maxdepth =</span> <span class="dv">5</span>)  <span class="co"># Control parameters for the 'rpart' function</span></span>
<span id="cb77-13"><a href="#cb77-13" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb77-14"><a href="#cb77-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-15"><a href="#cb77-15" aria-hidden="true" tabindex="-1"></a><span class="fu">prp</span>(</span>
<span id="cb77-16"><a href="#cb77-16" aria-hidden="true" tabindex="-1"></a>  vocTree,         <span class="co"># The decision tree object to be visualized</span></span>
<span id="cb77-17"><a href="#cb77-17" aria-hidden="true" tabindex="-1"></a>  <span class="at">extra =</span> <span class="dv">1</span>,      <span class="co"># Show extra information (like node statistics) in the plot</span></span>
<span id="cb77-18"><a href="#cb77-18" aria-hidden="true" tabindex="-1"></a>  <span class="at">varlen =</span> <span class="dv">0</span>,     <span class="co"># Length of variable names (0 means auto-determined)</span></span>
<span id="cb77-19"><a href="#cb77-19" aria-hidden="true" tabindex="-1"></a>  <span class="at">faclen =</span> <span class="dv">0</span>     <span class="co"># Length of factor levels displayed on the plot (increase as needed)</span></span>
<span id="cb77-20"><a href="#cb77-20" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="02_XGBoost_effortIndicators_files/figure-html/voc random forest-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Split the data</p>
<p>Building the untuned model.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Untuned Model with importance (permutation) option set</span></span>
<span id="cb78-2"><a href="#cb78-2" aria-hidden="true" tabindex="-1"></a>vocUntuned <span class="ot">&lt;-</span> <span class="fu">ranger</span>(</span>
<span id="cb78-3"><a href="#cb78-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">y =</span> train_data<span class="sc">$</span>correction_info,</span>
<span id="cb78-4"><a href="#cb78-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">x =</span> train_data[,<span class="dv">0</span><span class="sc">:</span><span class="dv">70</span>], <span class="co"># without outcome var</span></span>
<span id="cb78-5"><a href="#cb78-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">num.trees =</span> <span class="dv">500</span>,</span>
<span id="cb78-6"><a href="#cb78-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">importance =</span> <span class="st">"permutation"</span></span>
<span id="cb78-7"><a href="#cb78-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb78-8"><a href="#cb78-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-9"><a href="#cb78-9" aria-hidden="true" tabindex="-1"></a>predictions <span class="ot">&lt;-</span> <span class="fu">predict</span>(vocUntuned, <span class="at">data =</span> test_data)<span class="sc">$</span>predictions</span>
<span id="cb78-10"><a href="#cb78-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-11"><a href="#cb78-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a confusion matrix</span></span>
<span id="cb78-12"><a href="#cb78-12" aria-hidden="true" tabindex="-1"></a>confusion_matrix <span class="ot">&lt;-</span> <span class="fu">confusionMatrix</span>(predictions, test_data<span class="sc">$</span>correction_info)</span>
<span id="cb78-13"><a href="#cb78-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-14"><a href="#cb78-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Print the confusion matrix</span></span>
<span id="cb78-15"><a href="#cb78-15" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(confusion_matrix)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Confusion Matrix and Statistics

          Reference
Prediction c0 c0_only c1 c2
   c0       0       0  0  1
   c0_only  0       0  0  0
   c1       1       0  1  0
   c2       0       0  0  0

Overall Statistics
                                          
               Accuracy : 0.3333          
                 95% CI : (0.0084, 0.9057)
    No Information Rate : 0.3333          
    P-Value [Acc &gt; NIR] : 0.7037          
                                          
                  Kappa : 0               
                                          
 Mcnemar's Test P-Value : NA              

Statistics by Class:

                     Class: c0 Class: c0_only Class: c1 Class: c2
Sensitivity             0.0000             NA    1.0000    0.0000
Specificity             0.5000              1    0.5000    1.0000
Pos Pred Value          0.0000             NA    0.5000       NaN
Neg Pred Value          0.5000             NA    1.0000    0.6667
Prevalence              0.3333              0    0.3333    0.3333
Detection Rate          0.0000              0    0.3333    0.0000
Detection Prevalence    0.3333              0    0.6667    0.0000
Balanced Accuracy       0.2500             NA    0.7500    0.5000</code></pre>
</div>
<div class="sourceCode cell-code" id="cb80"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate feature importance</span></span>
<span id="cb80-2"><a href="#cb80-2" aria-hidden="true" tabindex="-1"></a>feature_importance <span class="ot">&lt;-</span> <span class="fu">importance</span>(vocUntuned, <span class="at">num.threads =</span> <span class="dv">1</span>, <span class="at">type =</span> <span class="dv">1</span>) </span>
<span id="cb80-3"><a href="#cb80-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-4"><a href="#cb80-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert to data frame</span></span>
<span id="cb80-5"><a href="#cb80-5" aria-hidden="true" tabindex="-1"></a>feature_importance <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(feature_importance, <span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span>)</span>
<span id="cb80-6"><a href="#cb80-6" aria-hidden="true" tabindex="-1"></a>feature_importance<span class="sc">$</span>Feature <span class="ot">&lt;-</span> <span class="fu">rownames</span>(feature_importance)</span>
<span id="cb80-7"><a href="#cb80-7" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(feature_importance) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Importance"</span>, <span class="st">"Feature"</span>)</span>
<span id="cb80-8"><a href="#cb80-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-9"><a href="#cb80-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Sort by importance</span></span>
<span id="cb80-10"><a href="#cb80-10" aria-hidden="true" tabindex="-1"></a>sorted_feature_importance <span class="ot">&lt;-</span> feature_importance[<span class="fu">order</span>(<span class="sc">-</span>feature_importance<span class="sc">$</span>Importance), ]</span>
<span id="cb80-11"><a href="#cb80-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-12"><a href="#cb80-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Print sorted feature importance</span></span>
<span id="cb80-13"><a href="#cb80-13" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(sorted_feature_importance, <span class="at">n=</span><span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                           Importance                   Feature
VSA_f1f2                  0.009076190                  VSA_f1f2
f3_clean_Gstd             0.008980952             f3_clean_Gstd
f2_clean_vel_range        0.008032540        f2_clean_vel_range
f1_clean_vel_range        0.006071429        f1_clean_vel_range
envelope_integral         0.005361905         envelope_integral
f3_clean_vel_Gmean        0.004771429        f3_clean_vel_Gmean
f1_clean_range            0.004598413            f1_clean_range
f1_clean_Gstd             0.004238095             f1_clean_Gstd
envelope_Gmean            0.003252381            envelope_Gmean
f1_clean_vel_pospeak_mean 0.003186508 f1_clean_vel_pospeak_mean</code></pre>
</div>
</div>
<p>Set the parameters for the random forest.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb82"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Define the number of CPU cores to use</span></span>
<span id="cb82-2"><a href="#cb82-2" aria-hidden="true" tabindex="-1"></a>num_cores <span class="ot">&lt;-</span> <span class="fu">detectCores</span>()</span>
<span id="cb82-3"><a href="#cb82-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-4"><a href="#cb82-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a cluster with specified number of cores</span></span>
<span id="cb82-5"><a href="#cb82-5" aria-hidden="true" tabindex="-1"></a>cl <span class="ot">&lt;-</span> <span class="fu">makeCluster</span>(num_cores)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Tuning the random forest.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb83"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a>tuneVoc <span class="ot">&lt;-</span> <span class="fu">makeClassifTask</span>(<span class="at">data =</span> data_voc[,<span class="dv">0</span><span class="sc">:</span><span class="dv">71</span>], <span class="co"># with OV</span></span>
<span id="cb83-2"><a href="#cb83-2" aria-hidden="true" tabindex="-1"></a>                           <span class="at">target =</span> <span class="st">"correction_info"</span>)</span>
<span id="cb83-3"><a href="#cb83-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-4"><a href="#cb83-4" aria-hidden="true" tabindex="-1"></a>tuneVoc <span class="ot">&lt;-</span> <span class="fu">tuneRanger</span>(tuneVoc,</span>
<span id="cb83-5"><a href="#cb83-5" aria-hidden="true" tabindex="-1"></a>                      <span class="at">measure =</span> <span class="fu">list</span>(multiclass.brier),</span>
<span id="cb83-6"><a href="#cb83-6" aria-hidden="true" tabindex="-1"></a>                      <span class="at">num.trees =</span> <span class="dv">500</span>)</span>
<span id="cb83-7"><a href="#cb83-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-8"><a href="#cb83-8" aria-hidden="true" tabindex="-1"></a><span class="co">#Return hyperparameter values</span></span>
<span id="cb83-9"><a href="#cb83-9" aria-hidden="true" tabindex="-1"></a><span class="co">#tuneVoc</span></span>
<span id="cb83-10"><a href="#cb83-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-11"><a href="#cb83-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Recommended parameter settings: </span></span>
<span id="cb83-12"><a href="#cb83-12" aria-hidden="true" tabindex="-1"></a><span class="co"># mtry min.node.size sample.fraction</span></span>
<span id="cb83-13"><a href="#cb83-13" aria-hidden="true" tabindex="-1"></a><span class="co"># 1    6             4        0.522745</span></span>
<span id="cb83-14"><a href="#cb83-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Results: </span></span>
<span id="cb83-15"><a href="#cb83-15" aria-hidden="true" tabindex="-1"></a><span class="co">#   multiclass.brier exec.time</span></span>
<span id="cb83-16"><a href="#cb83-16" aria-hidden="true" tabindex="-1"></a><span class="co"># 1        0.7256575     0.166</span></span>
<span id="cb83-17"><a href="#cb83-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-18"><a href="#cb83-18" aria-hidden="true" tabindex="-1"></a>vocTuned <span class="ot">&lt;-</span> <span class="fu">ranger</span>(</span>
<span id="cb83-19"><a href="#cb83-19" aria-hidden="true" tabindex="-1"></a>  <span class="at">y =</span> train_data<span class="sc">$</span>correction_info,</span>
<span id="cb83-20"><a href="#cb83-20" aria-hidden="true" tabindex="-1"></a>  <span class="at">x =</span> train_data[,<span class="dv">0</span><span class="sc">:</span><span class="dv">70</span>],  <span class="co">#without OV</span></span>
<span id="cb83-21"><a href="#cb83-21" aria-hidden="true" tabindex="-1"></a>  <span class="at">num.trees =</span> <span class="dv">5000</span>, </span>
<span id="cb83-22"><a href="#cb83-22" aria-hidden="true" tabindex="-1"></a>  <span class="at">mtry =</span> <span class="dv">6</span>, <span class="co"># Set the recommended mtry value (number of features).</span></span>
<span id="cb83-23"><a href="#cb83-23" aria-hidden="true" tabindex="-1"></a>  <span class="at">min.node.size =</span> <span class="dv">4</span>, <span class="co"># Set the recommended min.node.size value (number of samples before a node terminates).</span></span>
<span id="cb83-24"><a href="#cb83-24" aria-hidden="true" tabindex="-1"></a>  <span class="at">sample.fraction =</span> <span class="fl">0.522745</span>, <span class="co"># Set the recommended sample fraction value.(% of data for bagging).</span></span>
<span id="cb83-25"><a href="#cb83-25" aria-hidden="true" tabindex="-1"></a>  <span class="at">importance =</span> <span class="st">"permutation"</span> <span class="co"># Permutation is a computationally intensive test.</span></span>
<span id="cb83-26"><a href="#cb83-26" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb83-27"><a href="#cb83-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-28"><a href="#cb83-28" aria-hidden="true" tabindex="-1"></a>predictions <span class="ot">&lt;-</span> <span class="fu">predict</span>(vocTuned, <span class="at">data =</span> test_data)<span class="sc">$</span>predictions</span>
<span id="cb83-29"><a href="#cb83-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-30"><a href="#cb83-30" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a confusion matrix</span></span>
<span id="cb83-31"><a href="#cb83-31" aria-hidden="true" tabindex="-1"></a>confusion_matrix <span class="ot">&lt;-</span> <span class="fu">confusionMatrix</span>(predictions, test_data<span class="sc">$</span>correction_info)</span>
<span id="cb83-32"><a href="#cb83-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-33"><a href="#cb83-33" aria-hidden="true" tabindex="-1"></a><span class="co"># Print the confusion matrix</span></span>
<span id="cb83-34"><a href="#cb83-34" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(confusion_matrix)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Confusion Matrix and Statistics

          Reference
Prediction c0 c0_only c1 c2
   c0       0       0  0  1
   c0_only  0       0  0  0
   c1       1       0  1  0
   c2       0       0  0  0

Overall Statistics
                                          
               Accuracy : 0.3333          
                 95% CI : (0.0084, 0.9057)
    No Information Rate : 0.3333          
    P-Value [Acc &gt; NIR] : 0.7037          
                                          
                  Kappa : 0               
                                          
 Mcnemar's Test P-Value : NA              

Statistics by Class:

                     Class: c0 Class: c0_only Class: c1 Class: c2
Sensitivity             0.0000             NA    1.0000    0.0000
Specificity             0.5000              1    0.5000    1.0000
Pos Pred Value          0.0000             NA    0.5000       NaN
Neg Pred Value          0.5000             NA    1.0000    0.6667
Prevalence              0.3333              0    0.3333    0.3333
Detection Rate          0.0000              0    0.3333    0.0000
Detection Prevalence    0.3333              0    0.6667    0.0000
Balanced Accuracy       0.2500             NA    0.7500    0.5000</code></pre>
</div>
<div class="sourceCode cell-code" id="cb85"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate feature importance</span></span>
<span id="cb85-2"><a href="#cb85-2" aria-hidden="true" tabindex="-1"></a>feature_importance <span class="ot">&lt;-</span> <span class="fu">importance</span>(vocTuned, <span class="at">num.threads =</span> <span class="dv">1</span>, <span class="at">type =</span> <span class="dv">1</span>) </span>
<span id="cb85-3"><a href="#cb85-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-4"><a href="#cb85-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert to data frame</span></span>
<span id="cb85-5"><a href="#cb85-5" aria-hidden="true" tabindex="-1"></a>feature_importance <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(feature_importance, <span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span>)</span>
<span id="cb85-6"><a href="#cb85-6" aria-hidden="true" tabindex="-1"></a>feature_importance<span class="sc">$</span>Feature <span class="ot">&lt;-</span> <span class="fu">rownames</span>(feature_importance)</span>
<span id="cb85-7"><a href="#cb85-7" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(feature_importance) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Importance"</span>, <span class="st">"Feature"</span>)</span>
<span id="cb85-8"><a href="#cb85-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-9"><a href="#cb85-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Sort by importance</span></span>
<span id="cb85-10"><a href="#cb85-10" aria-hidden="true" tabindex="-1"></a>sorted_feature_importance <span class="ot">&lt;-</span> feature_importance[<span class="fu">order</span>(<span class="sc">-</span>feature_importance<span class="sc">$</span>Importance), ]</span>
<span id="cb85-11"><a href="#cb85-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-12"><a href="#cb85-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Print sorted feature importance</span></span>
<span id="cb85-13"><a href="#cb85-13" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(sorted_feature_importance, <span class="at">n=</span><span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                           Importance                   Feature
VSA_f1f2                  0.005848687                  VSA_f1f2
f1_clean_range            0.004574312            f1_clean_range
f3_clean_Gstd             0.003591010             f3_clean_Gstd
f3_clean_vel_Gmean        0.003268267        f3_clean_vel_Gmean
f2_clean_vel_range        0.002858143        f2_clean_vel_range
envelope_integral         0.002575750         envelope_integral
f1_clean_Gstd             0.002248725             f1_clean_Gstd
f2_clean_vel_Gmean        0.001997623        f2_clean_vel_Gmean
f1_clean_vel_pospeak_mean 0.001879969 f1_clean_vel_pospeak_mean
f3_clean_pospeak_mean     0.001799207     f3_clean_pospeak_mean</code></pre>
</div>
<div class="sourceCode cell-code" id="cb87"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Close the cluster when you're done with your parallel tasks</span></span>
<span id="cb87-2"><a href="#cb87-2" aria-hidden="true" tabindex="-1"></a><span class="co">#stopCluster(cl)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Create a tuned model only.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb88"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb88-1"><a href="#cb88-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a classification task for tuning</span></span>
<span id="cb88-2"><a href="#cb88-2" aria-hidden="true" tabindex="-1"></a>tuneVoc <span class="ot">&lt;-</span> <span class="fu">makeClassifTask</span>(<span class="at">data =</span> train_data[, <span class="dv">0</span><span class="sc">:</span><span class="dv">71</span>], <span class="at">target =</span> <span class="st">"correction_info"</span>) <span class="co">#with OV</span></span>
<span id="cb88-3"><a href="#cb88-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-4"><a href="#cb88-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Tune the model</span></span>
<span id="cb88-5"><a href="#cb88-5" aria-hidden="true" tabindex="-1"></a>tuneVoc <span class="ot">&lt;-</span> <span class="fu">tuneRanger</span>(tuneVoc, <span class="at">measure =</span> <span class="fu">list</span>(multiclass.brier), <span class="at">num.trees =</span> <span class="dv">500</span>)</span>
<span id="cb88-6"><a href="#cb88-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-7"><a href="#cb88-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Return hyperparameter values</span></span>
<span id="cb88-8"><a href="#cb88-8" aria-hidden="true" tabindex="-1"></a><span class="co">#tuneVoc</span></span>
<span id="cb88-9"><a href="#cb88-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Recommended parameter settings: </span></span>
<span id="cb88-10"><a href="#cb88-10" aria-hidden="true" tabindex="-1"></a><span class="co">#   mtry min.node.size sample.fraction</span></span>
<span id="cb88-11"><a href="#cb88-11" aria-hidden="true" tabindex="-1"></a><span class="co"># 1    3             3       0.5835222</span></span>
<span id="cb88-12"><a href="#cb88-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Results: </span></span>
<span id="cb88-13"><a href="#cb88-13" aria-hidden="true" tabindex="-1"></a><span class="co">#   multiclass.brier exec.time</span></span>
<span id="cb88-14"><a href="#cb88-14" aria-hidden="true" tabindex="-1"></a><span class="co"># 1        0.7457527      0.16</span></span>
<span id="cb88-15"><a href="#cb88-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-16"><a href="#cb88-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit the tuned model on the training data</span></span>
<span id="cb88-17"><a href="#cb88-17" aria-hidden="true" tabindex="-1"></a>vocTuned <span class="ot">&lt;-</span> <span class="fu">ranger</span>(</span>
<span id="cb88-18"><a href="#cb88-18" aria-hidden="true" tabindex="-1"></a>  <span class="at">y =</span> train_data<span class="sc">$</span>correction_info,</span>
<span id="cb88-19"><a href="#cb88-19" aria-hidden="true" tabindex="-1"></a>  <span class="at">x =</span> train_data[, <span class="dv">0</span><span class="sc">:</span><span class="dv">70</span>], <span class="co"># without OV</span></span>
<span id="cb88-20"><a href="#cb88-20" aria-hidden="true" tabindex="-1"></a>  <span class="at">num.trees =</span> <span class="dv">5000</span>,</span>
<span id="cb88-21"><a href="#cb88-21" aria-hidden="true" tabindex="-1"></a>  <span class="at">mtry =</span> <span class="dv">3</span>,</span>
<span id="cb88-22"><a href="#cb88-22" aria-hidden="true" tabindex="-1"></a>  <span class="at">min.node.size =</span> <span class="dv">3</span>,</span>
<span id="cb88-23"><a href="#cb88-23" aria-hidden="true" tabindex="-1"></a>  <span class="at">sample.fraction =</span> <span class="fl">0.5835222</span>,</span>
<span id="cb88-24"><a href="#cb88-24" aria-hidden="true" tabindex="-1"></a>  <span class="at">importance =</span> <span class="st">"permutation"</span></span>
<span id="cb88-25"><a href="#cb88-25" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb88-26"><a href="#cb88-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-27"><a href="#cb88-27" aria-hidden="true" tabindex="-1"></a><span class="co"># Predict on the test data</span></span>
<span id="cb88-28"><a href="#cb88-28" aria-hidden="true" tabindex="-1"></a>predictions <span class="ot">&lt;-</span> <span class="fu">predict</span>(vocTuned, <span class="at">data =</span> test_data)<span class="sc">$</span>predictions</span>
<span id="cb88-29"><a href="#cb88-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-30"><a href="#cb88-30" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a confusion matrix</span></span>
<span id="cb88-31"><a href="#cb88-31" aria-hidden="true" tabindex="-1"></a>confusion_matrix <span class="ot">&lt;-</span> <span class="fu">confusionMatrix</span>(predictions, test_data<span class="sc">$</span>correction_info)</span>
<span id="cb88-32"><a href="#cb88-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-33"><a href="#cb88-33" aria-hidden="true" tabindex="-1"></a><span class="co"># Print the confusion matrix</span></span>
<span id="cb88-34"><a href="#cb88-34" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(confusion_matrix)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Confusion Matrix and Statistics

          Reference
Prediction c0 c0_only c1 c2
   c0       0       0  0  1
   c0_only  0       0  0  0
   c1       1       0  1  0
   c2       0       0  0  0

Overall Statistics
                                          
               Accuracy : 0.3333          
                 95% CI : (0.0084, 0.9057)
    No Information Rate : 0.3333          
    P-Value [Acc &gt; NIR] : 0.7037          
                                          
                  Kappa : 0               
                                          
 Mcnemar's Test P-Value : NA              

Statistics by Class:

                     Class: c0 Class: c0_only Class: c1 Class: c2
Sensitivity             0.0000             NA    1.0000    0.0000
Specificity             0.5000              1    0.5000    1.0000
Pos Pred Value          0.0000             NA    0.5000       NaN
Neg Pred Value          0.5000             NA    1.0000    0.6667
Prevalence              0.3333              0    0.3333    0.3333
Detection Rate          0.0000              0    0.3333    0.0000
Detection Prevalence    0.3333              0    0.6667    0.0000
Balanced Accuracy       0.2500             NA    0.7500    0.5000</code></pre>
</div>
<div class="sourceCode cell-code" id="cb90"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb90-1"><a href="#cb90-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate feature importance</span></span>
<span id="cb90-2"><a href="#cb90-2" aria-hidden="true" tabindex="-1"></a>feature_importance <span class="ot">&lt;-</span> <span class="fu">importance</span>(vocTuned, <span class="at">num.threads =</span> <span class="dv">1</span>, <span class="at">type =</span> <span class="dv">1</span>)</span>
<span id="cb90-3"><a href="#cb90-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-4"><a href="#cb90-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert to data frame</span></span>
<span id="cb90-5"><a href="#cb90-5" aria-hidden="true" tabindex="-1"></a>feature_importance_df <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(feature_importance, <span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span>)</span>
<span id="cb90-6"><a href="#cb90-6" aria-hidden="true" tabindex="-1"></a>feature_importance_df<span class="sc">$</span>Feature <span class="ot">&lt;-</span> <span class="fu">rownames</span>(feature_importance_df)</span>
<span id="cb90-7"><a href="#cb90-7" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(feature_importance_df) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Importance"</span>, <span class="st">"Feature"</span>)</span>
<span id="cb90-8"><a href="#cb90-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-9"><a href="#cb90-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Sort by importance</span></span>
<span id="cb90-10"><a href="#cb90-10" aria-hidden="true" tabindex="-1"></a>sorted_feature_importance <span class="ot">&lt;-</span> feature_importance_df[<span class="fu">order</span>(<span class="sc">-</span>feature_importance_df<span class="sc">$</span>Importance), ]</span>
<span id="cb90-11"><a href="#cb90-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-12"><a href="#cb90-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Print sorted feature importance</span></span>
<span id="cb90-13"><a href="#cb90-13" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(sorted_feature_importance, <span class="at">n=</span><span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                       Importance               Feature
VSA_f1f2              0.005612179              VSA_f1f2
f1_clean_range        0.004155960        f1_clean_range
f3_clean_Gstd         0.003867630         f3_clean_Gstd
f2_clean_vel_range    0.003017071    f2_clean_vel_range
f3_clean_vel_Gmean    0.002908297    f3_clean_vel_Gmean
f3_clean_pospeak_mean 0.002557821 f3_clean_pospeak_mean
envelope_integral     0.002401515     envelope_integral
envelope_Gmean        0.002082677        envelope_Gmean
f1_clean_vel_range    0.002057444    f1_clean_vel_range
f1_clean_Gstd         0.001727735         f1_clean_Gstd</code></pre>
</div>
<div class="sourceCode cell-code" id="cb92"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb92-1"><a href="#cb92-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Close the cluster when you're done with your parallel tasks</span></span>
<span id="cb92-2"><a href="#cb92-2" aria-hidden="true" tabindex="-1"></a><span class="co">#stopCluster(cl)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Save data frame.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb93"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb93-1"><a href="#cb93-1" aria-hidden="true" tabindex="-1"></a><span class="fu">write.csv</span>(data_voc, <span class="at">file =</span> <span class="fu">paste0</span>(datasets, <span class="st">"vocDataXGB.csv"</span>), <span class="at">row.names =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="xgboost-1" class="level2">
<h2 class="anchored" data-anchor-id="xgboost-1">XGBoost</h2>
<p>Ensure parallel processing.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb94"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb94-1"><a href="#cb94-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Detect the number of available cores</span></span>
<span id="cb94-2"><a href="#cb94-2" aria-hidden="true" tabindex="-1"></a>cores <span class="ot">&lt;-</span> <span class="fu">detectCores</span>() <span class="co">#- 1  # Leave one core free</span></span>
<span id="cb94-3"><a href="#cb94-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-4"><a href="#cb94-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a cluster with the detected number of cores</span></span>
<span id="cb94-5"><a href="#cb94-5" aria-hidden="true" tabindex="-1"></a>cl <span class="ot">&lt;-</span> <span class="fu">makeCluster</span>(cores)</span>
<span id="cb94-6"><a href="#cb94-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-7"><a href="#cb94-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Register the parallel backend</span></span>
<span id="cb94-8"><a href="#cb94-8" aria-hidden="true" tabindex="-1"></a><span class="fu">registerDoParallel</span>(cl)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Define the grid and estimate runtime.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb95"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb95-1"><a href="#cb95-1" aria-hidden="true" tabindex="-1"></a>grid_tune <span class="ot">&lt;-</span> <span class="fu">expand.grid</span>(</span>
<span id="cb95-2"><a href="#cb95-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">nrounds =</span> <span class="fu">c</span>(<span class="dv">5000</span>, <span class="dv">10000</span>), </span>
<span id="cb95-3"><a href="#cb95-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">max_depth =</span> <span class="fu">c</span>(<span class="dv">3</span>, <span class="dv">6</span>), </span>
<span id="cb95-4"><a href="#cb95-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">eta =</span> <span class="fu">c</span>(<span class="fl">0.05</span>, <span class="fl">0.1</span>), </span>
<span id="cb95-5"><a href="#cb95-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">gamma =</span> <span class="fu">c</span>(<span class="fl">0.1</span>), </span>
<span id="cb95-6"><a href="#cb95-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">colsample_bytree =</span> <span class="fu">c</span>(<span class="fl">0.6</span>, <span class="fl">0.8</span>), </span>
<span id="cb95-7"><a href="#cb95-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">min_child_weight =</span> <span class="fu">c</span>(<span class="dv">1</span>), </span>
<span id="cb95-8"><a href="#cb95-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">subsample =</span> <span class="fu">c</span>(<span class="fl">0.75</span>, <span class="fl">1.0</span>)</span>
<span id="cb95-9"><a href="#cb95-9" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb95-10"><a href="#cb95-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-11"><a href="#cb95-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate total combinations</span></span>
<span id="cb95-12"><a href="#cb95-12" aria-hidden="true" tabindex="-1"></a>total_combinations <span class="ot">&lt;-</span> <span class="fu">nrow</span>(grid_tune)</span>
<span id="cb95-13"><a href="#cb95-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-14"><a href="#cb95-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Estimate single model run time (assume 1 minute per run)</span></span>
<span id="cb95-15"><a href="#cb95-15" aria-hidden="true" tabindex="-1"></a>single_model_time <span class="ot">&lt;-</span> <span class="dv">10</span> <span class="co"># minute</span></span>
<span id="cb95-16"><a href="#cb95-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-17"><a href="#cb95-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Total runs for cross-validation</span></span>
<span id="cb95-18"><a href="#cb95-18" aria-hidden="true" tabindex="-1"></a>folds <span class="ot">&lt;-</span> <span class="dv">5</span></span>
<span id="cb95-19"><a href="#cb95-19" aria-hidden="true" tabindex="-1"></a>total_runs <span class="ot">&lt;-</span> total_combinations <span class="sc">*</span> folds</span>
<span id="cb95-20"><a href="#cb95-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-21"><a href="#cb95-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Total time estimation without parallel processing</span></span>
<span id="cb95-22"><a href="#cb95-22" aria-hidden="true" tabindex="-1"></a>total_time <span class="ot">&lt;-</span> total_runs <span class="sc">*</span> single_model_time <span class="co"># in minutes</span></span>
<span id="cb95-23"><a href="#cb95-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-24"><a href="#cb95-24" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert to hours</span></span>
<span id="cb95-25"><a href="#cb95-25" aria-hidden="true" tabindex="-1"></a>total_time_hours <span class="ot">&lt;-</span> total_time <span class="sc">/</span> <span class="dv">60</span></span>
<span id="cb95-26"><a href="#cb95-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-27"><a href="#cb95-27" aria-hidden="true" tabindex="-1"></a><span class="co"># Output estimated time without parallel processing</span></span>
<span id="cb95-28"><a href="#cb95-28" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">paste</span>(<span class="st">"Estimated time for grid search without parallel processing:"</span>, total_time_hours, <span class="st">"hours"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Estimated time for grid search without parallel processing: 26.6666666666667 hours"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb97"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb97-1"><a href="#cb97-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Parallel processing with 4 cores</span></span>
<span id="cb97-2"><a href="#cb97-2" aria-hidden="true" tabindex="-1"></a>cores <span class="ot">&lt;-</span> <span class="dv">24</span></span>
<span id="cb97-3"><a href="#cb97-3" aria-hidden="true" tabindex="-1"></a>total_time_parallel <span class="ot">&lt;-</span> total_time <span class="sc">/</span> cores <span class="co"># in minutes</span></span>
<span id="cb97-4"><a href="#cb97-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb97-5"><a href="#cb97-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert to hours</span></span>
<span id="cb97-6"><a href="#cb97-6" aria-hidden="true" tabindex="-1"></a>total_time_parallel_hours <span class="ot">&lt;-</span> total_time_parallel <span class="sc">/</span> <span class="dv">60</span></span>
<span id="cb97-7"><a href="#cb97-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb97-8"><a href="#cb97-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Output estimated time with parallel processing</span></span>
<span id="cb97-9"><a href="#cb97-9" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">paste</span>(<span class="st">"Estimated time for grid search with"</span>, cores, <span class="st">"cores:"</span>, total_time_parallel_hours, <span class="st">"hours"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Estimated time for grid search with 24 cores: 1.11111111111111 hours"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb99"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb99-1"><a href="#cb99-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(total_combinations,single_model_time,folds,total_runs,total_time,total_time_hours,total_time_parallel,total_time_parallel_hours,cores)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="k-fold-cross-validation-1" class="level3">
<h3 class="anchored" data-anchor-id="k-fold-cross-validation-1">K-fold cross-validation</h3>
<p>Create subsets to train and test data (80/20).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb100"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb100-1"><a href="#cb100-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Set seed for reproducibility</span></span>
<span id="cb100-2"><a href="#cb100-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">998</span>)</span>
<span id="cb100-3"><a href="#cb100-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb100-4"><a href="#cb100-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Set up train control</span></span>
<span id="cb100-5"><a href="#cb100-5" aria-hidden="true" tabindex="-1"></a>train_control <span class="ot">&lt;-</span> <span class="fu">trainControl</span>(</span>
<span id="cb100-6"><a href="#cb100-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">method =</span> <span class="st">"cv"</span>,        <span class="co"># Cross-validation</span></span>
<span id="cb100-7"><a href="#cb100-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">number =</span> <span class="dv">5</span>,           <span class="co"># 5-fold cross-validation</span></span>
<span id="cb100-8"><a href="#cb100-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">allowParallel =</span> <span class="cn">TRUE</span>  <span class="co"># Enable parallel processing</span></span>
<span id="cb100-9"><a href="#cb100-9" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb100-10"><a href="#cb100-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb100-11"><a href="#cb100-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb100-12"><a href="#cb100-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Define the number of subsets</span></span>
<span id="cb100-13"><a href="#cb100-13" aria-hidden="true" tabindex="-1"></a>numSubsets <span class="ot">&lt;-</span> <span class="dv">5</span></span>
<span id="cb100-14"><a href="#cb100-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb100-15"><a href="#cb100-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Load MICE-imputed data (using placeholder 'data_ges' as the input dataset)</span></span>
<span id="cb100-16"><a href="#cb100-16" aria-hidden="true" tabindex="-1"></a>vocDataXGB <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="fu">paste0</span>(datasets, <span class="st">"vocDataXGB.csv"</span>))</span>
<span id="cb100-17"><a href="#cb100-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb100-18"><a href="#cb100-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Ensure 'correction_info' is a factor</span></span>
<span id="cb100-19"><a href="#cb100-19" aria-hidden="true" tabindex="-1"></a>vocDataXGB<span class="sc">$</span>correction_info <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(vocDataXGB<span class="sc">$</span>correction_info)</span>
<span id="cb100-20"><a href="#cb100-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb100-21"><a href="#cb100-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Remove rows with only NA values</span></span>
<span id="cb100-22"><a href="#cb100-22" aria-hidden="true" tabindex="-1"></a>vocDataXGB <span class="ot">&lt;-</span> vocDataXGB[<span class="fu">rowSums</span>(<span class="fu">is.na</span>(vocDataXGB)) <span class="sc">&lt;</span> <span class="fu">ncol</span>(vocDataXGB), ]</span>
<span id="cb100-23"><a href="#cb100-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb100-24"><a href="#cb100-24" aria-hidden="true" tabindex="-1"></a><span class="co"># Split data by levels of 'correction_info'</span></span>
<span id="cb100-25"><a href="#cb100-25" aria-hidden="true" tabindex="-1"></a>correction_levels <span class="ot">&lt;-</span> <span class="fu">levels</span>(vocDataXGB<span class="sc">$</span>correction_info)</span>
<span id="cb100-26"><a href="#cb100-26" aria-hidden="true" tabindex="-1"></a>split_data <span class="ot">&lt;-</span> <span class="fu">split</span>(vocDataXGB, vocDataXGB<span class="sc">$</span>correction_info)</span>
<span id="cb100-27"><a href="#cb100-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb100-28"><a href="#cb100-28" aria-hidden="true" tabindex="-1"></a><span class="co"># Initialize a list to store subsets</span></span>
<span id="cb100-29"><a href="#cb100-29" aria-hidden="true" tabindex="-1"></a>vocSubsets <span class="ot">&lt;-</span> <span class="fu">vector</span>(<span class="st">"list"</span>, <span class="at">length =</span> numSubsets)</span>
<span id="cb100-30"><a href="#cb100-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb100-31"><a href="#cb100-31" aria-hidden="true" tabindex="-1"></a><span class="co"># Distribute rows for each level equally across subsets</span></span>
<span id="cb100-32"><a href="#cb100-32" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (level <span class="cf">in</span> correction_levels) {</span>
<span id="cb100-33"><a href="#cb100-33" aria-hidden="true" tabindex="-1"></a>  level_data <span class="ot">&lt;-</span> split_data[[level]]</span>
<span id="cb100-34"><a href="#cb100-34" aria-hidden="true" tabindex="-1"></a>  subset_sizes <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="fu">floor</span>(<span class="fu">nrow</span>(level_data) <span class="sc">/</span> numSubsets), numSubsets)</span>
<span id="cb100-35"><a href="#cb100-35" aria-hidden="true" tabindex="-1"></a>  remainder <span class="ot">&lt;-</span> <span class="fu">nrow</span>(level_data) <span class="sc">%%</span> numSubsets</span>
<span id="cb100-36"><a href="#cb100-36" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb100-37"><a href="#cb100-37" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Distribute remainder rows randomly</span></span>
<span id="cb100-38"><a href="#cb100-38" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (remainder <span class="sc">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb100-39"><a href="#cb100-39" aria-hidden="true" tabindex="-1"></a>    subset_sizes[<span class="fu">seq_len</span>(remainder)] <span class="ot">&lt;-</span> subset_sizes[<span class="fu">seq_len</span>(remainder)] <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb100-40"><a href="#cb100-40" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb100-41"><a href="#cb100-41" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb100-42"><a href="#cb100-42" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Shuffle rows of the level and assign to subsets</span></span>
<span id="cb100-43"><a href="#cb100-43" aria-hidden="true" tabindex="-1"></a>  shuffled_data <span class="ot">&lt;-</span> level_data[<span class="fu">sample</span>(<span class="fu">nrow</span>(level_data)), ]</span>
<span id="cb100-44"><a href="#cb100-44" aria-hidden="true" tabindex="-1"></a>  indices <span class="ot">&lt;-</span> <span class="fu">cumsum</span>(<span class="fu">c</span>(<span class="dv">0</span>, subset_sizes))</span>
<span id="cb100-45"><a href="#cb100-45" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb100-46"><a href="#cb100-46" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>numSubsets) {</span>
<span id="cb100-47"><a href="#cb100-47" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">is.null</span>(vocSubsets[[i]])) {</span>
<span id="cb100-48"><a href="#cb100-48" aria-hidden="true" tabindex="-1"></a>      vocSubsets[[i]] <span class="ot">&lt;-</span> shuffled_data[(indices[i] <span class="sc">+</span> <span class="dv">1</span>)<span class="sc">:</span>indices[i <span class="sc">+</span> <span class="dv">1</span>], ]</span>
<span id="cb100-49"><a href="#cb100-49" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb100-50"><a href="#cb100-50" aria-hidden="true" tabindex="-1"></a>      vocSubsets[[i]] <span class="ot">&lt;-</span> <span class="fu">rbind</span>(vocSubsets[[i]], shuffled_data[(indices[i] <span class="sc">+</span> <span class="dv">1</span>)<span class="sc">:</span>indices[i <span class="sc">+</span> <span class="dv">1</span>], ])</span>
<span id="cb100-51"><a href="#cb100-51" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb100-52"><a href="#cb100-52" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb100-53"><a href="#cb100-53" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb100-54"><a href="#cb100-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb100-55"><a href="#cb100-55" aria-hidden="true" tabindex="-1"></a><span class="co"># Naming the subsets</span></span>
<span id="cb100-56"><a href="#cb100-56" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(vocSubsets) <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"vocData"</span>, <span class="dv">1</span><span class="sc">:</span>numSubsets)</span>
<span id="cb100-57"><a href="#cb100-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb100-58"><a href="#cb100-58" aria-hidden="true" tabindex="-1"></a><span class="co"># Verify balance in subsets</span></span>
<span id="cb100-59"><a href="#cb100-59" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>numSubsets) {</span>
<span id="cb100-60"><a href="#cb100-60" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"Subset"</span>, i, <span class="st">"contains rows:"</span>, <span class="fu">nrow</span>(vocSubsets[[i]]), <span class="st">"and levels:</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb100-61"><a href="#cb100-61" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="fu">table</span>(vocSubsets[[i]]<span class="sc">$</span>correction_info))</span>
<span id="cb100-62"><a href="#cb100-62" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Subset 1 contains rows: 7 and levels:

     c0 c0_only      c1      c2 
      2       1       2       2 
Subset 2 contains rows: 7 and levels:

     c0 c0_only      c1      c2 
      2       1       2       1 
Subset 3 contains rows: 5 and levels:

     c0 c0_only      c1      c2 
      1       1       1       1 
Subset 4 contains rows: 5 and levels:

     c0 c0_only      c1      c2 
      1       1       1       1 
Subset 5 contains rows: 5 and levels:

     c0 c0_only      c1      c2 
      1       1       1       1 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb102"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb102-1"><a href="#cb102-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Remove any rows with only NAs from subsets just to ensure cleanliness</span></span>
<span id="cb102-2"><a href="#cb102-2" aria-hidden="true" tabindex="-1"></a>vocSubsets <span class="ot">&lt;-</span> <span class="fu">lapply</span>(vocSubsets, <span class="cf">function</span>(subset) {</span>
<span id="cb102-3"><a href="#cb102-3" aria-hidden="true" tabindex="-1"></a>  subset[<span class="fu">rowSums</span>(<span class="fu">is.na</span>(subset)) <span class="sc">&lt;</span> <span class="fu">ncol</span>(subset), ]</span>
<span id="cb102-4"><a href="#cb102-4" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb102-5"><a href="#cb102-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-6"><a href="#cb102-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Access the subsets</span></span>
<span id="cb102-7"><a href="#cb102-7" aria-hidden="true" tabindex="-1"></a>vocData1 <span class="ot">&lt;-</span> vocSubsets<span class="sc">$</span>vocData1</span>
<span id="cb102-8"><a href="#cb102-8" aria-hidden="true" tabindex="-1"></a>vocData2 <span class="ot">&lt;-</span> vocSubsets<span class="sc">$</span>vocData2</span>
<span id="cb102-9"><a href="#cb102-9" aria-hidden="true" tabindex="-1"></a>vocData3 <span class="ot">&lt;-</span> vocSubsets<span class="sc">$</span>vocData3</span>
<span id="cb102-10"><a href="#cb102-10" aria-hidden="true" tabindex="-1"></a>vocData4 <span class="ot">&lt;-</span> vocSubsets<span class="sc">$</span>vocData4</span>
<span id="cb102-11"><a href="#cb102-11" aria-hidden="true" tabindex="-1"></a>vocData5 <span class="ot">&lt;-</span> vocSubsets<span class="sc">$</span>vocData5</span>
<span id="cb102-12"><a href="#cb102-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-13"><a href="#cb102-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Combine subsets into 80% groups</span></span>
<span id="cb102-14"><a href="#cb102-14" aria-hidden="true" tabindex="-1"></a>vocData1234 <span class="ot">&lt;-</span> <span class="fu">rbind</span>(vocData1, vocData2, vocData3, vocData4)</span>
<span id="cb102-15"><a href="#cb102-15" aria-hidden="true" tabindex="-1"></a>vocData1235 <span class="ot">&lt;-</span> <span class="fu">rbind</span>(vocData1, vocData2, vocData3, vocData5)</span>
<span id="cb102-16"><a href="#cb102-16" aria-hidden="true" tabindex="-1"></a>vocData1245 <span class="ot">&lt;-</span> <span class="fu">rbind</span>(vocData1, vocData2, vocData4, vocData5)</span>
<span id="cb102-17"><a href="#cb102-17" aria-hidden="true" tabindex="-1"></a>vocData1345 <span class="ot">&lt;-</span> <span class="fu">rbind</span>(vocData1, vocData3, vocData4, vocData5)</span>
<span id="cb102-18"><a href="#cb102-18" aria-hidden="true" tabindex="-1"></a>vocData2345 <span class="ot">&lt;-</span> <span class="fu">rbind</span>(vocData2, vocData3, vocData4, vocData5)</span>
<span id="cb102-19"><a href="#cb102-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-20"><a href="#cb102-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Final verification of all levels in the combined datasets</span></span>
<span id="cb102-21"><a href="#cb102-21" aria-hidden="true" tabindex="-1"></a>combined_sets <span class="ot">&lt;-</span> <span class="fu">list</span>(vocData1234, vocData1235, vocData1245, vocData1345, vocData2345)</span>
<span id="cb102-22"><a href="#cb102-22" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(combined_sets) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"vocData1234"</span>, <span class="st">"vocData1235"</span>, <span class="st">"vocData1245"</span>, <span class="st">"vocData1345"</span>, <span class="st">"vocData2345"</span>)</span>
<span id="cb102-23"><a href="#cb102-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-24"><a href="#cb102-24" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (set_name <span class="cf">in</span> <span class="fu">names</span>(combined_sets)) {</span>
<span id="cb102-25"><a href="#cb102-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"Dataset"</span>, set_name, <span class="st">"contains rows:"</span>, <span class="fu">nrow</span>(combined_sets[[set_name]]), <span class="st">"and levels:</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb102-26"><a href="#cb102-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="fu">table</span>(combined_sets[[set_name]]<span class="sc">$</span>correction_info))</span>
<span id="cb102-27"><a href="#cb102-27" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Dataset vocData1234 contains rows: 21 and levels:

     c0 c0_only      c1      c2 
      6       4       6       5 
Dataset vocData1235 contains rows: 21 and levels:

     c0 c0_only      c1      c2 
      6       4       6       5 
Dataset vocData1245 contains rows: 21 and levels:

     c0 c0_only      c1      c2 
      6       4       6       5 
Dataset vocData1345 contains rows: 19 and levels:

     c0 c0_only      c1      c2 
      5       4       5       5 
Dataset vocData2345 contains rows: 18 and levels:

     c0 c0_only      c1      c2 
      5       4       5       4 </code></pre>
</div>
</div>
</section>
<section id="models-1" class="level3">
<h3 class="anchored" data-anchor-id="models-1">Models</h3>
<section id="model-1-2" class="level4">
<h4 class="anchored" data-anchor-id="model-1-2">Model 1</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb104"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb104-1"><a href="#cb104-1" aria-hidden="true" tabindex="-1"></a>vocModel1 <span class="ot">&lt;-</span> caret<span class="sc">::</span><span class="fu">train</span>(</span>
<span id="cb104-2"><a href="#cb104-2" aria-hidden="true" tabindex="-1"></a>  correction_info <span class="sc">~</span> .,              </span>
<span id="cb104-3"><a href="#cb104-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> vocData1234,</span>
<span id="cb104-4"><a href="#cb104-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">method =</span> <span class="st">"xgbTree"</span>,     </span>
<span id="cb104-5"><a href="#cb104-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">trControl =</span> train_control,</span>
<span id="cb104-6"><a href="#cb104-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">tuneGrid =</span> grid_tune    </span>
<span id="cb104-7"><a href="#cb104-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb104-8"><a href="#cb104-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb104-9"><a href="#cb104-9" aria-hidden="true" tabindex="-1"></a><span class="fu">saveRDS</span>(vocModel1, <span class="at">file =</span> <span class="fu">paste0</span>(models, <span class="st">"vocModel1.rds"</span>), <span class="at">compress =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="model-2-2" class="level4">
<h4 class="anchored" data-anchor-id="model-2-2">Model 2</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb105"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb105-1"><a href="#cb105-1" aria-hidden="true" tabindex="-1"></a>vocModel2 <span class="ot">&lt;-</span> caret<span class="sc">::</span><span class="fu">train</span>(</span>
<span id="cb105-2"><a href="#cb105-2" aria-hidden="true" tabindex="-1"></a>  correction_info <span class="sc">~</span> .,              </span>
<span id="cb105-3"><a href="#cb105-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> vocData1235,</span>
<span id="cb105-4"><a href="#cb105-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">method =</span> <span class="st">"xgbTree"</span>,     </span>
<span id="cb105-5"><a href="#cb105-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">trControl =</span> train_control,</span>
<span id="cb105-6"><a href="#cb105-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">tuneGrid =</span> grid_tune    </span>
<span id="cb105-7"><a href="#cb105-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb105-8"><a href="#cb105-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-9"><a href="#cb105-9" aria-hidden="true" tabindex="-1"></a><span class="fu">saveRDS</span>(vocModel2, <span class="at">file =</span> <span class="fu">paste0</span>(models, <span class="st">"vocModel2.rds"</span>), <span class="at">compress =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="model-3-2" class="level4">
<h4 class="anchored" data-anchor-id="model-3-2">Model 3</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb106"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb106-1"><a href="#cb106-1" aria-hidden="true" tabindex="-1"></a>vocModel3 <span class="ot">&lt;-</span> caret<span class="sc">::</span><span class="fu">train</span>(</span>
<span id="cb106-2"><a href="#cb106-2" aria-hidden="true" tabindex="-1"></a>  correction_info <span class="sc">~</span> .,              </span>
<span id="cb106-3"><a href="#cb106-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> vocData1245,</span>
<span id="cb106-4"><a href="#cb106-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">method =</span> <span class="st">"xgbTree"</span>,     </span>
<span id="cb106-5"><a href="#cb106-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">trControl =</span> train_control,</span>
<span id="cb106-6"><a href="#cb106-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">tuneGrid =</span> grid_tune    </span>
<span id="cb106-7"><a href="#cb106-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb106-8"><a href="#cb106-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-9"><a href="#cb106-9" aria-hidden="true" tabindex="-1"></a><span class="fu">saveRDS</span>(vocModel3, <span class="at">file =</span> <span class="fu">paste0</span>(models, <span class="st">"vocModel3.rds"</span>), <span class="at">compress =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="model-4-2" class="level4">
<h4 class="anchored" data-anchor-id="model-4-2">Model 4</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb107"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb107-1"><a href="#cb107-1" aria-hidden="true" tabindex="-1"></a>vocModel4 <span class="ot">&lt;-</span> caret<span class="sc">::</span><span class="fu">train</span>(</span>
<span id="cb107-2"><a href="#cb107-2" aria-hidden="true" tabindex="-1"></a>  correction_info <span class="sc">~</span> .,              </span>
<span id="cb107-3"><a href="#cb107-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> vocData1345,</span>
<span id="cb107-4"><a href="#cb107-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">method =</span> <span class="st">"xgbTree"</span>,     </span>
<span id="cb107-5"><a href="#cb107-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">trControl =</span> train_control,</span>
<span id="cb107-6"><a href="#cb107-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">tuneGrid =</span> grid_tune    </span>
<span id="cb107-7"><a href="#cb107-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb107-8"><a href="#cb107-8" aria-hidden="true" tabindex="-1"></a><span class="fu">saveRDS</span>(vocModel4, <span class="at">file =</span> <span class="fu">paste0</span>(models, <span class="st">"vocModel4.rds"</span>), <span class="at">compress =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="model-5-2" class="level4">
<h4 class="anchored" data-anchor-id="model-5-2">Model 5</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb108"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb108-1"><a href="#cb108-1" aria-hidden="true" tabindex="-1"></a>vocModel5 <span class="ot">&lt;-</span> caret<span class="sc">::</span><span class="fu">train</span>(</span>
<span id="cb108-2"><a href="#cb108-2" aria-hidden="true" tabindex="-1"></a>  correction_info <span class="sc">~</span> .,              </span>
<span id="cb108-3"><a href="#cb108-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> vocData2345,</span>
<span id="cb108-4"><a href="#cb108-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">method =</span> <span class="st">"xgbTree"</span>,     </span>
<span id="cb108-5"><a href="#cb108-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">trControl =</span> train_control,</span>
<span id="cb108-6"><a href="#cb108-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">tuneGrid =</span> grid_tune    </span>
<span id="cb108-7"><a href="#cb108-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb108-8"><a href="#cb108-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-9"><a href="#cb108-9" aria-hidden="true" tabindex="-1"></a><span class="fu">saveRDS</span>(vocModel5, <span class="at">file =</span> <span class="fu">paste0</span>(models, <span class="st">"vocModel5.rds"</span>), <span class="at">compress =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="load-models-1" class="level4">
<h4 class="anchored" data-anchor-id="load-models-1">Load models</h4>
<p>Load all models after running, if necessary.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb109"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb109-1"><a href="#cb109-1" aria-hidden="true" tabindex="-1"></a>vocModel1 <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="fu">paste0</span>(models, <span class="st">"vocModel1.rds"</span>))</span>
<span id="cb109-2"><a href="#cb109-2" aria-hidden="true" tabindex="-1"></a>vocModel2 <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="fu">paste0</span>(models, <span class="st">"vocModel2.rds"</span>))</span>
<span id="cb109-3"><a href="#cb109-3" aria-hidden="true" tabindex="-1"></a>vocModel3 <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="fu">paste0</span>(models, <span class="st">"vocModel3.rds"</span>))</span>
<span id="cb109-4"><a href="#cb109-4" aria-hidden="true" tabindex="-1"></a>vocModel4 <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="fu">paste0</span>(models, <span class="st">"vocModel4.rds"</span>))</span>
<span id="cb109-5"><a href="#cb109-5" aria-hidden="true" tabindex="-1"></a>vocModel5 <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="fu">paste0</span>(models, <span class="st">"vocModel5.rds"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="test-models-1" class="level4">
<h4 class="anchored" data-anchor-id="test-models-1">Test models</h4>
<p>Generate predictions and confusion matrices</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb110"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb110-1"><a href="#cb110-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate predictions</span></span>
<span id="cb110-2"><a href="#cb110-2" aria-hidden="true" tabindex="-1"></a>vocPredictions1 <span class="ot">&lt;-</span> <span class="fu">predict</span>(vocModel1, <span class="at">newdata =</span> vocData5)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[16:54:31] WARNING: src/learner.cc:553: 
  If you are loading a serialized model (like pickle in Python, RDS in R) generated by
  older XGBoost, please export the model by calling `Booster.save_model` from that version
  first, then load it back in current version. See:

    https://xgboost.readthedocs.io/en/latest/tutorials/saving_model.html

  for more details about differences between saving model and serializing.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb112"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb112-1"><a href="#cb112-1" aria-hidden="true" tabindex="-1"></a>vocPredictions2 <span class="ot">&lt;-</span> <span class="fu">predict</span>(vocModel2, <span class="at">newdata =</span> vocData4)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[16:54:31] WARNING: src/learner.cc:553: 
  If you are loading a serialized model (like pickle in Python, RDS in R) generated by
  older XGBoost, please export the model by calling `Booster.save_model` from that version
  first, then load it back in current version. See:

    https://xgboost.readthedocs.io/en/latest/tutorials/saving_model.html

  for more details about differences between saving model and serializing.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb114"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb114-1"><a href="#cb114-1" aria-hidden="true" tabindex="-1"></a>vocPredictions3 <span class="ot">&lt;-</span> <span class="fu">predict</span>(vocModel3, <span class="at">newdata =</span> vocData3)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[16:54:32] WARNING: src/learner.cc:553: 
  If you are loading a serialized model (like pickle in Python, RDS in R) generated by
  older XGBoost, please export the model by calling `Booster.save_model` from that version
  first, then load it back in current version. See:

    https://xgboost.readthedocs.io/en/latest/tutorials/saving_model.html

  for more details about differences between saving model and serializing.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb116"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb116-1"><a href="#cb116-1" aria-hidden="true" tabindex="-1"></a>vocPredictions4 <span class="ot">&lt;-</span> <span class="fu">predict</span>(vocModel4, <span class="at">newdata =</span> vocData2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[16:54:32] WARNING: src/learner.cc:553: 
  If you are loading a serialized model (like pickle in Python, RDS in R) generated by
  older XGBoost, please export the model by calling `Booster.save_model` from that version
  first, then load it back in current version. See:

    https://xgboost.readthedocs.io/en/latest/tutorials/saving_model.html

  for more details about differences between saving model and serializing.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb118"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb118-1"><a href="#cb118-1" aria-hidden="true" tabindex="-1"></a>vocPredictions5 <span class="ot">&lt;-</span> <span class="fu">predict</span>(vocModel5, <span class="at">newdata =</span> vocData1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[16:54:32] WARNING: src/learner.cc:553: 
  If you are loading a serialized model (like pickle in Python, RDS in R) generated by
  older XGBoost, please export the model by calling `Booster.save_model` from that version
  first, then load it back in current version. See:

    https://xgboost.readthedocs.io/en/latest/tutorials/saving_model.html

  for more details about differences between saving model and serializing.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb120"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb120-1"><a href="#cb120-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute confusion matrices</span></span>
<span id="cb120-2"><a href="#cb120-2" aria-hidden="true" tabindex="-1"></a>vocCm1 <span class="ot">&lt;-</span> <span class="fu">confusionMatrix</span>(vocPredictions1, vocData5<span class="sc">$</span>correction_info)</span>
<span id="cb120-3"><a href="#cb120-3" aria-hidden="true" tabindex="-1"></a>vocCm2 <span class="ot">&lt;-</span> <span class="fu">confusionMatrix</span>(vocPredictions2, vocData4<span class="sc">$</span>correction_info)</span>
<span id="cb120-4"><a href="#cb120-4" aria-hidden="true" tabindex="-1"></a>vocCm3 <span class="ot">&lt;-</span> <span class="fu">confusionMatrix</span>(vocPredictions3, vocData3<span class="sc">$</span>correction_info)</span>
<span id="cb120-5"><a href="#cb120-5" aria-hidden="true" tabindex="-1"></a>vocCm4 <span class="ot">&lt;-</span> <span class="fu">confusionMatrix</span>(vocPredictions4, vocData2<span class="sc">$</span>correction_info)</span>
<span id="cb120-6"><a href="#cb120-6" aria-hidden="true" tabindex="-1"></a>vocCm5 <span class="ot">&lt;-</span> <span class="fu">confusionMatrix</span>(vocPredictions5, vocData1<span class="sc">$</span>correction_info)</span>
<span id="cb120-7"><a href="#cb120-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb120-8"><a href="#cb120-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract p-values (you need to define how to extract these based on your metric, here assumed to be some metric from confusion matrix)</span></span>
<span id="cb120-9"><a href="#cb120-9" aria-hidden="true" tabindex="-1"></a>vocPValues <span class="ot">&lt;-</span> <span class="fu">c</span>(vocCm1<span class="sc">$</span>overall[<span class="st">'AccuracyPValue'</span>], </span>
<span id="cb120-10"><a href="#cb120-10" aria-hidden="true" tabindex="-1"></a>              vocCm2<span class="sc">$</span>overall[<span class="st">'AccuracyPValue'</span>], </span>
<span id="cb120-11"><a href="#cb120-11" aria-hidden="true" tabindex="-1"></a>              vocCm3<span class="sc">$</span>overall[<span class="st">'AccuracyPValue'</span>], </span>
<span id="cb120-12"><a href="#cb120-12" aria-hidden="true" tabindex="-1"></a>              vocCm4<span class="sc">$</span>overall[<span class="st">'AccuracyPValue'</span>], </span>
<span id="cb120-13"><a href="#cb120-13" aria-hidden="true" tabindex="-1"></a>              vocCm5<span class="sc">$</span>overall[<span class="st">'AccuracyPValue'</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Combine p-values using Fisher’s method</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb121"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb121-1"><a href="#cb121-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Fisher's method</span></span>
<span id="cb121-2"><a href="#cb121-2" aria-hidden="true" tabindex="-1"></a>vocFisher_combined <span class="ot">&lt;-</span> <span class="sc">-</span><span class="dv">2</span> <span class="sc">*</span> <span class="fu">sum</span>(<span class="fu">log</span>(vocPValues))</span>
<span id="cb121-3"><a href="#cb121-3" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="dv">2</span> <span class="sc">*</span> <span class="fu">length</span>(vocPValues)</span>
<span id="cb121-4"><a href="#cb121-4" aria-hidden="true" tabindex="-1"></a>vocPCcombined_fisher <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="sc">-</span> <span class="fu">pchisq</span>(vocFisher_combined, df)</span>
<span id="cb121-5"><a href="#cb121-5" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(vocPCcombined_fisher)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.6893521</code></pre>
</div>
<div class="sourceCode cell-code" id="cb123"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb123-1"><a href="#cb123-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Stouffer's method</span></span>
<span id="cb123-2"><a href="#cb123-2" aria-hidden="true" tabindex="-1"></a>vocZ_scores <span class="ot">&lt;-</span> <span class="fu">qnorm</span>(<span class="dv">1</span> <span class="sc">-</span> vocPValues<span class="sc">/</span><span class="dv">2</span>)</span>
<span id="cb123-3"><a href="#cb123-3" aria-hidden="true" tabindex="-1"></a>vocCombined_z <span class="ot">&lt;-</span> <span class="fu">sum</span>(vocZ_scores) <span class="sc">/</span> <span class="fu">sqrt</span>(<span class="fu">length</span>(vocPValues))</span>
<span id="cb123-4"><a href="#cb123-4" aria-hidden="true" tabindex="-1"></a>vocP_combined_stouffer <span class="ot">&lt;-</span> <span class="dv">2</span> <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">-</span> <span class="fu">pnorm</span>(<span class="fu">abs</span>(vocCombined_z)))</span>
<span id="cb123-5"><a href="#cb123-5" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(vocP_combined_stouffer)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.1282563</code></pre>
</div>
</div>
<p>The p-values should sum up to 0.</p>
</section>
<section id="feature-importance-1" class="level4">
<h4 class="anchored" data-anchor-id="feature-importance-1">Feature importance</h4>
<section id="model-1-3" class="level5">
<h5 class="anchored" data-anchor-id="model-1-3">Model 1</h5>
<div class="cell">
<div class="sourceCode cell-code" id="cb125"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb125-1"><a href="#cb125-1" aria-hidden="true" tabindex="-1"></a>XGBvocModel1 <span class="ot">&lt;-</span> vocModel1<span class="sc">$</span>finalModel</span>
<span id="cb125-2"><a href="#cb125-2" aria-hidden="true" tabindex="-1"></a>importanceXGBvocModel1 <span class="ot">&lt;-</span> <span class="fu">xgb.importance</span>(<span class="at">model =</span> XGBvocModel1)</span>
<span id="cb125-3"><a href="#cb125-3" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(importanceXGBvocModel1, <span class="at">n=</span><span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                      Feature       Gain      Cover  Frequency
                       &lt;char&gt;      &lt;num&gt;      &lt;num&gt;      &lt;num&gt;
 1:            envelope_Gmean 0.13602726 0.08502319 0.07502800
 2:        f3_clean_vel_Gmean 0.09818061 0.09322070 0.09070549
 3:             envelope_Gstd 0.07400464 0.05561961 0.04927212
 4:            f1_clean_range 0.07164337 0.07482928 0.07502800
 5:                  VSA_f1f2 0.05515123 0.04918245 0.04143337
 6:         envelope_integral 0.04682987 0.06292669 0.06830907
 7: f1_clean_vel_pospeak_mean 0.04011472 0.03522299 0.03135498
 8:            f3_clean_Gmean 0.03869450 0.03362272 0.03695409
 9:      envelope_change_Gstd 0.02847876 0.03867110 0.03919373
10:            envelope_range 0.02722598 0.02976886 0.03247480</code></pre>
</div>
<div class="sourceCode cell-code" id="cb127"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb127-1"><a href="#cb127-1" aria-hidden="true" tabindex="-1"></a><span class="fu">xgb.plot.importance</span>(importanceXGBvocModel1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="02_XGBoost_effortIndicators_files/figure-html/voc feature importance 1-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="model-2-3" class="level5">
<h5 class="anchored" data-anchor-id="model-2-3">Model 2</h5>
<div class="cell">
<div class="sourceCode cell-code" id="cb128"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb128-1"><a href="#cb128-1" aria-hidden="true" tabindex="-1"></a>XGBvocModel2 <span class="ot">&lt;-</span> vocModel2<span class="sc">$</span>finalModel</span>
<span id="cb128-2"><a href="#cb128-2" aria-hidden="true" tabindex="-1"></a>importanceXGBvocModel2 <span class="ot">&lt;-</span> <span class="fu">xgb.importance</span>(<span class="at">model =</span> XGBvocModel2)</span>
<span id="cb128-3"><a href="#cb128-3" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(importanceXGBvocModel2, <span class="at">n=</span><span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                      Feature       Gain      Cover  Frequency
                       &lt;char&gt;      &lt;num&gt;      &lt;num&gt;      &lt;num&gt;
 1:        f2_clean_pospeak_n 0.13483087 0.13544889 0.12921348
 2:            f1_clean_range 0.12070709 0.16690803 0.14325843
 3:            envelope_Gmean 0.09668145 0.07235325 0.07584270
 4:             f3_clean_Gstd 0.08237970 0.05602321 0.04494382
 5:             envelope_Gstd 0.07577008 0.03880060 0.03370787
 6: envelope_change_pospeak_n 0.06873527 0.03725576 0.04213483
 7:         envelope_integral 0.04674692 0.06279656 0.07865169
 8:            envelope_range 0.04544508 0.01653634 0.01685393
 9:         f2_clean_vel_Gstd 0.03037540 0.01712546 0.01966292
10:                  VSA_f1f2 0.02954035 0.02412326 0.01404494</code></pre>
</div>
<div class="sourceCode cell-code" id="cb130"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb130-1"><a href="#cb130-1" aria-hidden="true" tabindex="-1"></a><span class="fu">xgb.plot.importance</span>(importanceXGBvocModel2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="02_XGBoost_effortIndicators_files/figure-html/voc feature importance 2-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="model-3-3" class="level5">
<h5 class="anchored" data-anchor-id="model-3-3">Model 3</h5>
<div class="cell">
<div class="sourceCode cell-code" id="cb131"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb131-1"><a href="#cb131-1" aria-hidden="true" tabindex="-1"></a>XGBvocModel3 <span class="ot">&lt;-</span> vocModel3<span class="sc">$</span>finalModel</span>
<span id="cb131-2"><a href="#cb131-2" aria-hidden="true" tabindex="-1"></a>importanceXGBvocModel3 <span class="ot">&lt;-</span> <span class="fu">xgb.importance</span>(<span class="at">model =</span> XGBvocModel3)</span>
<span id="cb131-3"><a href="#cb131-3" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(importanceXGBvocModel3, <span class="at">n=</span><span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                  Feature       Gain      Cover  Frequency
                   &lt;char&gt;      &lt;num&gt;      &lt;num&gt;      &lt;num&gt;
 1:        envelope_Gmean 0.19678849 0.13101717 0.11990950
 2:        f1_clean_Gmean 0.06518270 0.06577408 0.05656109
 3:         f1_clean_Gstd 0.06139091 0.05900369 0.04638009
 4:    f2_clean_vel_range 0.05294853 0.04460489 0.04411765
 5:  envelope_change_Gstd 0.05211902 0.05584529 0.04977376
 6:        f1_clean_range 0.04669633 0.05152589 0.05656109
 7:        envelope_range 0.04665922 0.03300070 0.03393665
 8:         envelope_Gstd 0.04528333 0.04547200 0.04751131
 9: envelope_pospeak_mean 0.03633826 0.04397990 0.04751131
10:     f3_clean_vel_Gstd 0.03632154 0.03074968 0.03054299</code></pre>
</div>
<div class="sourceCode cell-code" id="cb133"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb133-1"><a href="#cb133-1" aria-hidden="true" tabindex="-1"></a><span class="fu">xgb.plot.importance</span>(importanceXGBvocModel3)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="02_XGBoost_effortIndicators_files/figure-html/voc feature importance 3-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="model-4-3" class="level5">
<h5 class="anchored" data-anchor-id="model-4-3">Model 4</h5>
<div class="cell">
<div class="sourceCode cell-code" id="cb134"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb134-1"><a href="#cb134-1" aria-hidden="true" tabindex="-1"></a>XGBvocModel4 <span class="ot">&lt;-</span> vocModel4<span class="sc">$</span>finalModel</span>
<span id="cb134-2"><a href="#cb134-2" aria-hidden="true" tabindex="-1"></a>importanceXGBvocModel4 <span class="ot">&lt;-</span> <span class="fu">xgb.importance</span>(<span class="at">model =</span> XGBvocModel4)</span>
<span id="cb134-3"><a href="#cb134-3" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(importanceXGBvocModel4, <span class="at">n=</span><span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                         Feature       Gain      Cover  Frequency
                          &lt;char&gt;      &lt;num&gt;      &lt;num&gt;      &lt;num&gt;
 1:               envelope_Gmean 0.16819530 0.09570472 0.08753316
 2:  envelope_change_pospeak_std 0.08807969 0.07223289 0.06896552
 3:         envelope_change_Gstd 0.08052363 0.06335792 0.05835544
 4:                     VSA_f1f2 0.07818772 0.08241809 0.07161804
 5: envelope_change_pospeak_mean 0.06608976 0.05146865 0.04509284
 6:    f1_clean_vel_pospeak_mean 0.05408322 0.05589466 0.04509284
 7:                envelope_Gstd 0.05269826 0.03871238 0.03183024
 8:               f1_clean_Gmean 0.04965680 0.04615765 0.03713528
 9:                f1_clean_Gstd 0.03815808 0.05655439 0.06631300
10:               f1_clean_range 0.03635432 0.04276747 0.04244032</code></pre>
</div>
<div class="sourceCode cell-code" id="cb136"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb136-1"><a href="#cb136-1" aria-hidden="true" tabindex="-1"></a><span class="fu">xgb.plot.importance</span>(importanceXGBvocModel4)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="02_XGBoost_effortIndicators_files/figure-html/voc feature importance 4-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="model-5-3" class="level5">
<h5 class="anchored" data-anchor-id="model-5-3">Model 5</h5>
<div class="cell">
<div class="sourceCode cell-code" id="cb137"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb137-1"><a href="#cb137-1" aria-hidden="true" tabindex="-1"></a>XGBvocModel5 <span class="ot">&lt;-</span> vocModel5<span class="sc">$</span>finalModel</span>
<span id="cb137-2"><a href="#cb137-2" aria-hidden="true" tabindex="-1"></a>importanceXGBvocModel5 <span class="ot">&lt;-</span> <span class="fu">xgb.importance</span>(<span class="at">model =</span> XGBvocModel5)</span>
<span id="cb137-3"><a href="#cb137-3" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(importanceXGBvocModel5, <span class="at">n=</span><span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                        Feature       Gain      Cover  Frequency
                         &lt;char&gt;      &lt;num&gt;      &lt;num&gt;      &lt;num&gt;
 1:              envelope_Gmean 0.15496456 0.13085882 0.13613445
 2:              f1_clean_range 0.12172902 0.09508698 0.08235294
 3:           f1_clean_vel_Gstd 0.09589133 0.09944857 0.08739496
 4:               envelope_Gstd 0.07687082 0.05204549 0.05042017
 5:       f3_clean_pospeak_mean 0.06338331 0.04400205 0.03865546
 6:          envelope_pospeak_n 0.04257925 0.03277477 0.03361345
 7:              f2_clean_range 0.03612444 0.01860086 0.01680672
 8:               f1_clean_Gstd 0.03560007 0.03146792 0.03025210
 9: envelope_change_pospeak_std 0.03102815 0.02610947 0.01848739
10:           envelope_integral 0.02690926 0.03638461 0.04369748</code></pre>
</div>
<div class="sourceCode cell-code" id="cb139"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb139-1"><a href="#cb139-1" aria-hidden="true" tabindex="-1"></a><span class="fu">xgb.plot.importance</span>(importanceXGBvocModel5)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="02_XGBoost_effortIndicators_files/figure-html/voc feature importance 5-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="cumulative-feature-importance-1" class="level5">
<h5 class="anchored" data-anchor-id="cumulative-feature-importance-1">Cumulative feature importance</h5>
<div class="cell">
<div class="sourceCode cell-code" id="cb140"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb140-1"><a href="#cb140-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Function to extract and normalize importance</span></span>
<span id="cb140-2"><a href="#cb140-2" aria-hidden="true" tabindex="-1"></a>get_normalized_importance <span class="ot">&lt;-</span> <span class="cf">function</span>(model) {</span>
<span id="cb140-3"><a href="#cb140-3" aria-hidden="true" tabindex="-1"></a>  importance <span class="ot">&lt;-</span> <span class="fu">xgb.importance</span>(<span class="at">model =</span> model)</span>
<span id="cb140-4"><a href="#cb140-4" aria-hidden="true" tabindex="-1"></a>  importance<span class="sc">$</span>Gain <span class="ot">&lt;-</span> importance<span class="sc">$</span>Gain <span class="sc">/</span> <span class="fu">sum</span>(importance<span class="sc">$</span>Gain)</span>
<span id="cb140-5"><a href="#cb140-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(importance)</span>
<span id="cb140-6"><a href="#cb140-6" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb140-7"><a href="#cb140-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb140-8"><a href="#cb140-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract normalized importance for each model</span></span>
<span id="cb140-9"><a href="#cb140-9" aria-hidden="true" tabindex="-1"></a>vocImportance1 <span class="ot">&lt;-</span> <span class="fu">get_normalized_importance</span>(vocModel1<span class="sc">$</span>finalModel)</span>
<span id="cb140-10"><a href="#cb140-10" aria-hidden="true" tabindex="-1"></a>vocImportance2 <span class="ot">&lt;-</span> <span class="fu">get_normalized_importance</span>(vocModel2<span class="sc">$</span>finalModel)</span>
<span id="cb140-11"><a href="#cb140-11" aria-hidden="true" tabindex="-1"></a>vocImportance3 <span class="ot">&lt;-</span> <span class="fu">get_normalized_importance</span>(vocModel3<span class="sc">$</span>finalModel)</span>
<span id="cb140-12"><a href="#cb140-12" aria-hidden="true" tabindex="-1"></a>vocImportance4 <span class="ot">&lt;-</span> <span class="fu">get_normalized_importance</span>(vocModel4<span class="sc">$</span>finalModel)</span>
<span id="cb140-13"><a href="#cb140-13" aria-hidden="true" tabindex="-1"></a>vocImportance5 <span class="ot">&lt;-</span> <span class="fu">get_normalized_importance</span>(vocModel5<span class="sc">$</span>finalModel)</span>
<span id="cb140-14"><a href="#cb140-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb140-15"><a href="#cb140-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Combine importances</span></span>
<span id="cb140-16"><a href="#cb140-16" aria-hidden="true" tabindex="-1"></a>vocAllImportances <span class="ot">&lt;-</span> <span class="fu">list</span>(vocImportance1, vocImportance2, vocImportance3, vocImportance4, vocImportance5)</span>
<span id="cb140-17"><a href="#cb140-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb140-18"><a href="#cb140-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Function to merge importances</span></span>
<span id="cb140-19"><a href="#cb140-19" aria-hidden="true" tabindex="-1"></a>merge_importances <span class="ot">&lt;-</span> <span class="cf">function</span>(importances) {</span>
<span id="cb140-20"><a href="#cb140-20" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">2</span><span class="sc">:</span><span class="fu">length</span>(importances)) {</span>
<span id="cb140-21"><a href="#cb140-21" aria-hidden="true" tabindex="-1"></a>    <span class="fu">names</span>(importances[[i]])[<span class="dv">2</span><span class="sc">:</span><span class="dv">4</span>] <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="fu">names</span>(importances[[i]])[<span class="dv">2</span><span class="sc">:</span><span class="dv">4</span>], <span class="st">"_"</span>, i)</span>
<span id="cb140-22"><a href="#cb140-22" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb140-23"><a href="#cb140-23" aria-hidden="true" tabindex="-1"></a>  merged <span class="ot">&lt;-</span> <span class="fu">Reduce</span>(<span class="cf">function</span>(x, y) <span class="fu">merge</span>(x, y, <span class="at">by =</span> <span class="st">"Feature"</span>, <span class="at">all =</span> <span class="cn">TRUE</span>), importances)</span>
<span id="cb140-24"><a href="#cb140-24" aria-hidden="true" tabindex="-1"></a>  merged[<span class="fu">is.na</span>(merged)] <span class="ot">&lt;-</span> <span class="dv">0</span>  <span class="co"># Replace NAs with 0</span></span>
<span id="cb140-25"><a href="#cb140-25" aria-hidden="true" tabindex="-1"></a>  gain_cols <span class="ot">&lt;-</span> <span class="fu">grep</span>(<span class="st">"Gain"</span>, <span class="fu">colnames</span>(merged), <span class="at">value =</span> <span class="cn">TRUE</span>)</span>
<span id="cb140-26"><a href="#cb140-26" aria-hidden="true" tabindex="-1"></a>  merged<span class="sc">$</span>Cumulative <span class="ot">&lt;-</span> <span class="fu">rowSums</span>(merged[, ..gain_cols])</span>
<span id="cb140-27"><a href="#cb140-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(merged[, .(Feature, Cumulative)])</span>
<span id="cb140-28"><a href="#cb140-28" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb140-29"><a href="#cb140-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb140-30"><a href="#cb140-30" aria-hidden="true" tabindex="-1"></a><span class="co"># Merge and sort importances</span></span>
<span id="cb140-31"><a href="#cb140-31" aria-hidden="true" tabindex="-1"></a>vocCumulativeImportance <span class="ot">&lt;-</span> <span class="fu">merge_importances</span>(vocAllImportances)</span>
<span id="cb140-32"><a href="#cb140-32" aria-hidden="true" tabindex="-1"></a>vocCumulativeImportance <span class="ot">&lt;-</span> vocCumulativeImportance[<span class="fu">order</span>(<span class="sc">-</span>vocCumulativeImportance<span class="sc">$</span>Cumulative), ]</span>
<span id="cb140-33"><a href="#cb140-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb140-34"><a href="#cb140-34" aria-hidden="true" tabindex="-1"></a><span class="co"># Print cumulative feature importance</span></span>
<span id="cb140-35"><a href="#cb140-35" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(vocCumulativeImportance, <span class="at">n=</span><span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                 Feature Cumulative
                  &lt;char&gt;      &lt;num&gt;
 1:       envelope_Gmean  0.7526571
 2:       f1_clean_range  0.3971301
 3:        envelope_Gstd  0.3246271
 4: envelope_change_Gstd  0.2136246
 5:   f2_clean_pospeak_n  0.1929605
 6:             VSA_f1f2  0.1870122
 7:       f1_clean_Gmean  0.1636278
 8:        f1_clean_Gstd  0.1584567
 9:    envelope_integral  0.1578377
10:   f3_clean_vel_Gmean  0.1536120</code></pre>
</div>
</div>
</section>
</section>
<section id="pca-1" class="level4">
<h4 class="anchored" data-anchor-id="pca-1">PCA</h4>
<p>Now let’s collect 10 features per component that have highest combined ranking from PCA and XGBoost. This means that for each feature we sum up the ranking it obtained in cumulative importance (XGBoost) and loading on a principal component (PCA).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb142"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb142-1"><a href="#cb142-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Rank the features based on XGBoost importance (cumulative)</span></span>
<span id="cb142-2"><a href="#cb142-2" aria-hidden="true" tabindex="-1"></a>vocCumulativeImportance<span class="sc">$</span>XGB_Rank <span class="ot">&lt;-</span> <span class="fu">rank</span>(<span class="sc">-</span>vocCumulativeImportance<span class="sc">$</span>Cumulative)</span>
<span id="cb142-3"><a href="#cb142-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-4"><a href="#cb142-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Load in PCA for gesture</span></span>
<span id="cb142-5"><a href="#cb142-5" aria-hidden="true" tabindex="-1"></a>voc_pca <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="fu">paste0</span>(datasets, <span class="st">"PCA_top_contributors_voc.csv"</span>))</span>
<span id="cb142-6"><a href="#cb142-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-7"><a href="#cb142-7" aria-hidden="true" tabindex="-1"></a><span class="co"># For each PC (PC1, PC2, PC3), rank the features based on their loadings</span></span>
<span id="cb142-8"><a href="#cb142-8" aria-hidden="true" tabindex="-1"></a>combined_ranks_per_pc <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb142-9"><a href="#cb142-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-10"><a href="#cb142-10" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (pc <span class="cf">in</span> <span class="fu">c</span>(<span class="st">"PC1"</span>, <span class="st">"PC2"</span>, <span class="st">"PC3"</span>)) {</span>
<span id="cb142-11"><a href="#cb142-11" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Extract the features and loadings for the current PC</span></span>
<span id="cb142-12"><a href="#cb142-12" aria-hidden="true" tabindex="-1"></a>  pca_pc_loadings <span class="ot">&lt;-</span> voc_pca[, <span class="fu">c</span>(pc, <span class="fu">paste0</span>(pc, <span class="st">"_Loading"</span>))]</span>
<span id="cb142-13"><a href="#cb142-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">colnames</span>(pca_pc_loadings) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Feature"</span>, <span class="st">"Loading"</span>)</span>
<span id="cb142-14"><a href="#cb142-14" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb142-15"><a href="#cb142-15" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Rank the features based on the absolute loading values (higher loadings should get lower rank)</span></span>
<span id="cb142-16"><a href="#cb142-16" aria-hidden="true" tabindex="-1"></a>  pca_pc_loadings<span class="sc">$</span>PCA_Rank <span class="ot">&lt;-</span> <span class="fu">rank</span>(<span class="sc">-</span><span class="fu">abs</span>(pca_pc_loadings<span class="sc">$</span>Loading))</span>
<span id="cb142-17"><a href="#cb142-17" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb142-18"><a href="#cb142-18" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Merge PCA loadings with XGBoost importance ranks</span></span>
<span id="cb142-19"><a href="#cb142-19" aria-hidden="true" tabindex="-1"></a>  merged_data <span class="ot">&lt;-</span> <span class="fu">merge</span>(pca_pc_loadings, vocCumulativeImportance[, <span class="fu">c</span>(<span class="st">"Feature"</span>, <span class="st">"XGB_Rank"</span>)], <span class="at">by =</span> <span class="st">"Feature"</span>)</span>
<span id="cb142-20"><a href="#cb142-20" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb142-21"><a href="#cb142-21" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Calculate combined rank by summing XGBoost rank and PCA rank</span></span>
<span id="cb142-22"><a href="#cb142-22" aria-hidden="true" tabindex="-1"></a>  merged_data<span class="sc">$</span>Combined_Rank <span class="ot">&lt;-</span> merged_data<span class="sc">$</span>XGB_Rank <span class="sc">+</span> merged_data<span class="sc">$</span>PCA_Rank</span>
<span id="cb142-23"><a href="#cb142-23" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb142-24"><a href="#cb142-24" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Sort by the combined rank (lower rank is better)</span></span>
<span id="cb142-25"><a href="#cb142-25" aria-hidden="true" tabindex="-1"></a>  sorted_data <span class="ot">&lt;-</span> merged_data[<span class="fu">order</span>(merged_data<span class="sc">$</span>Combined_Rank), ]</span>
<span id="cb142-26"><a href="#cb142-26" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb142-27"><a href="#cb142-27" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Select the top n features based on the combined rank for the current PC</span></span>
<span id="cb142-28"><a href="#cb142-28" aria-hidden="true" tabindex="-1"></a>  top_n_features <span class="ot">&lt;-</span> <span class="dv">10</span>  <span class="co"># Adjust the number of top features as needed</span></span>
<span id="cb142-29"><a href="#cb142-29" aria-hidden="true" tabindex="-1"></a>  combined_ranks_per_pc[[pc]] <span class="ot">&lt;-</span> <span class="fu">head</span>(sorted_data, top_n_features)</span>
<span id="cb142-30"><a href="#cb142-30" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb142-31"><a href="#cb142-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-32"><a href="#cb142-32" aria-hidden="true" tabindex="-1"></a><span class="co"># Output the top features per PC based on combined ranking</span></span>
<span id="cb142-33"><a href="#cb142-33" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(combined_ranks_per_pc, <span class="at">n=</span><span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$PC1
              Feature    Loading PCA_Rank XGB_Rank Combined_Rank
21     f1_clean_range -0.2038667        7        2             9
31 f2_clean_pospeak_n -0.1992125        9        5            14
50           VSA_f1f2 -0.1981162       10        6            16
19      f1_clean_Gstd -0.1609309       16        8            24
38 f2_clean_vel_range -0.2093378        4       20            24
27 f1_clean_vel_range -0.2044053        6       24            30
32     f2_clean_range -0.2012178        8       23            31
13  envelope_integral -0.1301649       23        9            32
40      f3_clean_Gstd -0.1385837       19       13            32
29      f2_clean_Gstd -0.2075814        5       29            34

$PC2
                     Feature     Loading PCA_Rank XGB_Rank Combined_Rank
13         envelope_integral -0.17231302        7        9            16
11            envelope_Gmean -0.14800731       20        1            21
12             envelope_Gstd -0.14806488       19        3            22
41     f3_clean_pospeak_mean  0.20209426        6       22            28
44        f3_clean_vel_Gmean -0.14362905       21       10            31
5       envelope_change_Gstd  0.11631278       29        4            33
17            envelope_range -0.14099569       22       12            34
18            f1_clean_Gmean  0.11723539       28        7            35
8  envelope_change_pospeak_n  0.13615851       25       17            42
19             f1_clean_Gstd -0.09502265       35        8            43

$PC3
                     Feature     Loading PCA_Rank XGB_Rank Combined_Rank
5       envelope_change_Gstd  0.20397194       11        4            15
12             envelope_Gstd  0.17081447       12        3            15
11            envelope_Gmean  0.14034453       15        1            16
19             f1_clean_Gstd -0.12711091       18        8            26
13         envelope_integral  0.11466983       21        9            30
18            f1_clean_Gmean -0.10469280       23        7            30
8  envelope_change_pospeak_n  0.13146985       16       17            33
4      envelope_change_Gmean  0.25484373        4       30            34
17            envelope_range  0.06834337       27       12            39
41     f3_clean_pospeak_mean -0.12623294       19       22            41</code></pre>
</div>
</div>
<p>For modelling, we want to pick three features per component. Which would it be in this case?</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb144"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb144-1"><a href="#cb144-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Number of top features to display</span></span>
<span id="cb144-2"><a href="#cb144-2" aria-hidden="true" tabindex="-1"></a>top_n_features <span class="ot">&lt;-</span> <span class="dv">3</span></span>
<span id="cb144-3"><a href="#cb144-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb144-4"><a href="#cb144-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Print the top 3 features per component</span></span>
<span id="cb144-5"><a href="#cb144-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (pc <span class="cf">in</span> <span class="fu">c</span>(<span class="st">"PC1"</span>, <span class="st">"PC2"</span>, <span class="st">"PC3"</span>)) {</span>
<span id="cb144-6"><a href="#cb144-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">Top 3 Features for"</span>, pc, <span class="st">":</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb144-7"><a href="#cb144-7" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb144-8"><a href="#cb144-8" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Get the top 3 features based on combined rank for the current PC</span></span>
<span id="cb144-9"><a href="#cb144-9" aria-hidden="true" tabindex="-1"></a>  top_features <span class="ot">&lt;-</span> <span class="fu">head</span>(combined_ranks_per_pc[[pc]], top_n_features)</span>
<span id="cb144-10"><a href="#cb144-10" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb144-11"><a href="#cb144-11" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Print the results</span></span>
<span id="cb144-12"><a href="#cb144-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(top_features[, <span class="fu">c</span>(<span class="st">"Feature"</span>, <span class="st">"XGB_Rank"</span>, <span class="st">"PCA_Rank"</span>, <span class="st">"Combined_Rank"</span>)])</span>
<span id="cb144-13"><a href="#cb144-13" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Top 3 Features for PC1 :
              Feature XGB_Rank PCA_Rank Combined_Rank
21     f1_clean_range        2        7             9
31 f2_clean_pospeak_n        5        9            14
50           VSA_f1f2        6       10            16

Top 3 Features for PC2 :
             Feature XGB_Rank PCA_Rank Combined_Rank
13 envelope_integral        9        7            16
11    envelope_Gmean        1       20            21
12     envelope_Gstd        3       19            22

Top 3 Features for PC3 :
                Feature XGB_Rank PCA_Rank Combined_Rank
5  envelope_change_Gstd        4       11            15
12        envelope_Gstd        3       12            15
11       envelope_Gmean        1       15            16</code></pre>
</div>
</div>
</section>
</section>
</section>
</section>
<section id="multimodal" class="level1">
<h1>Multimodal</h1>
<p>Now we take trials from combined modality and follow identical workflow.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb146"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb146-1"><a href="#cb146-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Load</span></span>
<span id="cb146-2"><a href="#cb146-2" aria-hidden="true" tabindex="-1"></a>data_mult <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="fu">paste0</span>(datasets, <span class="st">"multi_clean_df.csv"</span>))</span>
<span id="cb146-3"><a href="#cb146-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-4"><a href="#cb146-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Make predictor a factor variable</span></span>
<span id="cb146-5"><a href="#cb146-5" aria-hidden="true" tabindex="-1"></a>data_mult<span class="sc">$</span>correction_info <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(data_mult<span class="sc">$</span>correction_info)</span>
<span id="cb146-6"><a href="#cb146-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-7"><a href="#cb146-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Display</span></span>
<span id="cb146-8"><a href="#cb146-8" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(data_mult, <span class="at">n=</span><span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 10 × 395
   arm_duration arm_inter_Kin arm_inter_IK arm_bbmv lowerbody_duration
          &lt;dbl&gt;         &lt;dbl&gt;        &lt;dbl&gt;    &lt;dbl&gt;              &lt;dbl&gt;
 1         3988          26.2         26.7     8.47               2020
 2         3868          26.7         28.1     8.15               2870
 3         4014          26.4         27.6     8.46                874
 4         4046          26.2         28.6     8.48               3750
 5         4708          26.5         28.7     8.31               4508
 6         4004          27.0         28.6     8.70               3598
 7            0           0            0       0                   784
 8         5248          29.0         31.7    10.9                4930
 9         1784          25.0         24.2     6.60                  0
10         1284          24.3         24.5     5.05               1334
# ℹ 390 more variables: lowerbody_inter_Kin &lt;dbl&gt;, lowerbody_inter_IK &lt;dbl&gt;,
#   lowerbody_bbmv &lt;dbl&gt;, leg_duration &lt;dbl&gt;, leg_inter_Kin &lt;dbl&gt;,
#   leg_inter_IK &lt;dbl&gt;, leg_bbmv &lt;dbl&gt;, head_duration &lt;dbl&gt;,
#   head_inter_Kin &lt;dbl&gt;, head_inter_IK &lt;dbl&gt;, head_bbmv &lt;dbl&gt;,
#   arm_moment_sum_Gmean &lt;dbl&gt;, arm_moment_sum_Gstd &lt;dbl&gt;,
#   arm_moment_sum_pospeak_n &lt;dbl&gt;, arm_moment_sum_integral &lt;dbl&gt;,
#   arm_moment_sum_range &lt;dbl&gt;, arm_moment_sum_change_Gmean &lt;dbl&gt;, …</code></pre>
</div>
</div>
<section id="random-forests-2" class="level2">
<h2 class="anchored" data-anchor-id="random-forests-2">Random forests</h2>
<p>We will build a random forest first.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb148"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb148-1"><a href="#cb148-1" aria-hidden="true" tabindex="-1"></a><span class="co"># prepare predictors</span></span>
<span id="cb148-2"><a href="#cb148-2" aria-hidden="true" tabindex="-1"></a>predictors <span class="ot">&lt;-</span> <span class="fu">setdiff</span>(<span class="fu">names</span>(data_mult), <span class="st">"correction_info"</span>)</span>
<span id="cb148-3"><a href="#cb148-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-4"><a href="#cb148-4" aria-hidden="true" tabindex="-1"></a>formula_str <span class="ot">&lt;-</span> <span class="fu">paste</span>(<span class="st">"correction_info ~"</span>, <span class="fu">paste</span>(predictors, <span class="at">collapse =</span> <span class="st">" + "</span>))</span>
<span id="cb148-5"><a href="#cb148-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-6"><a href="#cb148-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert the formula string to a formula object</span></span>
<span id="cb148-7"><a href="#cb148-7" aria-hidden="true" tabindex="-1"></a>multTree_formula <span class="ot">&lt;-</span> <span class="fu">as.formula</span>(formula_str)</span>
<span id="cb148-8"><a href="#cb148-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-9"><a href="#cb148-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Now use the formula in rpart</span></span>
<span id="cb148-10"><a href="#cb148-10" aria-hidden="true" tabindex="-1"></a>multTree <span class="ot">&lt;-</span> <span class="fu">rpart</span>(<span class="at">formula =</span> multTree_formula, <span class="at">data =</span> data_mult, </span>
<span id="cb148-11"><a href="#cb148-11" aria-hidden="true" tabindex="-1"></a>                <span class="at">method=</span><span class="st">'class'</span>, <span class="co"># Specify that it's a classification tree</span></span>
<span id="cb148-12"><a href="#cb148-12" aria-hidden="true" tabindex="-1"></a>                <span class="at">control =</span> <span class="fu">rpart.control</span>(<span class="at">maxdepth =</span> <span class="dv">5</span>)  <span class="co"># Control parameters for the 'rpart' function</span></span>
<span id="cb148-13"><a href="#cb148-13" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb148-14"><a href="#cb148-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-15"><a href="#cb148-15" aria-hidden="true" tabindex="-1"></a><span class="fu">prp</span>(</span>
<span id="cb148-16"><a href="#cb148-16" aria-hidden="true" tabindex="-1"></a>  multTree,         <span class="co"># The decision tree object to be visualized</span></span>
<span id="cb148-17"><a href="#cb148-17" aria-hidden="true" tabindex="-1"></a>  <span class="at">extra =</span> <span class="dv">1</span>,      <span class="co"># Show extra information (like node statistics) in the plot</span></span>
<span id="cb148-18"><a href="#cb148-18" aria-hidden="true" tabindex="-1"></a>  <span class="at">varlen =</span> <span class="dv">0</span>,     <span class="co"># Length of variable names (0 means auto-determined)</span></span>
<span id="cb148-19"><a href="#cb148-19" aria-hidden="true" tabindex="-1"></a>  <span class="at">faclen =</span> <span class="dv">0</span>     <span class="co"># Length of factor levels displayed on the plot (increase as needed)</span></span>
<span id="cb148-20"><a href="#cb148-20" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="02_XGBoost_effortIndicators_files/figure-html/mult random forest-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Split the data</p>
<p>Building the untuned model.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb149"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb149-1"><a href="#cb149-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Untuned Model with importance (permutation) option set</span></span>
<span id="cb149-2"><a href="#cb149-2" aria-hidden="true" tabindex="-1"></a>multUntuned <span class="ot">&lt;-</span> <span class="fu">ranger</span>(</span>
<span id="cb149-3"><a href="#cb149-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">y =</span> train_data<span class="sc">$</span>correction_info,</span>
<span id="cb149-4"><a href="#cb149-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">x =</span> train_data[,<span class="dv">0</span><span class="sc">:</span><span class="dv">394</span>], <span class="co"># without OV</span></span>
<span id="cb149-5"><a href="#cb149-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">num.trees =</span> <span class="dv">500</span>,</span>
<span id="cb149-6"><a href="#cb149-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">importance =</span> <span class="st">"permutation"</span></span>
<span id="cb149-7"><a href="#cb149-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb149-8"><a href="#cb149-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb149-9"><a href="#cb149-9" aria-hidden="true" tabindex="-1"></a>predictions <span class="ot">&lt;-</span> <span class="fu">predict</span>(multUntuned, <span class="at">data =</span> test_data)<span class="sc">$</span>predictions</span>
<span id="cb149-10"><a href="#cb149-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb149-11"><a href="#cb149-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a confusion matrix</span></span>
<span id="cb149-12"><a href="#cb149-12" aria-hidden="true" tabindex="-1"></a>confusion_matrix <span class="ot">&lt;-</span> <span class="fu">confusionMatrix</span>(predictions, test_data<span class="sc">$</span>correction_info)</span>
<span id="cb149-13"><a href="#cb149-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb149-14"><a href="#cb149-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Print the confusion matrix</span></span>
<span id="cb149-15"><a href="#cb149-15" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(confusion_matrix)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Confusion Matrix and Statistics

          Reference
Prediction c0 c0_only c1 c2
   c0       0       0  0  0
   c0_only  1       0  0  0
   c1       0       1  0  1
   c2       0       0  1  0

Overall Statistics
                                     
               Accuracy : 0          
                 95% CI : (0, 0.6024)
    No Information Rate : 0.25       
    P-Value [Acc &gt; NIR] : 1          
                                     
                  Kappa : -0.3333    
                                     
 Mcnemar's Test P-Value : NA         

Statistics by Class:

                     Class: c0 Class: c0_only Class: c1 Class: c2
Sensitivity               0.00         0.0000    0.0000    0.0000
Specificity               1.00         0.6667    0.3333    0.6667
Pos Pred Value             NaN         0.0000    0.0000    0.0000
Neg Pred Value            0.75         0.6667    0.5000    0.6667
Prevalence                0.25         0.2500    0.2500    0.2500
Detection Rate            0.00         0.0000    0.0000    0.0000
Detection Prevalence      0.00         0.2500    0.5000    0.2500
Balanced Accuracy         0.50         0.3333    0.1667    0.3333</code></pre>
</div>
<div class="sourceCode cell-code" id="cb151"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb151-1"><a href="#cb151-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate feature importance</span></span>
<span id="cb151-2"><a href="#cb151-2" aria-hidden="true" tabindex="-1"></a>feature_importance <span class="ot">&lt;-</span> <span class="fu">importance</span>(multUntuned, <span class="at">num.threads =</span> <span class="dv">1</span>, <span class="at">type =</span> <span class="dv">1</span>) </span>
<span id="cb151-3"><a href="#cb151-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb151-4"><a href="#cb151-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert to data frame</span></span>
<span id="cb151-5"><a href="#cb151-5" aria-hidden="true" tabindex="-1"></a>feature_importance <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(feature_importance, <span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span>)</span>
<span id="cb151-6"><a href="#cb151-6" aria-hidden="true" tabindex="-1"></a>feature_importance<span class="sc">$</span>Feature <span class="ot">&lt;-</span> <span class="fu">rownames</span>(feature_importance)</span>
<span id="cb151-7"><a href="#cb151-7" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(feature_importance) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Importance"</span>, <span class="st">"Feature"</span>)</span>
<span id="cb151-8"><a href="#cb151-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb151-9"><a href="#cb151-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Sort by importance</span></span>
<span id="cb151-10"><a href="#cb151-10" aria-hidden="true" tabindex="-1"></a>sorted_feature_importance <span class="ot">&lt;-</span> feature_importance[<span class="fu">order</span>(<span class="sc">-</span>feature_importance<span class="sc">$</span>Importance), ]</span>
<span id="cb151-11"><a href="#cb151-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb151-12"><a href="#cb151-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Print sorted feature importance</span></span>
<span id="cb151-13"><a href="#cb151-13" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(sorted_feature_importance, <span class="at">n=</span><span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                                   Importance                           Feature
envelope_change_pospeak_mean      0.004966667      envelope_change_pospeak_mean
arm_power_pospeak_std             0.003269048             arm_power_pospeak_std
leg_angJerk_sum_pospeak_mean      0.002706349      leg_angJerk_sum_pospeak_mean
arm_accKin_sum_range              0.002615079              arm_accKin_sum_range
lowerbody_jerkKin_sum_Gmean       0.002487302       lowerbody_jerkKin_sum_Gmean
head_speedKin_sum_pospeak_n       0.002206349       head_speedKin_sum_pospeak_n
lowerbody_jerkKin_sum_pospeak_std 0.002028571 lowerbody_jerkKin_sum_pospeak_std
head_angSpeed_sum_range           0.001966667           head_angSpeed_sum_range
arm_accKin_sum_Gmean              0.001816667              arm_accKin_sum_Gmean
head_moment_sum_change_integral   0.001815079   head_moment_sum_change_integral</code></pre>
</div>
</div>
<p>Set the parameters for the random forest.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb153"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb153-1"><a href="#cb153-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Define the number of CPU cores to use</span></span>
<span id="cb153-2"><a href="#cb153-2" aria-hidden="true" tabindex="-1"></a>num_cores <span class="ot">&lt;-</span> <span class="fu">detectCores</span>()</span>
<span id="cb153-3"><a href="#cb153-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-4"><a href="#cb153-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a cluster with specified number of cores</span></span>
<span id="cb153-5"><a href="#cb153-5" aria-hidden="true" tabindex="-1"></a>cl <span class="ot">&lt;-</span> <span class="fu">makeCluster</span>(num_cores)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Tuning the random forest.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb154"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb154-1"><a href="#cb154-1" aria-hidden="true" tabindex="-1"></a>tuneMult <span class="ot">&lt;-</span> <span class="fu">makeClassifTask</span>(<span class="at">data =</span> data_mult[,<span class="dv">0</span><span class="sc">:</span><span class="dv">395</span>], <span class="co"># with OV</span></span>
<span id="cb154-2"><a href="#cb154-2" aria-hidden="true" tabindex="-1"></a>                           <span class="at">target =</span> <span class="st">"correction_info"</span>)</span>
<span id="cb154-3"><a href="#cb154-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb154-4"><a href="#cb154-4" aria-hidden="true" tabindex="-1"></a>tuneMult <span class="ot">&lt;-</span> <span class="fu">tuneRanger</span>(tuneMult,</span>
<span id="cb154-5"><a href="#cb154-5" aria-hidden="true" tabindex="-1"></a>                      <span class="at">measure =</span> <span class="fu">list</span>(multiclass.brier),</span>
<span id="cb154-6"><a href="#cb154-6" aria-hidden="true" tabindex="-1"></a>                      <span class="at">num.trees =</span> <span class="dv">500</span>)</span>
<span id="cb154-7"><a href="#cb154-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb154-8"><a href="#cb154-8" aria-hidden="true" tabindex="-1"></a><span class="co">#Return hyperparameter values</span></span>
<span id="cb154-9"><a href="#cb154-9" aria-hidden="true" tabindex="-1"></a><span class="co">#tuneMult</span></span>
<span id="cb154-10"><a href="#cb154-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb154-11"><a href="#cb154-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Recommended parameter settings: </span></span>
<span id="cb154-12"><a href="#cb154-12" aria-hidden="true" tabindex="-1"></a><span class="co">#   mtry min.node.size sample.fraction</span></span>
<span id="cb154-13"><a href="#cb154-13" aria-hidden="true" tabindex="-1"></a><span class="co"># 1  232             3         0.70919</span></span>
<span id="cb154-14"><a href="#cb154-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Results: </span></span>
<span id="cb154-15"><a href="#cb154-15" aria-hidden="true" tabindex="-1"></a><span class="co">#   multiclass.brier exec.time</span></span>
<span id="cb154-16"><a href="#cb154-16" aria-hidden="true" tabindex="-1"></a><span class="co"># 1        0.7385408       0.2</span></span>
<span id="cb154-17"><a href="#cb154-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb154-18"><a href="#cb154-18" aria-hidden="true" tabindex="-1"></a>multTuned <span class="ot">&lt;-</span> <span class="fu">ranger</span>(</span>
<span id="cb154-19"><a href="#cb154-19" aria-hidden="true" tabindex="-1"></a>  <span class="at">y =</span> train_data<span class="sc">$</span>correction_info,</span>
<span id="cb154-20"><a href="#cb154-20" aria-hidden="true" tabindex="-1"></a>  <span class="at">x =</span> train_data[,<span class="dv">0</span><span class="sc">:</span><span class="dv">394</span>],  <span class="co"># without OV</span></span>
<span id="cb154-21"><a href="#cb154-21" aria-hidden="true" tabindex="-1"></a>  <span class="at">num.trees =</span> <span class="dv">5000</span>, </span>
<span id="cb154-22"><a href="#cb154-22" aria-hidden="true" tabindex="-1"></a>  <span class="at">mtry =</span> <span class="dv">232</span>, <span class="co"># Set the recommended mtry value (number of features).</span></span>
<span id="cb154-23"><a href="#cb154-23" aria-hidden="true" tabindex="-1"></a>  <span class="at">min.node.size =</span> <span class="dv">3</span>, <span class="co"># Set the recommended min.node.size value (number of samples before a node terminates).</span></span>
<span id="cb154-24"><a href="#cb154-24" aria-hidden="true" tabindex="-1"></a>  <span class="at">sample.fraction =</span> <span class="fl">0.70919</span>, <span class="co"># Set the recommended sample fraction value.(% of data for bagging).</span></span>
<span id="cb154-25"><a href="#cb154-25" aria-hidden="true" tabindex="-1"></a>  <span class="at">importance =</span> <span class="st">"permutation"</span> <span class="co"># Permutation is a computationally intensive test.</span></span>
<span id="cb154-26"><a href="#cb154-26" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb154-27"><a href="#cb154-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb154-28"><a href="#cb154-28" aria-hidden="true" tabindex="-1"></a>predictions <span class="ot">&lt;-</span> <span class="fu">predict</span>(multTuned, <span class="at">data =</span> test_data)<span class="sc">$</span>predictions</span>
<span id="cb154-29"><a href="#cb154-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb154-30"><a href="#cb154-30" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a confusion matrix</span></span>
<span id="cb154-31"><a href="#cb154-31" aria-hidden="true" tabindex="-1"></a>confusion_matrix <span class="ot">&lt;-</span> <span class="fu">confusionMatrix</span>(predictions, test_data<span class="sc">$</span>correction_info)</span>
<span id="cb154-32"><a href="#cb154-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb154-33"><a href="#cb154-33" aria-hidden="true" tabindex="-1"></a><span class="co"># Print the confusion matrix</span></span>
<span id="cb154-34"><a href="#cb154-34" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(confusion_matrix)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Confusion Matrix and Statistics

          Reference
Prediction c0 c0_only c1 c2
   c0       0       0  0  0
   c0_only  0       0  0  0
   c1       1       1  0  1
   c2       0       0  1  0

Overall Statistics
                                     
               Accuracy : 0          
                 95% CI : (0, 0.6024)
    No Information Rate : 0.25       
    P-Value [Acc &gt; NIR] : 1          
                                     
                  Kappa : -0.3333    
                                     
 Mcnemar's Test P-Value : NA         

Statistics by Class:

                     Class: c0 Class: c0_only Class: c1 Class: c2
Sensitivity               0.00           0.00      0.00    0.0000
Specificity               1.00           1.00      0.00    0.6667
Pos Pred Value             NaN            NaN      0.00    0.0000
Neg Pred Value            0.75           0.75      0.00    0.6667
Prevalence                0.25           0.25      0.25    0.2500
Detection Rate            0.00           0.00      0.00    0.0000
Detection Prevalence      0.00           0.00      0.75    0.2500
Balanced Accuracy         0.50           0.50      0.00    0.3333</code></pre>
</div>
<div class="sourceCode cell-code" id="cb156"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb156-1"><a href="#cb156-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate feature importance</span></span>
<span id="cb156-2"><a href="#cb156-2" aria-hidden="true" tabindex="-1"></a>feature_importance <span class="ot">&lt;-</span> <span class="fu">importance</span>(multTuned, <span class="at">num.threads =</span> <span class="dv">1</span>, <span class="at">type =</span> <span class="dv">1</span>) </span>
<span id="cb156-3"><a href="#cb156-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb156-4"><a href="#cb156-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert to data frame</span></span>
<span id="cb156-5"><a href="#cb156-5" aria-hidden="true" tabindex="-1"></a>feature_importance <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(feature_importance, <span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span>)</span>
<span id="cb156-6"><a href="#cb156-6" aria-hidden="true" tabindex="-1"></a>feature_importance<span class="sc">$</span>Feature <span class="ot">&lt;-</span> <span class="fu">rownames</span>(feature_importance)</span>
<span id="cb156-7"><a href="#cb156-7" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(feature_importance) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Importance"</span>, <span class="st">"Feature"</span>)</span>
<span id="cb156-8"><a href="#cb156-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb156-9"><a href="#cb156-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Sort by importance</span></span>
<span id="cb156-10"><a href="#cb156-10" aria-hidden="true" tabindex="-1"></a>sorted_feature_importance <span class="ot">&lt;-</span> feature_importance[<span class="fu">order</span>(<span class="sc">-</span>feature_importance<span class="sc">$</span>Importance), ]</span>
<span id="cb156-11"><a href="#cb156-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb156-12"><a href="#cb156-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Print sorted feature importance</span></span>
<span id="cb156-13"><a href="#cb156-13" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(sorted_feature_importance, <span class="at">n=</span><span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                                   Importance                           Feature
arm_power_pospeak_std             0.006726943             arm_power_pospeak_std
arm_accKin_sum_range              0.003974206              arm_accKin_sum_range
leg_speedKin_sum_pospeak_mean     0.003076378     leg_speedKin_sum_pospeak_mean
leg_accKin_sum_pospeak_mean       0.002952482       leg_accKin_sum_pospeak_mean
envelope_change_pospeak_mean      0.001955000      envelope_change_pospeak_mean
lowerbody_jerkKin_sum_Gmean       0.001952301       lowerbody_jerkKin_sum_Gmean
head_angSpeed_sum_range           0.001771530           head_angSpeed_sum_range
leg_angJerk_sum_pospeak_mean      0.001765200      leg_angJerk_sum_pospeak_mean
lowerbody_jerkKin_sum_pospeak_std 0.001732114 lowerbody_jerkKin_sum_pospeak_std
arm_accKin_sum_Gstd               0.001284538               arm_accKin_sum_Gstd</code></pre>
</div>
<div class="sourceCode cell-code" id="cb158"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb158-1"><a href="#cb158-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Close the cluster when you're done with your parallel tasks</span></span>
<span id="cb158-2"><a href="#cb158-2" aria-hidden="true" tabindex="-1"></a><span class="co">#stopCluster(cl)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Create a tuned model only.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb159"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb159-1"><a href="#cb159-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a classification task for tuning</span></span>
<span id="cb159-2"><a href="#cb159-2" aria-hidden="true" tabindex="-1"></a>tuneMult <span class="ot">&lt;-</span> <span class="fu">makeClassifTask</span>(<span class="at">data =</span> train_data[, <span class="dv">0</span><span class="sc">:</span><span class="dv">395</span>], <span class="at">target =</span> <span class="st">"correction_info"</span>) <span class="co"># with OV</span></span>
<span id="cb159-3"><a href="#cb159-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb159-4"><a href="#cb159-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Tune the model</span></span>
<span id="cb159-5"><a href="#cb159-5" aria-hidden="true" tabindex="-1"></a>tuneMult <span class="ot">&lt;-</span> <span class="fu">tuneRanger</span>(tuneMult, <span class="at">measure =</span> <span class="fu">list</span>(multiclass.brier), <span class="at">num.trees =</span> <span class="dv">500</span>)</span>
<span id="cb159-6"><a href="#cb159-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb159-7"><a href="#cb159-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Return hyperparameter values</span></span>
<span id="cb159-8"><a href="#cb159-8" aria-hidden="true" tabindex="-1"></a><span class="co">#tuneMult</span></span>
<span id="cb159-9"><a href="#cb159-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Recommended parameter settings: </span></span>
<span id="cb159-10"><a href="#cb159-10" aria-hidden="true" tabindex="-1"></a><span class="co"># mtry min.node.size sample.fraction</span></span>
<span id="cb159-11"><a href="#cb159-11" aria-hidden="true" tabindex="-1"></a><span class="co"># 1  268             3       0.3295434</span></span>
<span id="cb159-12"><a href="#cb159-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Results: </span></span>
<span id="cb159-13"><a href="#cb159-13" aria-hidden="true" tabindex="-1"></a><span class="co">#   multiclass.brier exec.time</span></span>
<span id="cb159-14"><a href="#cb159-14" aria-hidden="true" tabindex="-1"></a><span class="co"># 1        0.8275102     0.172</span></span>
<span id="cb159-15"><a href="#cb159-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb159-16"><a href="#cb159-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit the tuned model on the training data</span></span>
<span id="cb159-17"><a href="#cb159-17" aria-hidden="true" tabindex="-1"></a>multTuned <span class="ot">&lt;-</span> <span class="fu">ranger</span>(</span>
<span id="cb159-18"><a href="#cb159-18" aria-hidden="true" tabindex="-1"></a>  <span class="at">y =</span> train_data<span class="sc">$</span>correction_info,</span>
<span id="cb159-19"><a href="#cb159-19" aria-hidden="true" tabindex="-1"></a>  <span class="at">x =</span> train_data[, <span class="dv">0</span><span class="sc">:</span><span class="dv">394</span>],  <span class="co"># without OV</span></span>
<span id="cb159-20"><a href="#cb159-20" aria-hidden="true" tabindex="-1"></a>  <span class="at">num.trees =</span> <span class="dv">5000</span>,</span>
<span id="cb159-21"><a href="#cb159-21" aria-hidden="true" tabindex="-1"></a>  <span class="at">mtry =</span> <span class="dv">268</span>,</span>
<span id="cb159-22"><a href="#cb159-22" aria-hidden="true" tabindex="-1"></a>  <span class="at">min.node.size =</span> <span class="dv">3</span>,</span>
<span id="cb159-23"><a href="#cb159-23" aria-hidden="true" tabindex="-1"></a>  <span class="at">sample.fraction =</span> <span class="fl">0.3295434</span>,</span>
<span id="cb159-24"><a href="#cb159-24" aria-hidden="true" tabindex="-1"></a>  <span class="at">importance =</span> <span class="st">"permutation"</span></span>
<span id="cb159-25"><a href="#cb159-25" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb159-26"><a href="#cb159-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb159-27"><a href="#cb159-27" aria-hidden="true" tabindex="-1"></a><span class="co"># Predict on the test data</span></span>
<span id="cb159-28"><a href="#cb159-28" aria-hidden="true" tabindex="-1"></a>predictions <span class="ot">&lt;-</span> <span class="fu">predict</span>(multTuned, <span class="at">data =</span> test_data)<span class="sc">$</span>predictions</span>
<span id="cb159-29"><a href="#cb159-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb159-30"><a href="#cb159-30" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a confusion matrix</span></span>
<span id="cb159-31"><a href="#cb159-31" aria-hidden="true" tabindex="-1"></a>confusion_matrix <span class="ot">&lt;-</span> <span class="fu">confusionMatrix</span>(predictions, test_data<span class="sc">$</span>correction_info)</span>
<span id="cb159-32"><a href="#cb159-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb159-33"><a href="#cb159-33" aria-hidden="true" tabindex="-1"></a><span class="co"># Print the confusion matrix</span></span>
<span id="cb159-34"><a href="#cb159-34" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(confusion_matrix)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Confusion Matrix and Statistics

          Reference
Prediction c0 c0_only c1 c2
   c0       0       0  0  0
   c0_only  0       0  0  0
   c1       1       1  0  1
   c2       0       0  1  0

Overall Statistics
                                     
               Accuracy : 0          
                 95% CI : (0, 0.6024)
    No Information Rate : 0.25       
    P-Value [Acc &gt; NIR] : 1          
                                     
                  Kappa : -0.3333    
                                     
 Mcnemar's Test P-Value : NA         

Statistics by Class:

                     Class: c0 Class: c0_only Class: c1 Class: c2
Sensitivity               0.00           0.00      0.00    0.0000
Specificity               1.00           1.00      0.00    0.6667
Pos Pred Value             NaN            NaN      0.00    0.0000
Neg Pred Value            0.75           0.75      0.00    0.6667
Prevalence                0.25           0.25      0.25    0.2500
Detection Rate            0.00           0.00      0.00    0.0000
Detection Prevalence      0.00           0.00      0.75    0.2500
Balanced Accuracy         0.50           0.50      0.00    0.3333</code></pre>
</div>
<div class="sourceCode cell-code" id="cb161"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb161-1"><a href="#cb161-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate feature importance</span></span>
<span id="cb161-2"><a href="#cb161-2" aria-hidden="true" tabindex="-1"></a>feature_importance <span class="ot">&lt;-</span> <span class="fu">importance</span>(multTuned, <span class="at">num.threads =</span> <span class="dv">1</span>, <span class="at">type =</span> <span class="dv">1</span>)</span>
<span id="cb161-3"><a href="#cb161-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb161-4"><a href="#cb161-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert to data frame</span></span>
<span id="cb161-5"><a href="#cb161-5" aria-hidden="true" tabindex="-1"></a>feature_importance_df <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(feature_importance, <span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span>)</span>
<span id="cb161-6"><a href="#cb161-6" aria-hidden="true" tabindex="-1"></a>feature_importance_df<span class="sc">$</span>Feature <span class="ot">&lt;-</span> <span class="fu">rownames</span>(feature_importance_df)</span>
<span id="cb161-7"><a href="#cb161-7" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(feature_importance_df) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Importance"</span>, <span class="st">"Feature"</span>)</span>
<span id="cb161-8"><a href="#cb161-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb161-9"><a href="#cb161-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Sort by importance</span></span>
<span id="cb161-10"><a href="#cb161-10" aria-hidden="true" tabindex="-1"></a>sorted_feature_importance <span class="ot">&lt;-</span> feature_importance_df[<span class="fu">order</span>(<span class="sc">-</span>feature_importance_df<span class="sc">$</span>Importance), ]</span>
<span id="cb161-11"><a href="#cb161-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb161-12"><a href="#cb161-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Print sorted feature importance</span></span>
<span id="cb161-13"><a href="#cb161-13" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(sorted_feature_importance, <span class="at">n=</span><span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                                    Importance
arm_power_pospeak_std             0.0009376557
leg_accKin_sum_pospeak_mean       0.0008753114
arm_accKin_sum_range              0.0007167766
leg_speedKin_sum_pospeak_mean     0.0006603297
head_moment_sum_range             0.0005926007
leg_angJerk_sum_pospeak_mean      0.0005246154
head_power_pospeak_std            0.0004887912
envelope_change_pospeak_mean      0.0004717216
lowerbody_jerkKin_sum_pospeak_std 0.0004468864
head_angSpeed_sum_range           0.0004372161
                                                            Feature
arm_power_pospeak_std                         arm_power_pospeak_std
leg_accKin_sum_pospeak_mean             leg_accKin_sum_pospeak_mean
arm_accKin_sum_range                           arm_accKin_sum_range
leg_speedKin_sum_pospeak_mean         leg_speedKin_sum_pospeak_mean
head_moment_sum_range                         head_moment_sum_range
leg_angJerk_sum_pospeak_mean           leg_angJerk_sum_pospeak_mean
head_power_pospeak_std                       head_power_pospeak_std
envelope_change_pospeak_mean           envelope_change_pospeak_mean
lowerbody_jerkKin_sum_pospeak_std lowerbody_jerkKin_sum_pospeak_std
head_angSpeed_sum_range                     head_angSpeed_sum_range</code></pre>
</div>
<div class="sourceCode cell-code" id="cb163"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb163-1"><a href="#cb163-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Close the cluster when you're done with your parallel tasks</span></span>
<span id="cb163-2"><a href="#cb163-2" aria-hidden="true" tabindex="-1"></a><span class="co">#stopCluster(cl)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Save data frame.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb164"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb164-1"><a href="#cb164-1" aria-hidden="true" tabindex="-1"></a><span class="fu">write.csv</span>(data_mult, <span class="at">file =</span> <span class="fu">paste0</span>(datasets, <span class="st">"multDataXGB.csv"</span>), <span class="at">row.names =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="xgboost-2" class="level2">
<h2 class="anchored" data-anchor-id="xgboost-2">XGBoost</h2>
<p>Ensure parallel processing.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb165"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb165-1"><a href="#cb165-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Detect the number of available cores</span></span>
<span id="cb165-2"><a href="#cb165-2" aria-hidden="true" tabindex="-1"></a>cores <span class="ot">&lt;-</span> <span class="fu">detectCores</span>() <span class="co">#- 1  # Leave one core free</span></span>
<span id="cb165-3"><a href="#cb165-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb165-4"><a href="#cb165-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a cluster with the detected number of cores</span></span>
<span id="cb165-5"><a href="#cb165-5" aria-hidden="true" tabindex="-1"></a>cl <span class="ot">&lt;-</span> <span class="fu">makeCluster</span>(cores)</span>
<span id="cb165-6"><a href="#cb165-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb165-7"><a href="#cb165-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Register the parallel backend</span></span>
<span id="cb165-8"><a href="#cb165-8" aria-hidden="true" tabindex="-1"></a><span class="fu">registerDoParallel</span>(cl)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Define the grid and estimate runtime.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb166"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb166-1"><a href="#cb166-1" aria-hidden="true" tabindex="-1"></a>grid_tune <span class="ot">&lt;-</span> <span class="fu">expand.grid</span>(</span>
<span id="cb166-2"><a href="#cb166-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">nrounds =</span> <span class="fu">c</span>(<span class="dv">5000</span>, <span class="dv">10000</span>), </span>
<span id="cb166-3"><a href="#cb166-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">max_depth =</span> <span class="fu">c</span>(<span class="dv">3</span>, <span class="dv">6</span>), </span>
<span id="cb166-4"><a href="#cb166-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">eta =</span> <span class="fu">c</span>(<span class="fl">0.05</span>, <span class="fl">0.1</span>), </span>
<span id="cb166-5"><a href="#cb166-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">gamma =</span> <span class="fu">c</span>(<span class="fl">0.1</span>), </span>
<span id="cb166-6"><a href="#cb166-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">colsample_bytree =</span> <span class="fu">c</span>(<span class="fl">0.6</span>, <span class="fl">0.8</span>), </span>
<span id="cb166-7"><a href="#cb166-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">min_child_weight =</span> <span class="fu">c</span>(<span class="dv">1</span>), </span>
<span id="cb166-8"><a href="#cb166-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">subsample =</span> <span class="fu">c</span>(<span class="fl">0.75</span>, <span class="fl">1.0</span>)</span>
<span id="cb166-9"><a href="#cb166-9" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb166-10"><a href="#cb166-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb166-11"><a href="#cb166-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate total combinations</span></span>
<span id="cb166-12"><a href="#cb166-12" aria-hidden="true" tabindex="-1"></a>total_combinations <span class="ot">&lt;-</span> <span class="fu">nrow</span>(grid_tune)</span>
<span id="cb166-13"><a href="#cb166-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb166-14"><a href="#cb166-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Estimate single model run time (assume 1 minute per run)</span></span>
<span id="cb166-15"><a href="#cb166-15" aria-hidden="true" tabindex="-1"></a>single_model_time <span class="ot">&lt;-</span> <span class="dv">10</span> <span class="co"># minute</span></span>
<span id="cb166-16"><a href="#cb166-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb166-17"><a href="#cb166-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Total runs for cross-validation</span></span>
<span id="cb166-18"><a href="#cb166-18" aria-hidden="true" tabindex="-1"></a>folds <span class="ot">&lt;-</span> <span class="dv">5</span></span>
<span id="cb166-19"><a href="#cb166-19" aria-hidden="true" tabindex="-1"></a>total_runs <span class="ot">&lt;-</span> total_combinations <span class="sc">*</span> folds</span>
<span id="cb166-20"><a href="#cb166-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb166-21"><a href="#cb166-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Total time estimation without parallel processing</span></span>
<span id="cb166-22"><a href="#cb166-22" aria-hidden="true" tabindex="-1"></a>total_time <span class="ot">&lt;-</span> total_runs <span class="sc">*</span> single_model_time <span class="co"># in minutes</span></span>
<span id="cb166-23"><a href="#cb166-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb166-24"><a href="#cb166-24" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert to hours</span></span>
<span id="cb166-25"><a href="#cb166-25" aria-hidden="true" tabindex="-1"></a>total_time_hours <span class="ot">&lt;-</span> total_time <span class="sc">/</span> <span class="dv">60</span></span>
<span id="cb166-26"><a href="#cb166-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb166-27"><a href="#cb166-27" aria-hidden="true" tabindex="-1"></a><span class="co"># Output estimated time without parallel processing</span></span>
<span id="cb166-28"><a href="#cb166-28" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">paste</span>(<span class="st">"Estimated time for grid search without parallel processing:"</span>, total_time_hours, <span class="st">"hours"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Estimated time for grid search without parallel processing: 26.6666666666667 hours"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb168"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb168-1"><a href="#cb168-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Parallel processing with 4 cores</span></span>
<span id="cb168-2"><a href="#cb168-2" aria-hidden="true" tabindex="-1"></a>cores <span class="ot">&lt;-</span> <span class="dv">24</span></span>
<span id="cb168-3"><a href="#cb168-3" aria-hidden="true" tabindex="-1"></a>total_time_parallel <span class="ot">&lt;-</span> total_time <span class="sc">/</span> cores <span class="co"># in minutes</span></span>
<span id="cb168-4"><a href="#cb168-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb168-5"><a href="#cb168-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert to hours</span></span>
<span id="cb168-6"><a href="#cb168-6" aria-hidden="true" tabindex="-1"></a>total_time_parallel_hours <span class="ot">&lt;-</span> total_time_parallel <span class="sc">/</span> <span class="dv">60</span></span>
<span id="cb168-7"><a href="#cb168-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb168-8"><a href="#cb168-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Output estimated time with parallel processing</span></span>
<span id="cb168-9"><a href="#cb168-9" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">paste</span>(<span class="st">"Estimated time for grid search with"</span>, cores, <span class="st">"cores:"</span>, total_time_parallel_hours, <span class="st">"hours"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Estimated time for grid search with 24 cores: 1.11111111111111 hours"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb170"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb170-1"><a href="#cb170-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(total_combinations,single_model_time,folds,total_runs,total_time,total_time_hours,total_time_parallel,total_time_parallel_hours,cores)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="k-fold-cross-validation-2" class="level3">
<h3 class="anchored" data-anchor-id="k-fold-cross-validation-2">K-fold cross-validation</h3>
<p>Create subsets to train and test data (80/20).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb171"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb171-1"><a href="#cb171-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Set seed for reproducibility</span></span>
<span id="cb171-2"><a href="#cb171-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">998</span>)</span>
<span id="cb171-3"><a href="#cb171-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb171-4"><a href="#cb171-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Set up train control</span></span>
<span id="cb171-5"><a href="#cb171-5" aria-hidden="true" tabindex="-1"></a>train_control <span class="ot">&lt;-</span> <span class="fu">trainControl</span>(</span>
<span id="cb171-6"><a href="#cb171-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">method =</span> <span class="st">"cv"</span>,        <span class="co"># Cross-validation</span></span>
<span id="cb171-7"><a href="#cb171-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">number =</span> <span class="dv">5</span>,           <span class="co"># 5-fold cross-validation</span></span>
<span id="cb171-8"><a href="#cb171-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">allowParallel =</span> <span class="cn">TRUE</span>  <span class="co"># Enable parallel processing</span></span>
<span id="cb171-9"><a href="#cb171-9" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb171-10"><a href="#cb171-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb171-11"><a href="#cb171-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Define the number of subsets</span></span>
<span id="cb171-12"><a href="#cb171-12" aria-hidden="true" tabindex="-1"></a>numSubsets <span class="ot">&lt;-</span> <span class="dv">5</span></span>
<span id="cb171-13"><a href="#cb171-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb171-14"><a href="#cb171-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Load MICE-imputed data (using placeholder 'data_ges' as the input dataset)</span></span>
<span id="cb171-15"><a href="#cb171-15" aria-hidden="true" tabindex="-1"></a>multDataXGB <span class="ot">&lt;-</span> data_mult</span>
<span id="cb171-16"><a href="#cb171-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb171-17"><a href="#cb171-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Ensure 'correction_info' is a factor</span></span>
<span id="cb171-18"><a href="#cb171-18" aria-hidden="true" tabindex="-1"></a>multDataXGB<span class="sc">$</span>correction_info <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(multDataXGB<span class="sc">$</span>correction_info)</span>
<span id="cb171-19"><a href="#cb171-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb171-20"><a href="#cb171-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Remove rows with only NA values</span></span>
<span id="cb171-21"><a href="#cb171-21" aria-hidden="true" tabindex="-1"></a>multDataXGB <span class="ot">&lt;-</span> multDataXGB[<span class="fu">rowSums</span>(<span class="fu">is.na</span>(multDataXGB)) <span class="sc">&lt;</span> <span class="fu">ncol</span>(multDataXGB), ]</span>
<span id="cb171-22"><a href="#cb171-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb171-23"><a href="#cb171-23" aria-hidden="true" tabindex="-1"></a><span class="co"># Split data by levels of 'correction_info'</span></span>
<span id="cb171-24"><a href="#cb171-24" aria-hidden="true" tabindex="-1"></a>correction_levels <span class="ot">&lt;-</span> <span class="fu">levels</span>(multDataXGB<span class="sc">$</span>correction_info)</span>
<span id="cb171-25"><a href="#cb171-25" aria-hidden="true" tabindex="-1"></a>split_data <span class="ot">&lt;-</span> <span class="fu">split</span>(multDataXGB, multDataXGB<span class="sc">$</span>correction_info)</span>
<span id="cb171-26"><a href="#cb171-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb171-27"><a href="#cb171-27" aria-hidden="true" tabindex="-1"></a><span class="co"># Initialize a list to store subsets</span></span>
<span id="cb171-28"><a href="#cb171-28" aria-hidden="true" tabindex="-1"></a>multSubsets <span class="ot">&lt;-</span> <span class="fu">vector</span>(<span class="st">"list"</span>, <span class="at">length =</span> numSubsets)</span>
<span id="cb171-29"><a href="#cb171-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb171-30"><a href="#cb171-30" aria-hidden="true" tabindex="-1"></a><span class="co"># Distribute rows for each level equally across subsets</span></span>
<span id="cb171-31"><a href="#cb171-31" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (level <span class="cf">in</span> correction_levels) {</span>
<span id="cb171-32"><a href="#cb171-32" aria-hidden="true" tabindex="-1"></a>  level_data <span class="ot">&lt;-</span> split_data[[level]]</span>
<span id="cb171-33"><a href="#cb171-33" aria-hidden="true" tabindex="-1"></a>  subset_sizes <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="fu">floor</span>(<span class="fu">nrow</span>(level_data) <span class="sc">/</span> numSubsets), numSubsets)</span>
<span id="cb171-34"><a href="#cb171-34" aria-hidden="true" tabindex="-1"></a>  remainder <span class="ot">&lt;-</span> <span class="fu">nrow</span>(level_data) <span class="sc">%%</span> numSubsets</span>
<span id="cb171-35"><a href="#cb171-35" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb171-36"><a href="#cb171-36" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Distribute remainder rows randomly</span></span>
<span id="cb171-37"><a href="#cb171-37" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (remainder <span class="sc">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb171-38"><a href="#cb171-38" aria-hidden="true" tabindex="-1"></a>    subset_sizes[<span class="fu">seq_len</span>(remainder)] <span class="ot">&lt;-</span> subset_sizes[<span class="fu">seq_len</span>(remainder)] <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb171-39"><a href="#cb171-39" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb171-40"><a href="#cb171-40" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb171-41"><a href="#cb171-41" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Shuffle rows of the level and assign to subsets</span></span>
<span id="cb171-42"><a href="#cb171-42" aria-hidden="true" tabindex="-1"></a>  shuffled_data <span class="ot">&lt;-</span> level_data[<span class="fu">sample</span>(<span class="fu">nrow</span>(level_data)), ]</span>
<span id="cb171-43"><a href="#cb171-43" aria-hidden="true" tabindex="-1"></a>  indices <span class="ot">&lt;-</span> <span class="fu">cumsum</span>(<span class="fu">c</span>(<span class="dv">0</span>, subset_sizes))</span>
<span id="cb171-44"><a href="#cb171-44" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb171-45"><a href="#cb171-45" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>numSubsets) {</span>
<span id="cb171-46"><a href="#cb171-46" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">is.null</span>(multSubsets[[i]])) {</span>
<span id="cb171-47"><a href="#cb171-47" aria-hidden="true" tabindex="-1"></a>      multSubsets[[i]] <span class="ot">&lt;-</span> shuffled_data[(indices[i] <span class="sc">+</span> <span class="dv">1</span>)<span class="sc">:</span>indices[i <span class="sc">+</span> <span class="dv">1</span>], ]</span>
<span id="cb171-48"><a href="#cb171-48" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb171-49"><a href="#cb171-49" aria-hidden="true" tabindex="-1"></a>      multSubsets[[i]] <span class="ot">&lt;-</span> <span class="fu">rbind</span>(multSubsets[[i]], shuffled_data[(indices[i] <span class="sc">+</span> <span class="dv">1</span>)<span class="sc">:</span>indices[i <span class="sc">+</span> <span class="dv">1</span>], ])</span>
<span id="cb171-50"><a href="#cb171-50" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb171-51"><a href="#cb171-51" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb171-52"><a href="#cb171-52" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb171-53"><a href="#cb171-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb171-54"><a href="#cb171-54" aria-hidden="true" tabindex="-1"></a><span class="co"># Naming the subsets</span></span>
<span id="cb171-55"><a href="#cb171-55" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(multSubsets) <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"multData"</span>, <span class="dv">1</span><span class="sc">:</span>numSubsets)</span>
<span id="cb171-56"><a href="#cb171-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb171-57"><a href="#cb171-57" aria-hidden="true" tabindex="-1"></a><span class="co"># Verify balance in subsets</span></span>
<span id="cb171-58"><a href="#cb171-58" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>numSubsets) {</span>
<span id="cb171-59"><a href="#cb171-59" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"Subset"</span>, i, <span class="st">"contains rows:"</span>, <span class="fu">nrow</span>(multSubsets[[i]]), <span class="st">"and levels:</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb171-60"><a href="#cb171-60" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="fu">table</span>(multSubsets[[i]]<span class="sc">$</span>correction_info))</span>
<span id="cb171-61"><a href="#cb171-61" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Subset 1 contains rows: 7 and levels:

     c0 c0_only      c1      c2 
      2       1       2       2 
Subset 2 contains rows: 4 and levels:

     c0 c0_only      c1      c2 
      1       1       1       1 
Subset 3 contains rows: 4 and levels:

     c0 c0_only      c1      c2 
      1       1       1       1 
Subset 4 contains rows: 4 and levels:

     c0 c0_only      c1      c2 
      1       1       1       1 
Subset 5 contains rows: 4 and levels:

     c0 c0_only      c1      c2 
      1       1       1       1 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb173"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb173-1"><a href="#cb173-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Remove any rows with only NAs from subsets just to ensure cleanliness</span></span>
<span id="cb173-2"><a href="#cb173-2" aria-hidden="true" tabindex="-1"></a>multSubsets <span class="ot">&lt;-</span> <span class="fu">lapply</span>(multSubsets, <span class="cf">function</span>(subset) {</span>
<span id="cb173-3"><a href="#cb173-3" aria-hidden="true" tabindex="-1"></a>  subset[<span class="fu">rowSums</span>(<span class="fu">is.na</span>(subset)) <span class="sc">&lt;</span> <span class="fu">ncol</span>(subset), ]</span>
<span id="cb173-4"><a href="#cb173-4" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb173-5"><a href="#cb173-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb173-6"><a href="#cb173-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Access the subsets</span></span>
<span id="cb173-7"><a href="#cb173-7" aria-hidden="true" tabindex="-1"></a>multData1 <span class="ot">&lt;-</span> multSubsets<span class="sc">$</span>multData1</span>
<span id="cb173-8"><a href="#cb173-8" aria-hidden="true" tabindex="-1"></a>multData2 <span class="ot">&lt;-</span> multSubsets<span class="sc">$</span>multData2</span>
<span id="cb173-9"><a href="#cb173-9" aria-hidden="true" tabindex="-1"></a>multData3 <span class="ot">&lt;-</span> multSubsets<span class="sc">$</span>multData3</span>
<span id="cb173-10"><a href="#cb173-10" aria-hidden="true" tabindex="-1"></a>multData4 <span class="ot">&lt;-</span> multSubsets<span class="sc">$</span>multData4</span>
<span id="cb173-11"><a href="#cb173-11" aria-hidden="true" tabindex="-1"></a>multData5 <span class="ot">&lt;-</span> multSubsets<span class="sc">$</span>multData5</span>
<span id="cb173-12"><a href="#cb173-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb173-13"><a href="#cb173-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Combine subsets into 80% groups</span></span>
<span id="cb173-14"><a href="#cb173-14" aria-hidden="true" tabindex="-1"></a>multData1234 <span class="ot">&lt;-</span> <span class="fu">rbind</span>(multData1, multData2, multData3, multData4)</span>
<span id="cb173-15"><a href="#cb173-15" aria-hidden="true" tabindex="-1"></a>multData1235 <span class="ot">&lt;-</span> <span class="fu">rbind</span>(multData1, multData2, multData3, multData5)</span>
<span id="cb173-16"><a href="#cb173-16" aria-hidden="true" tabindex="-1"></a>multData1245 <span class="ot">&lt;-</span> <span class="fu">rbind</span>(multData1, multData2, multData4, multData5)</span>
<span id="cb173-17"><a href="#cb173-17" aria-hidden="true" tabindex="-1"></a>multData1345 <span class="ot">&lt;-</span> <span class="fu">rbind</span>(multData1, multData3, multData4, multData5)</span>
<span id="cb173-18"><a href="#cb173-18" aria-hidden="true" tabindex="-1"></a>multData2345 <span class="ot">&lt;-</span> <span class="fu">rbind</span>(multData2, multData3, multData4, multData5)</span>
<span id="cb173-19"><a href="#cb173-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb173-20"><a href="#cb173-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Final verification of all levels in the combined datasets</span></span>
<span id="cb173-21"><a href="#cb173-21" aria-hidden="true" tabindex="-1"></a>combined_sets <span class="ot">&lt;-</span> <span class="fu">list</span>(multData1234, multData1235, multData1245, multData1345, multData2345)</span>
<span id="cb173-22"><a href="#cb173-22" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(combined_sets) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"multData1234"</span>, <span class="st">"multData1235"</span>, <span class="st">"multData1245"</span>, <span class="st">"multData1345"</span>, <span class="st">"multData2345"</span>)</span>
<span id="cb173-23"><a href="#cb173-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb173-24"><a href="#cb173-24" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (set_name <span class="cf">in</span> <span class="fu">names</span>(combined_sets)) {</span>
<span id="cb173-25"><a href="#cb173-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"Dataset"</span>, set_name, <span class="st">"contains rows:"</span>, <span class="fu">nrow</span>(combined_sets[[set_name]]), <span class="st">"and levels:</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb173-26"><a href="#cb173-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="fu">table</span>(combined_sets[[set_name]]<span class="sc">$</span>correction_info))</span>
<span id="cb173-27"><a href="#cb173-27" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Dataset multData1234 contains rows: 19 and levels:

     c0 c0_only      c1      c2 
      5       4       5       5 
Dataset multData1235 contains rows: 19 and levels:

     c0 c0_only      c1      c2 
      5       4       5       5 
Dataset multData1245 contains rows: 19 and levels:

     c0 c0_only      c1      c2 
      5       4       5       5 
Dataset multData1345 contains rows: 19 and levels:

     c0 c0_only      c1      c2 
      5       4       5       5 
Dataset multData2345 contains rows: 16 and levels:

     c0 c0_only      c1      c2 
      4       4       4       4 </code></pre>
</div>
</div>
</section>
<section id="models-2" class="level3">
<h3 class="anchored" data-anchor-id="models-2">Models</h3>
<p>Only run the models one time and then readRDS.</p>
<section id="model-1-4" class="level4">
<h4 class="anchored" data-anchor-id="model-1-4">Model 1</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb175"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb175-1"><a href="#cb175-1" aria-hidden="true" tabindex="-1"></a>multModel1 <span class="ot">&lt;-</span> caret<span class="sc">::</span><span class="fu">train</span>(</span>
<span id="cb175-2"><a href="#cb175-2" aria-hidden="true" tabindex="-1"></a>  correction_info <span class="sc">~</span> .,              </span>
<span id="cb175-3"><a href="#cb175-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> multData1234,</span>
<span id="cb175-4"><a href="#cb175-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">method =</span> <span class="st">"xgbTree"</span>,     </span>
<span id="cb175-5"><a href="#cb175-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">trControl =</span> train_control,</span>
<span id="cb175-6"><a href="#cb175-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">tuneGrid =</span> grid_tune    </span>
<span id="cb175-7"><a href="#cb175-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb175-8"><a href="#cb175-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-9"><a href="#cb175-9" aria-hidden="true" tabindex="-1"></a><span class="fu">saveRDS</span>(multModel1, <span class="at">file =</span> <span class="fu">paste0</span>(models, <span class="st">"multModel1.rds"</span>), <span class="at">compress =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="model-2-4" class="level4">
<h4 class="anchored" data-anchor-id="model-2-4">Model 2</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb176"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb176-1"><a href="#cb176-1" aria-hidden="true" tabindex="-1"></a>multModel2 <span class="ot">&lt;-</span> caret<span class="sc">::</span><span class="fu">train</span>(</span>
<span id="cb176-2"><a href="#cb176-2" aria-hidden="true" tabindex="-1"></a>  correction_info <span class="sc">~</span> .,              </span>
<span id="cb176-3"><a href="#cb176-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> multData1235,</span>
<span id="cb176-4"><a href="#cb176-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">method =</span> <span class="st">"xgbTree"</span>,     </span>
<span id="cb176-5"><a href="#cb176-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">trControl =</span> train_control,</span>
<span id="cb176-6"><a href="#cb176-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">tuneGrid =</span> grid_tune    </span>
<span id="cb176-7"><a href="#cb176-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb176-8"><a href="#cb176-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb176-9"><a href="#cb176-9" aria-hidden="true" tabindex="-1"></a><span class="fu">saveRDS</span>(multModel2, <span class="at">file =</span> <span class="fu">paste0</span>(models, <span class="st">"multModel2.rds"</span>), <span class="at">compress =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="model-3-4" class="level4">
<h4 class="anchored" data-anchor-id="model-3-4">Model 3</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb177"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb177-1"><a href="#cb177-1" aria-hidden="true" tabindex="-1"></a>multModel3 <span class="ot">&lt;-</span> caret<span class="sc">::</span><span class="fu">train</span>(</span>
<span id="cb177-2"><a href="#cb177-2" aria-hidden="true" tabindex="-1"></a>  correction_info <span class="sc">~</span> .,              </span>
<span id="cb177-3"><a href="#cb177-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> multData1245,</span>
<span id="cb177-4"><a href="#cb177-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">method =</span> <span class="st">"xgbTree"</span>,     </span>
<span id="cb177-5"><a href="#cb177-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">trControl =</span> train_control,</span>
<span id="cb177-6"><a href="#cb177-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">tuneGrid =</span> grid_tune    </span>
<span id="cb177-7"><a href="#cb177-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb177-8"><a href="#cb177-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb177-9"><a href="#cb177-9" aria-hidden="true" tabindex="-1"></a><span class="fu">saveRDS</span>(multModel3, <span class="at">file =</span> <span class="fu">paste0</span>(models, <span class="st">"multModel3.rds"</span>), <span class="at">compress =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="model-4-4" class="level4">
<h4 class="anchored" data-anchor-id="model-4-4">Model 4</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb178"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb178-1"><a href="#cb178-1" aria-hidden="true" tabindex="-1"></a>multModel4 <span class="ot">&lt;-</span> caret<span class="sc">::</span><span class="fu">train</span>(</span>
<span id="cb178-2"><a href="#cb178-2" aria-hidden="true" tabindex="-1"></a>  correction_info <span class="sc">~</span> .,              </span>
<span id="cb178-3"><a href="#cb178-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> multData1345,</span>
<span id="cb178-4"><a href="#cb178-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">method =</span> <span class="st">"xgbTree"</span>,     </span>
<span id="cb178-5"><a href="#cb178-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">trControl =</span> train_control,</span>
<span id="cb178-6"><a href="#cb178-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">tuneGrid =</span> grid_tune    </span>
<span id="cb178-7"><a href="#cb178-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb178-8"><a href="#cb178-8" aria-hidden="true" tabindex="-1"></a><span class="fu">saveRDS</span>(multModel4, <span class="at">file =</span> <span class="fu">paste0</span>(models, <span class="st">"multModel4.rds"</span>), <span class="at">compress =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="model-5-4" class="level4">
<h4 class="anchored" data-anchor-id="model-5-4">Model 5</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb179"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb179-1"><a href="#cb179-1" aria-hidden="true" tabindex="-1"></a>multModel5 <span class="ot">&lt;-</span> caret<span class="sc">::</span><span class="fu">train</span>(</span>
<span id="cb179-2"><a href="#cb179-2" aria-hidden="true" tabindex="-1"></a>  correction_info <span class="sc">~</span> .,              </span>
<span id="cb179-3"><a href="#cb179-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> multData2345,</span>
<span id="cb179-4"><a href="#cb179-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">method =</span> <span class="st">"xgbTree"</span>,     </span>
<span id="cb179-5"><a href="#cb179-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">trControl =</span> train_control,</span>
<span id="cb179-6"><a href="#cb179-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">tuneGrid =</span> grid_tune    </span>
<span id="cb179-7"><a href="#cb179-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb179-8"><a href="#cb179-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb179-9"><a href="#cb179-9" aria-hidden="true" tabindex="-1"></a><span class="fu">saveRDS</span>(multModel5, <span class="at">file =</span> <span class="fu">paste0</span>(models, <span class="st">"multModel5.rds"</span>), <span class="at">compress =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="load-models-2" class="level4">
<h4 class="anchored" data-anchor-id="load-models-2">Load models</h4>
<p>Load all models after running, if necessary.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb180"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb180-1"><a href="#cb180-1" aria-hidden="true" tabindex="-1"></a>multModel1 <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="fu">paste0</span>(models, <span class="st">"multModel1.rds"</span>))</span>
<span id="cb180-2"><a href="#cb180-2" aria-hidden="true" tabindex="-1"></a>multModel2 <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="fu">paste0</span>(models, <span class="st">"multModel2.rds"</span>))</span>
<span id="cb180-3"><a href="#cb180-3" aria-hidden="true" tabindex="-1"></a>multModel3 <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="fu">paste0</span>(models, <span class="st">"multModel3.rds"</span>))</span>
<span id="cb180-4"><a href="#cb180-4" aria-hidden="true" tabindex="-1"></a>multModel4 <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="fu">paste0</span>(models, <span class="st">"multModel4.rds"</span>))</span>
<span id="cb180-5"><a href="#cb180-5" aria-hidden="true" tabindex="-1"></a>multModel5 <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="fu">paste0</span>(models, <span class="st">"multModel5.rds"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="test-models-2" class="level4">
<h4 class="anchored" data-anchor-id="test-models-2">Test models</h4>
<p>Generate predictions and confusion matrices</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb181"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb181-1"><a href="#cb181-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate predictions</span></span>
<span id="cb181-2"><a href="#cb181-2" aria-hidden="true" tabindex="-1"></a>multPredictions1 <span class="ot">&lt;-</span> <span class="fu">predict</span>(multModel1, <span class="at">newdata =</span> multData5)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[16:55:30] WARNING: src/learner.cc:553: 
  If you are loading a serialized model (like pickle in Python, RDS in R) generated by
  older XGBoost, please export the model by calling `Booster.save_model` from that version
  first, then load it back in current version. See:

    https://xgboost.readthedocs.io/en/latest/tutorials/saving_model.html

  for more details about differences between saving model and serializing.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb183"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb183-1"><a href="#cb183-1" aria-hidden="true" tabindex="-1"></a>multPredictions2 <span class="ot">&lt;-</span> <span class="fu">predict</span>(multModel2, <span class="at">newdata =</span> multData4)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[16:55:30] WARNING: src/learner.cc:553: 
  If you are loading a serialized model (like pickle in Python, RDS in R) generated by
  older XGBoost, please export the model by calling `Booster.save_model` from that version
  first, then load it back in current version. See:

    https://xgboost.readthedocs.io/en/latest/tutorials/saving_model.html

  for more details about differences between saving model and serializing.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb185"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb185-1"><a href="#cb185-1" aria-hidden="true" tabindex="-1"></a>multPredictions3 <span class="ot">&lt;-</span> <span class="fu">predict</span>(multModel3, <span class="at">newdata =</span> multData3)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[16:55:30] WARNING: src/learner.cc:553: 
  If you are loading a serialized model (like pickle in Python, RDS in R) generated by
  older XGBoost, please export the model by calling `Booster.save_model` from that version
  first, then load it back in current version. See:

    https://xgboost.readthedocs.io/en/latest/tutorials/saving_model.html

  for more details about differences between saving model and serializing.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb187"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb187-1"><a href="#cb187-1" aria-hidden="true" tabindex="-1"></a>multPredictions4 <span class="ot">&lt;-</span> <span class="fu">predict</span>(multModel4, <span class="at">newdata =</span> multData2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[16:55:30] WARNING: src/learner.cc:553: 
  If you are loading a serialized model (like pickle in Python, RDS in R) generated by
  older XGBoost, please export the model by calling `Booster.save_model` from that version
  first, then load it back in current version. See:

    https://xgboost.readthedocs.io/en/latest/tutorials/saving_model.html

  for more details about differences between saving model and serializing.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb189"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb189-1"><a href="#cb189-1" aria-hidden="true" tabindex="-1"></a>multPredictions5 <span class="ot">&lt;-</span> <span class="fu">predict</span>(multModel5, <span class="at">newdata =</span> multData1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[16:55:30] WARNING: src/learner.cc:553: 
  If you are loading a serialized model (like pickle in Python, RDS in R) generated by
  older XGBoost, please export the model by calling `Booster.save_model` from that version
  first, then load it back in current version. See:

    https://xgboost.readthedocs.io/en/latest/tutorials/saving_model.html

  for more details about differences between saving model and serializing.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb191"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb191-1"><a href="#cb191-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute confusion matrices</span></span>
<span id="cb191-2"><a href="#cb191-2" aria-hidden="true" tabindex="-1"></a>multCm1 <span class="ot">&lt;-</span> <span class="fu">confusionMatrix</span>(multPredictions1, multData5<span class="sc">$</span>correction_info)</span>
<span id="cb191-3"><a href="#cb191-3" aria-hidden="true" tabindex="-1"></a>multCm2 <span class="ot">&lt;-</span> <span class="fu">confusionMatrix</span>(multPredictions2, multData4<span class="sc">$</span>correction_info)</span>
<span id="cb191-4"><a href="#cb191-4" aria-hidden="true" tabindex="-1"></a>multCm3 <span class="ot">&lt;-</span> <span class="fu">confusionMatrix</span>(multPredictions3, multData3<span class="sc">$</span>correction_info)</span>
<span id="cb191-5"><a href="#cb191-5" aria-hidden="true" tabindex="-1"></a>multCm4 <span class="ot">&lt;-</span> <span class="fu">confusionMatrix</span>(multPredictions4, multData2<span class="sc">$</span>correction_info)</span>
<span id="cb191-6"><a href="#cb191-6" aria-hidden="true" tabindex="-1"></a>multCm5 <span class="ot">&lt;-</span> <span class="fu">confusionMatrix</span>(multPredictions5, multData1<span class="sc">$</span>correction_info)</span>
<span id="cb191-7"><a href="#cb191-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-8"><a href="#cb191-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract p-values (you need to define how to extract these based on your metric, here assumed to be some metric from confusion matrix)</span></span>
<span id="cb191-9"><a href="#cb191-9" aria-hidden="true" tabindex="-1"></a>multPValues <span class="ot">&lt;-</span> <span class="fu">c</span>(multCm1<span class="sc">$</span>overall[<span class="st">'AccuracyPValue'</span>], </span>
<span id="cb191-10"><a href="#cb191-10" aria-hidden="true" tabindex="-1"></a>              multCm2<span class="sc">$</span>overall[<span class="st">'AccuracyPValue'</span>], </span>
<span id="cb191-11"><a href="#cb191-11" aria-hidden="true" tabindex="-1"></a>              multCm3<span class="sc">$</span>overall[<span class="st">'AccuracyPValue'</span>], </span>
<span id="cb191-12"><a href="#cb191-12" aria-hidden="true" tabindex="-1"></a>              multCm4<span class="sc">$</span>overall[<span class="st">'AccuracyPValue'</span>], </span>
<span id="cb191-13"><a href="#cb191-13" aria-hidden="true" tabindex="-1"></a>              multCm5<span class="sc">$</span>overall[<span class="st">'AccuracyPValue'</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Combine p-values using Fisher’s method</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb192"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb192-1"><a href="#cb192-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Fisher's method</span></span>
<span id="cb192-2"><a href="#cb192-2" aria-hidden="true" tabindex="-1"></a>multFisher_combined <span class="ot">&lt;-</span> <span class="sc">-</span><span class="dv">2</span> <span class="sc">*</span> <span class="fu">sum</span>(<span class="fu">log</span>(multPValues))</span>
<span id="cb192-3"><a href="#cb192-3" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="dv">2</span> <span class="sc">*</span> <span class="fu">length</span>(multPValues)</span>
<span id="cb192-4"><a href="#cb192-4" aria-hidden="true" tabindex="-1"></a>multPCcombined_fisher <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="sc">-</span> <span class="fu">pchisq</span>(multFisher_combined, df)</span>
<span id="cb192-5"><a href="#cb192-5" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(multPCcombined_fisher)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.3920742</code></pre>
</div>
<div class="sourceCode cell-code" id="cb194"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb194-1"><a href="#cb194-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Stouffer's method</span></span>
<span id="cb194-2"><a href="#cb194-2" aria-hidden="true" tabindex="-1"></a>multZ_scores <span class="ot">&lt;-</span> <span class="fu">qnorm</span>(<span class="dv">1</span> <span class="sc">-</span> multPValues<span class="sc">/</span><span class="dv">2</span>)</span>
<span id="cb194-3"><a href="#cb194-3" aria-hidden="true" tabindex="-1"></a>multCombined_z <span class="ot">&lt;-</span> <span class="fu">sum</span>(multZ_scores) <span class="sc">/</span> <span class="fu">sqrt</span>(<span class="fu">length</span>(multPValues))</span>
<span id="cb194-4"><a href="#cb194-4" aria-hidden="true" tabindex="-1"></a>multP_combined_stouffer <span class="ot">&lt;-</span> <span class="dv">2</span> <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">-</span> <span class="fu">pnorm</span>(<span class="fu">abs</span>(multCombined_z)))</span>
<span id="cb194-5"><a href="#cb194-5" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(multP_combined_stouffer)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.05686547</code></pre>
</div>
</div>
<p>The p-values should sum up to 0.</p>
</section>
<section id="feature-importance-2" class="level4">
<h4 class="anchored" data-anchor-id="feature-importance-2">Feature importance</h4>
<section id="model-1-5" class="level5">
<h5 class="anchored" data-anchor-id="model-1-5">Model 1</h5>
<div class="cell">
<div class="sourceCode cell-code" id="cb196"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb196-1"><a href="#cb196-1" aria-hidden="true" tabindex="-1"></a>XGBmultModel1 <span class="ot">&lt;-</span> multModel1<span class="sc">$</span>finalModel</span>
<span id="cb196-2"><a href="#cb196-2" aria-hidden="true" tabindex="-1"></a>importanceXGBmultModel1 <span class="ot">&lt;-</span> <span class="fu">xgb.importance</span>(<span class="at">model =</span> XGBmultModel1)</span>
<span id="cb196-3"><a href="#cb196-3" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(importanceXGBmultModel1, <span class="at">n=</span><span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                                Feature       Gain      Cover  Frequency
                                 &lt;char&gt;      &lt;num&gt;      &lt;num&gt;      &lt;num&gt;
 1:               arm_power_pospeak_std 0.16370920 0.10839576 0.08992806
 2: head_moment_sum_change_pospeak_mean 0.08237537 0.09064362 0.09352518
 3:                       head_duration 0.08032469 0.06534066 0.05755396
 4:         lowerbody_jerkKin_sum_Gmean 0.06176702 0.07529737 0.06115108
 5:                      head_inter_Kin 0.05656996 0.03174240 0.02517986
 6:                envelope_change_Gstd 0.05258590 0.04236234 0.05755396
 7:                arm_accKin_sum_range 0.05149798 0.05082393 0.04676259
 8:       leg_speedKin_sum_pospeak_mean 0.05088554 0.06236849 0.05395683
 9:                arm_moment_sum_range 0.04731327 0.05174319 0.05035971
10:   lowerbody_jerkKin_sum_pospeak_std 0.04304124 0.03763756 0.03237410</code></pre>
</div>
<div class="sourceCode cell-code" id="cb198"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb198-1"><a href="#cb198-1" aria-hidden="true" tabindex="-1"></a><span class="fu">xgb.plot.importance</span>(importanceXGBmultModel1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="02_XGBoost_effortIndicators_files/figure-html/mult feature importance 1-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="model-2-5" class="level5">
<h5 class="anchored" data-anchor-id="model-2-5">Model 2</h5>
<div class="cell">
<div class="sourceCode cell-code" id="cb199"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb199-1"><a href="#cb199-1" aria-hidden="true" tabindex="-1"></a>XGBmultModel2 <span class="ot">&lt;-</span> multModel2<span class="sc">$</span>finalModel</span>
<span id="cb199-2"><a href="#cb199-2" aria-hidden="true" tabindex="-1"></a>importanceXGBmultModel2 <span class="ot">&lt;-</span> <span class="fu">xgb.importance</span>(<span class="at">model =</span> XGBmultModel2)</span>
<span id="cb199-3"><a href="#cb199-3" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(importanceXGBmultModel2, <span class="at">n=</span><span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                                Feature       Gain      Cover   Frequency
                                 &lt;char&gt;      &lt;num&gt;      &lt;num&gt;       &lt;num&gt;
 1:         lowerbody_jerkKin_sum_Gmean 0.05671646 0.05851969 0.046052632
 2:                 arm_accKin_sum_Gstd 0.04611643 0.02468970 0.019736842
 3:                arm_accKin_sum_range 0.04296956 0.02853323 0.019736842
 4:               head_angAcc_sum_range 0.04274041 0.03817195 0.032894737
 5:                       head_duration 0.03394080 0.01916268 0.016447368
 6:                      head_inter_Kin 0.02912452 0.03218462 0.032894737
 7:               arm_power_pospeak_std 0.02882428 0.02028096 0.019736842
 8:                        arm_inter_IK 0.02682163 0.01527494 0.016447368
 9: head_moment_sum_change_pospeak_mean 0.02476986 0.01973325 0.016447368
10:       lowerbody_accKin_sum_integral 0.02368903 0.01247853 0.009868421</code></pre>
</div>
<div class="sourceCode cell-code" id="cb201"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb201-1"><a href="#cb201-1" aria-hidden="true" tabindex="-1"></a><span class="fu">xgb.plot.importance</span>(importanceXGBmultModel2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="02_XGBoost_effortIndicators_files/figure-html/mult feature importance 2-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="model-3-5" class="level5">
<h5 class="anchored" data-anchor-id="model-3-5">Model 3</h5>
<div class="cell">
<div class="sourceCode cell-code" id="cb202"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb202-1"><a href="#cb202-1" aria-hidden="true" tabindex="-1"></a>XGBmultModel3 <span class="ot">&lt;-</span> multModel3<span class="sc">$</span>finalModel</span>
<span id="cb202-2"><a href="#cb202-2" aria-hidden="true" tabindex="-1"></a>importanceXGBmultModel3 <span class="ot">&lt;-</span> <span class="fu">xgb.importance</span>(<span class="at">model =</span> XGBmultModel3)</span>
<span id="cb202-3"><a href="#cb202-3" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(importanceXGBmultModel3, <span class="at">n=</span><span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                                Feature       Gain      Cover  Frequency
                                 &lt;char&gt;      &lt;num&gt;      &lt;num&gt;      &lt;num&gt;
 1:               arm_power_pospeak_std 0.11936301 0.06412536 0.04587156
 2:         leg_moment_sum_pospeak_mean 0.06558456 0.06864607 0.05810398
 3:        envelope_change_pospeak_mean 0.03526312 0.03716335 0.03363914
 4:         lowerbody_jerkKin_sum_Gmean 0.03033355 0.03258257 0.02752294
 5:              spine_moment_sum_Gmean 0.02960073 0.02155368 0.01529052
 6:                       head_inter_IK 0.02905922 0.01726820 0.01529052
 7:                       body_slope_80 0.02434499 0.04392720 0.05504587
 8: head_moment_sum_change_pospeak_mean 0.02274487 0.03483516 0.03669725
 9:                arm_accKin_sum_range 0.02268550 0.02720615 0.02752294
10:               arm_speedKin_sum_Gstd 0.02068770 0.01205195 0.01223242</code></pre>
</div>
<div class="sourceCode cell-code" id="cb204"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb204-1"><a href="#cb204-1" aria-hidden="true" tabindex="-1"></a><span class="fu">xgb.plot.importance</span>(importanceXGBmultModel3)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="02_XGBoost_effortIndicators_files/figure-html/mult feature importance 3-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="model-4-5" class="level5">
<h5 class="anchored" data-anchor-id="model-4-5">Model 4</h5>
<div class="cell">
<div class="sourceCode cell-code" id="cb205"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb205-1"><a href="#cb205-1" aria-hidden="true" tabindex="-1"></a>XGBmultModel4 <span class="ot">&lt;-</span> multModel4<span class="sc">$</span>finalModel</span>
<span id="cb205-2"><a href="#cb205-2" aria-hidden="true" tabindex="-1"></a>importanceXGBmultModel4 <span class="ot">&lt;-</span> <span class="fu">xgb.importance</span>(<span class="at">model =</span> XGBmultModel4)</span>
<span id="cb205-3"><a href="#cb205-3" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(importanceXGBmultModel4, <span class="at">n=</span><span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                                Feature       Gain      Cover  Frequency
                                 &lt;char&gt;      &lt;num&gt;      &lt;num&gt;      &lt;num&gt;
 1: head_moment_sum_change_pospeak_mean 0.13433303 0.10993043 0.08828829
 2:               arm_power_pospeak_std 0.11704856 0.08864239 0.07567568
 3:                arm_moment_sum_range 0.07681624 0.06679121 0.05585586
 4:             head_angSpeed_sum_range 0.07387166 0.06683661 0.05945946
 5:                arm_accKin_sum_range 0.07129803 0.05788595 0.05045045
 6:              head_angJerk_sum_range 0.06440727 0.05423596 0.03783784
 7:        lowerbody_speedKin_sum_Gmean 0.05471338 0.04881843 0.03783784
 8:        lowerbody_speedKin_sum_range 0.05336213 0.04938517 0.03783784
 9:              arm_speedKin_sum_range 0.04297612 0.02185336 0.01441441
10:               head_angAcc_sum_Gmean 0.03311430 0.03207859 0.02522523</code></pre>
</div>
<div class="sourceCode cell-code" id="cb207"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb207-1"><a href="#cb207-1" aria-hidden="true" tabindex="-1"></a><span class="fu">xgb.plot.importance</span>(importanceXGBmultModel4)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="02_XGBoost_effortIndicators_files/figure-html/mult feature importance 4-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="model-5-5" class="level5">
<h5 class="anchored" data-anchor-id="model-5-5">Model 5</h5>
<div class="cell">
<div class="sourceCode cell-code" id="cb208"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb208-1"><a href="#cb208-1" aria-hidden="true" tabindex="-1"></a>XGBmultModel5 <span class="ot">&lt;-</span> multModel5<span class="sc">$</span>finalModel</span>
<span id="cb208-2"><a href="#cb208-2" aria-hidden="true" tabindex="-1"></a>importanceXGBmultModel5 <span class="ot">&lt;-</span> <span class="fu">xgb.importance</span>(<span class="at">model =</span> XGBmultModel5)</span>
<span id="cb208-3"><a href="#cb208-3" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(importanceXGBmultModel5, <span class="at">n=</span><span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                        Feature       Gain      Cover  Frequency
                         &lt;char&gt;      &lt;num&gt;      &lt;num&gt;      &lt;num&gt;
 1:       arm_speedKin_sum_Gstd 0.25372488 0.18051833 0.14107884
 2:              head_inter_Kin 0.10834497 0.08322603 0.07883817
 3:     head_angSpeed_sum_range 0.08083857 0.05868575 0.04979253
 4:      arm_speedKin_sum_Gmean 0.06179184 0.06637690 0.06224066
 5:  head_speedKin_sum_integral 0.06069948 0.06488408 0.05394191
 6: leg_moment_sum_pospeak_mean 0.03819193 0.02769087 0.02074689
 7:     arm_accKin_sum_integral 0.03553192 0.03942087 0.03734440
 8: lowerbody_jerkKin_sum_Gmean 0.03357866 0.03170172 0.02489627
 9:        arm_accKin_sum_range 0.02801619 0.02222806 0.01659751
10:       arm_power_pospeak_std 0.02737382 0.03537906 0.03734440</code></pre>
</div>
<div class="sourceCode cell-code" id="cb210"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb210-1"><a href="#cb210-1" aria-hidden="true" tabindex="-1"></a><span class="fu">xgb.plot.importance</span>(importanceXGBmultModel5)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="02_XGBoost_effortIndicators_files/figure-html/mult feature importance 5-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="cumulative-feature-importance-2" class="level5">
<h5 class="anchored" data-anchor-id="cumulative-feature-importance-2">Cumulative feature importance</h5>
<div class="cell">
<div class="sourceCode cell-code" id="cb211"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb211-1"><a href="#cb211-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Function to extract and normalize importance</span></span>
<span id="cb211-2"><a href="#cb211-2" aria-hidden="true" tabindex="-1"></a>get_normalized_importance <span class="ot">&lt;-</span> <span class="cf">function</span>(model) {</span>
<span id="cb211-3"><a href="#cb211-3" aria-hidden="true" tabindex="-1"></a>  importance <span class="ot">&lt;-</span> <span class="fu">xgb.importance</span>(<span class="at">model =</span> model)</span>
<span id="cb211-4"><a href="#cb211-4" aria-hidden="true" tabindex="-1"></a>  importance<span class="sc">$</span>Gain <span class="ot">&lt;-</span> importance<span class="sc">$</span>Gain <span class="sc">/</span> <span class="fu">sum</span>(importance<span class="sc">$</span>Gain)</span>
<span id="cb211-5"><a href="#cb211-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(importance)</span>
<span id="cb211-6"><a href="#cb211-6" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb211-7"><a href="#cb211-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-8"><a href="#cb211-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract normalized importance for each model</span></span>
<span id="cb211-9"><a href="#cb211-9" aria-hidden="true" tabindex="-1"></a>multImportance1 <span class="ot">&lt;-</span> <span class="fu">get_normalized_importance</span>(multModel1<span class="sc">$</span>finalModel)</span>
<span id="cb211-10"><a href="#cb211-10" aria-hidden="true" tabindex="-1"></a>multImportance2 <span class="ot">&lt;-</span> <span class="fu">get_normalized_importance</span>(multModel2<span class="sc">$</span>finalModel)</span>
<span id="cb211-11"><a href="#cb211-11" aria-hidden="true" tabindex="-1"></a>multImportance3 <span class="ot">&lt;-</span> <span class="fu">get_normalized_importance</span>(multModel3<span class="sc">$</span>finalModel)</span>
<span id="cb211-12"><a href="#cb211-12" aria-hidden="true" tabindex="-1"></a>multImportance4 <span class="ot">&lt;-</span> <span class="fu">get_normalized_importance</span>(multModel4<span class="sc">$</span>finalModel)</span>
<span id="cb211-13"><a href="#cb211-13" aria-hidden="true" tabindex="-1"></a>multImportance5 <span class="ot">&lt;-</span> <span class="fu">get_normalized_importance</span>(multModel5<span class="sc">$</span>finalModel)</span>
<span id="cb211-14"><a href="#cb211-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-15"><a href="#cb211-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Combine importances</span></span>
<span id="cb211-16"><a href="#cb211-16" aria-hidden="true" tabindex="-1"></a>multAllImportances <span class="ot">&lt;-</span> <span class="fu">list</span>(multImportance1, multImportance2, multImportance3, multImportance4, multImportance5)</span>
<span id="cb211-17"><a href="#cb211-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-18"><a href="#cb211-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Function to merge importances</span></span>
<span id="cb211-19"><a href="#cb211-19" aria-hidden="true" tabindex="-1"></a>merge_importances <span class="ot">&lt;-</span> <span class="cf">function</span>(importances) {</span>
<span id="cb211-20"><a href="#cb211-20" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">2</span><span class="sc">:</span><span class="fu">length</span>(importances)) {</span>
<span id="cb211-21"><a href="#cb211-21" aria-hidden="true" tabindex="-1"></a>    <span class="fu">names</span>(importances[[i]])[<span class="dv">2</span><span class="sc">:</span><span class="dv">4</span>] <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="fu">names</span>(importances[[i]])[<span class="dv">2</span><span class="sc">:</span><span class="dv">4</span>], <span class="st">"_"</span>, i)</span>
<span id="cb211-22"><a href="#cb211-22" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb211-23"><a href="#cb211-23" aria-hidden="true" tabindex="-1"></a>  merged <span class="ot">&lt;-</span> <span class="fu">Reduce</span>(<span class="cf">function</span>(x, y) <span class="fu">merge</span>(x, y, <span class="at">by =</span> <span class="st">"Feature"</span>, <span class="at">all =</span> <span class="cn">TRUE</span>), importances)</span>
<span id="cb211-24"><a href="#cb211-24" aria-hidden="true" tabindex="-1"></a>  merged[<span class="fu">is.na</span>(merged)] <span class="ot">&lt;-</span> <span class="dv">0</span>  <span class="co"># Replace NAs with 0</span></span>
<span id="cb211-25"><a href="#cb211-25" aria-hidden="true" tabindex="-1"></a>  gain_cols <span class="ot">&lt;-</span> <span class="fu">grep</span>(<span class="st">"Gain"</span>, <span class="fu">colnames</span>(merged), <span class="at">value =</span> <span class="cn">TRUE</span>)</span>
<span id="cb211-26"><a href="#cb211-26" aria-hidden="true" tabindex="-1"></a>  merged<span class="sc">$</span>Cumulative <span class="ot">&lt;-</span> <span class="fu">rowSums</span>(merged[, ..gain_cols])</span>
<span id="cb211-27"><a href="#cb211-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(merged[, .(Feature, Cumulative)])</span>
<span id="cb211-28"><a href="#cb211-28" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb211-29"><a href="#cb211-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-30"><a href="#cb211-30" aria-hidden="true" tabindex="-1"></a><span class="co"># Merge and sort importances</span></span>
<span id="cb211-31"><a href="#cb211-31" aria-hidden="true" tabindex="-1"></a>multCumulativeImportance <span class="ot">&lt;-</span> <span class="fu">merge_importances</span>(multAllImportances)</span>
<span id="cb211-32"><a href="#cb211-32" aria-hidden="true" tabindex="-1"></a>multCumulativeImportance <span class="ot">&lt;-</span> multCumulativeImportance[<span class="fu">order</span>(<span class="sc">-</span>multCumulativeImportance<span class="sc">$</span>Cumulative), ]</span>
<span id="cb211-33"><a href="#cb211-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-34"><a href="#cb211-34" aria-hidden="true" tabindex="-1"></a><span class="co"># Print cumulative feature importance</span></span>
<span id="cb211-35"><a href="#cb211-35" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(multCumulativeImportance, <span class="at">n=</span><span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                                Feature Cumulative
                                 &lt;char&gt;      &lt;num&gt;
 1:               arm_power_pospeak_std  0.4563189
 2:               arm_speedKin_sum_Gstd  0.2938622
 3: head_moment_sum_change_pospeak_mean  0.2651477
 4:                arm_accKin_sum_range  0.2164673
 5:                      head_inter_Kin  0.2109458
 6:         lowerbody_jerkKin_sum_Gmean  0.1823957
 7:             head_angSpeed_sum_range  0.1567240
 8:                arm_moment_sum_range  0.1448105
 9:                       head_duration  0.1419503
10:         leg_moment_sum_pospeak_mean  0.1221006</code></pre>
</div>
</div>
</section>
</section>
<section id="pca-2" class="level4">
<h4 class="anchored" data-anchor-id="pca-2">PCA</h4>
<p>Now let’s collect 10 features per component that have highest combined ranking from PCA and XGBoost. This means that for each feature we sum up the ranking it obtained in cumulative importance (XGBoost) and loading on a principal component (PCA).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb213"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb213-1"><a href="#cb213-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Rank the features based on XGBoost importance (cumulative)</span></span>
<span id="cb213-2"><a href="#cb213-2" aria-hidden="true" tabindex="-1"></a>multCumulativeImportance<span class="sc">$</span>XGB_Rank <span class="ot">&lt;-</span> <span class="fu">rank</span>(<span class="sc">-</span>multCumulativeImportance<span class="sc">$</span>Cumulative)</span>
<span id="cb213-3"><a href="#cb213-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb213-4"><a href="#cb213-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Load in PCA for gesture</span></span>
<span id="cb213-5"><a href="#cb213-5" aria-hidden="true" tabindex="-1"></a>mult_pca <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="fu">paste0</span>(datasets, <span class="st">"PCA_top_contributors_multi.csv"</span>))</span>
<span id="cb213-6"><a href="#cb213-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb213-7"><a href="#cb213-7" aria-hidden="true" tabindex="-1"></a><span class="co"># For each PC (PC1, PC2, PC3), rank the features based on their loadings</span></span>
<span id="cb213-8"><a href="#cb213-8" aria-hidden="true" tabindex="-1"></a>combined_ranks_per_pc <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb213-9"><a href="#cb213-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb213-10"><a href="#cb213-10" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (pc <span class="cf">in</span> <span class="fu">c</span>(<span class="st">"PC1"</span>, <span class="st">"PC2"</span>, <span class="st">"PC3"</span>)) {</span>
<span id="cb213-11"><a href="#cb213-11" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Extract the features and loadings for the current PC</span></span>
<span id="cb213-12"><a href="#cb213-12" aria-hidden="true" tabindex="-1"></a>  pca_pc_loadings <span class="ot">&lt;-</span> mult_pca[, <span class="fu">c</span>(pc, <span class="fu">paste0</span>(pc, <span class="st">"_Loading"</span>))]</span>
<span id="cb213-13"><a href="#cb213-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">colnames</span>(pca_pc_loadings) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Feature"</span>, <span class="st">"Loading"</span>)</span>
<span id="cb213-14"><a href="#cb213-14" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb213-15"><a href="#cb213-15" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Rank the features based on the absolute loading values (higher loadings should get lower rank)</span></span>
<span id="cb213-16"><a href="#cb213-16" aria-hidden="true" tabindex="-1"></a>  pca_pc_loadings<span class="sc">$</span>PCA_Rank <span class="ot">&lt;-</span> <span class="fu">rank</span>(<span class="sc">-</span><span class="fu">abs</span>(pca_pc_loadings<span class="sc">$</span>Loading))</span>
<span id="cb213-17"><a href="#cb213-17" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb213-18"><a href="#cb213-18" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Merge PCA loadings with XGBoost importance ranks</span></span>
<span id="cb213-19"><a href="#cb213-19" aria-hidden="true" tabindex="-1"></a>  merged_data <span class="ot">&lt;-</span> <span class="fu">merge</span>(pca_pc_loadings, multCumulativeImportance[, <span class="fu">c</span>(<span class="st">"Feature"</span>, <span class="st">"XGB_Rank"</span>)], <span class="at">by =</span> <span class="st">"Feature"</span>)</span>
<span id="cb213-20"><a href="#cb213-20" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb213-21"><a href="#cb213-21" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Calculate combined rank by summing XGBoost rank and PCA rank</span></span>
<span id="cb213-22"><a href="#cb213-22" aria-hidden="true" tabindex="-1"></a>  merged_data<span class="sc">$</span>Combined_Rank <span class="ot">&lt;-</span> merged_data<span class="sc">$</span>XGB_Rank <span class="sc">+</span> merged_data<span class="sc">$</span>PCA_Rank</span>
<span id="cb213-23"><a href="#cb213-23" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb213-24"><a href="#cb213-24" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Sort by the combined rank (lower rank is better)</span></span>
<span id="cb213-25"><a href="#cb213-25" aria-hidden="true" tabindex="-1"></a>  sorted_data <span class="ot">&lt;-</span> merged_data[<span class="fu">order</span>(merged_data<span class="sc">$</span>Combined_Rank), ]</span>
<span id="cb213-26"><a href="#cb213-26" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb213-27"><a href="#cb213-27" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Select the top n features based on the combined rank for the current PC</span></span>
<span id="cb213-28"><a href="#cb213-28" aria-hidden="true" tabindex="-1"></a>  top_n_features <span class="ot">&lt;-</span> <span class="dv">10</span>  <span class="co"># Adjust the number of top features as needed</span></span>
<span id="cb213-29"><a href="#cb213-29" aria-hidden="true" tabindex="-1"></a>  combined_ranks_per_pc[[pc]] <span class="ot">&lt;-</span> <span class="fu">head</span>(sorted_data, top_n_features)</span>
<span id="cb213-30"><a href="#cb213-30" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb213-31"><a href="#cb213-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb213-32"><a href="#cb213-32" aria-hidden="true" tabindex="-1"></a><span class="co"># Output the top features per PC based on combined ranking</span></span>
<span id="cb213-33"><a href="#cb213-33" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(combined_ranks_per_pc, <span class="at">n=</span><span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$PC1
                            Feature    Loading PCA_Rank XGB_Rank Combined_Rank
196    lowerbody_speedKin_sum_range 0.08494744        1       17            18
98           head_angJerk_sum_range 0.08114843        9       14            23
94            head_angJerk_sum_Gstd 0.08057174       10       29            39
93           head_angJerk_sum_Gmean 0.07951331       14       28            42
193 lowerbody_speedKin_sum_integral 0.07981523       12       39            51
128      head_speedKin_sum_integral 0.07633696       37       18            55
161   lowerbody_accKin_sum_integral 0.07643321       36       21            57
191    lowerbody_speedKin_sum_Gmean 0.07389508       49       13            62
89            head_angAcc_sum_Gmean 0.07122083       57       11            68
91         head_angAcc_sum_integral 0.07661845       34       34            68

$PC2
                               Feature     Loading PCA_Rank XGB_Rank
64                envelope_change_Gstd -0.08227254     27.0       25
157      leg_speedKin_sum_pospeak_mean  0.07903907     35.5       19
132        leg_accKin_sum_pospeak_mean  0.07903907     35.5       24
102            head_angSpeed_sum_range -0.07046288     70.0        7
109      head_jerkKin_sum_pospeak_mean  0.08860597     14.0       68
53        arm_speedKin_sum_pospeak_std -0.07747848     41.5       52
58                           COPc_Gstd  0.08674708     22.0       76
117 head_moment_sum_change_pospeak_std -0.07674698     45.0       58
6                  arm_angAcc_sum_Gstd  0.07178235     67.0       43
61                    COPc_pospeak_std  0.07857052     38.0       77
    Combined_Rank
64           52.0
157          54.5
132          59.5
102          77.0
109          82.0
53           93.5
58           98.0
117         103.0
6           110.0
61          115.0

$PC3
                               Feature     Loading PCA_Rank XGB_Rank
47               arm_power_pospeak_std -0.09134019       24        1
175        lowerbody_jerkKin_sum_Gmean  0.09121169       25        6
104                      head_duration -0.08806084       28        9
179  lowerbody_jerkKin_sum_pospeak_std  0.10241640       17       20
42                arm_moment_sum_range -0.08711107       30        8
178 lowerbody_jerkKin_sum_pospeak_mean  0.12010976        6       40
201         pelvis_moment_sum_integral -0.12537799        4       56
102            head_angSpeed_sum_range -0.07039109       59        7
49              arm_speedKin_sum_Gmean  0.07121858       57       12
69               envelope_pospeak_mean  0.08530688       33       49
    Combined_Rank
47             25
175            31
104            37
179            37
42             38
178            46
201            60
102            66
49             69
69             82</code></pre>
</div>
</div>
<p>For modelling, we want to pick three features per component. Which would it be in this case?</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb215"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb215-1"><a href="#cb215-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Number of top features to display</span></span>
<span id="cb215-2"><a href="#cb215-2" aria-hidden="true" tabindex="-1"></a>top_n_features <span class="ot">&lt;-</span> <span class="dv">3</span></span>
<span id="cb215-3"><a href="#cb215-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb215-4"><a href="#cb215-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Print the top 3 features per component</span></span>
<span id="cb215-5"><a href="#cb215-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (pc <span class="cf">in</span> <span class="fu">c</span>(<span class="st">"PC1"</span>, <span class="st">"PC2"</span>, <span class="st">"PC3"</span>)) {</span>
<span id="cb215-6"><a href="#cb215-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">Top 3 Features for"</span>, pc, <span class="st">":</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb215-7"><a href="#cb215-7" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb215-8"><a href="#cb215-8" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Get the top 3 features based on combined rank for the current PC</span></span>
<span id="cb215-9"><a href="#cb215-9" aria-hidden="true" tabindex="-1"></a>  top_features <span class="ot">&lt;-</span> <span class="fu">head</span>(combined_ranks_per_pc[[pc]], top_n_features)</span>
<span id="cb215-10"><a href="#cb215-10" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb215-11"><a href="#cb215-11" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Print the results</span></span>
<span id="cb215-12"><a href="#cb215-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(top_features[, <span class="fu">c</span>(<span class="st">"Feature"</span>, <span class="st">"XGB_Rank"</span>, <span class="st">"PCA_Rank"</span>, <span class="st">"Combined_Rank"</span>)])</span>
<span id="cb215-13"><a href="#cb215-13" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Top 3 Features for PC1 :
                         Feature XGB_Rank PCA_Rank Combined_Rank
196 lowerbody_speedKin_sum_range       17        1            18
98        head_angJerk_sum_range       14        9            23
94         head_angJerk_sum_Gstd       29       10            39

Top 3 Features for PC2 :
                          Feature XGB_Rank PCA_Rank Combined_Rank
64           envelope_change_Gstd       25     27.0          52.0
157 leg_speedKin_sum_pospeak_mean       19     35.5          54.5
132   leg_accKin_sum_pospeak_mean       24     35.5          59.5

Top 3 Features for PC3 :
                        Feature XGB_Rank PCA_Rank Combined_Rank
47        arm_power_pospeak_std        1       24            25
175 lowerbody_jerkKin_sum_Gmean        6       25            31
104               head_duration        9       28            37</code></pre>
</div>
</div>
<p><br> Now we are ready to model the most predictive features to get deeper understanding of their causal relationship with our predictive variable, i.e., communicative attempt.</p>
</section>
</section>
</section>
</section>
<section id="session-info" class="level1">
<h1>Session info</h1>
<p>Here is session information for reproducibility:</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>R version 4.4.1 (2024-06-14 ucrt)
Platform: x86_64-w64-mingw32/x64
Running under: Windows 10 x64 (build 19045)

Matrix products: default


locale:
[1] LC_COLLATE=German_Germany.utf8  LC_CTYPE=German_Germany.utf8   
[3] LC_MONETARY=German_Germany.utf8 LC_NUMERIC=C                   
[5] LC_TIME=German_Germany.utf8    

time zone: Europe/Berlin
tzcode source: internal

attached base packages:
[1] parallel  stats     graphics  grDevices utils     datasets  methods  
[8] base     

other attached packages:
 [1] doParallel_1.0.17   iterators_1.0.14    foreach_1.5.2      
 [4] mice_3.17.0         xgboost_1.7.9.1     caret_7.0-1        
 [7] lattice_0.22-6      tuneRanger_0.7      lhs_1.2.0          
[10] mlrMBO_1.1.5.1      smoof_1.6.0.3       checkmate_2.3.2    
[13] mlr_2.19.2          ParamHelpers_1.14.2 ranger_0.17.0      
[16] rpart.plot_3.1.2    rpart_4.1.24        gridExtra_2.3      
[19] ggpubr_0.6.0        ggforce_0.4.2       data.table_1.17.0  
[22] lubridate_1.9.4     forcats_1.0.0       dplyr_1.1.4        
[25] purrr_1.0.4         readr_2.1.5         tidyr_1.3.1        
[28] ggplot2_3.5.1       tidyverse_2.0.0     stringr_1.5.1      
[31] tibble_3.2.1       

loaded via a namespace (and not attached):
 [1] Rdpack_2.6.3         pROC_1.18.5          rlang_1.1.5         
 [4] magrittr_2.0.3       e1071_1.7-16         compiler_4.4.1      
 [7] vctrs_0.6.5          reshape2_1.4.4       crayon_1.5.3        
[10] shape_1.4.6.1        pkgconfig_2.0.3      fastmap_1.2.0       
[13] backports_1.5.0      rmarkdown_2.29       prodlim_2024.06.25  
[16] tzdb_0.5.0           nloptr_2.2.1         bit_4.6.0           
[19] jomo_2.7-6           glmnet_4.1-8         xfun_0.52           
[22] jsonlite_2.0.0       recipes_1.2.1        pan_1.9             
[25] tweenr_2.0.3         broom_1.0.8          R6_2.6.1            
[28] stringi_1.8.7        boot_1.3-30          parallelly_1.43.0   
[31] car_3.1-3            Rcpp_1.0.14          knitr_1.50          
[34] future.apply_1.11.3  Matrix_1.7-0         splines_4.4.1       
[37] nnet_7.3-19          timechange_0.3.0     tidyselect_1.2.1    
[40] abind_1.4-8          yaml_2.3.10          timeDate_4041.110   
[43] codetools_0.2-20     listenv_0.9.1        plyr_1.8.9          
[46] withr_3.0.2          evaluate_1.0.3       future_1.34.0       
[49] survival_3.6-4       proxy_0.4-27         polyclip_1.10-7     
[52] pillar_1.10.2        carData_3.0-5        stats4_4.4.1        
[55] reformulas_0.4.0     generics_0.1.3       vroom_1.6.5         
[58] hms_1.1.3            munsell_0.5.1        scales_1.3.0        
[61] minqa_1.2.8          globals_0.16.3       class_7.3-22        
[64] glue_1.8.0           tools_4.4.1          parallelMap_1.5.1   
[67] lme4_1.1-37          ModelMetrics_1.2.2.2 gower_1.0.2         
[70] ggsignif_0.6.4       XML_3.99-0.18        fastmatch_1.1-6     
[73] grid_4.4.1           rbibutils_2.3        ipred_0.9-15        
[76] colorspace_2.1-1     nlme_3.1-164         BBmisc_1.13         
[79] Formula_1.2-5        cli_3.6.4            DiceKriging_1.6.0   
[82] lava_1.8.1           gtable_0.3.6         rstatix_0.7.2       
[85] digest_0.6.37        farver_2.1.2         htmltools_0.5.8.1   
[88] lifecycle_1.0.4      hardhat_1.4.1        mitml_0.4-5         
[91] bit64_4.6.0-1        MASS_7.3-60.2       </code></pre>
</div>
</div>
</section>
<section id="references" class="level1">
<h1>References</h1>


<div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" role="list">
<div id="ref-chen_guestrin16" class="csl-entry" role="listitem">
Chen, Tianqi, and Carlos Guestrin. 2016. <span>“<span>XGBoost</span>: <span>A Scalable Tree Boosting System</span>.”</span> In <em>Proceedings of the 22nd <span>ACM SIGKDD International Conference</span> on <span>Knowledge Discovery</span> and <span>Data Mining</span></em>, 785–94. <span>KDD</span> ’16. New York, NY, USA: Association for Computing Machinery. <a href="https://doi.org/10.1145/2939672.2939785">https://doi.org/10.1145/2939672.2939785</a>.
</div>
<div id="ref-cwiek_etal_inprep2" class="csl-entry" role="listitem">
Ćwiek, Aleksandra, Alina Gregori, Paula Ginesa Sánchez-Ramón, Pilar Prieto, and Frank Kügler. n.d. <span>“<a href="">Acoustic Correlates of Perceived Phrase-Level Prosodic Prominence in Catalan and German</a>.”</span> Accessed.
</div>
</div>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>